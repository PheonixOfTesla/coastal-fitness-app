                        features: {
                            ...prev.features,
                            [feature]: enabled
                        }
                    }));
                    addNotification(`Feature ${feature} ${enabled ? 'enabled' : 'disabled'}! üîß`);
                };

                const executeCustomCode = () => {
                    try {
                        eval(customCode);
                        addNotification("Custom code executed successfully! üíª");
                    } catch (error) {
                        addNotification(`Code error: ${error.message}`, 'error');
                    }
                };

                const resetAppData = () => {
                    if (confirm('‚ö†Ô∏è This will reset ALL user data. Are you sure?')) {
                        globalUserData = {};
                        setAllUsers(Object.values(demoAccounts));
                        addNotification("All app data has been reset! üîÑ");
                    }
                };

                const generateSystemReport = () => {
                    const systemData = {
                        totalUsers: allUsers.length,
                        usersByRole: {
                            clients: allUsers.filter(u => u.role === 'client').length,
                            specialists: allUsers.filter(u => u.role === 'specialist').length,
                            admins: allUsers.filter(u => u.role === 'admin').length,
                            owners: allUsers.filter(u => u.role === 'owner').length,
                            engineers: allUsers.filter(u => u.role === 'engineer').length
                        },
                        totalMeasurements: Object.values(globalUserData).reduce((sum, data) => sum + (data.measurements?.length || 0), 0),
                        totalGoals: Object.values(globalUserData).reduce((sum, data) => sum + (data.goals?.length || 0), 0),
                        totalWorkouts: Object.values(globalUserData).reduce((sum, data) => sum + (data.workouts?.length || 0), 0),
                        totalTests: Object.values(globalUserData).reduce((sum, data) => sum + (data.specializedTests?.length || 0), 0),
                        appConfig: appConfig,
                        timestamp: new Date().toISOString()
                    };
                    
                    exportData(systemData, 'system_report');
                    addNotification("System report generated! üìä");
                };

                return (
                    <div className="space-y-6">
                        <div className="card rounded-xl p-6">
                            <h3 className="text-xl font-semibold mb-4">üîß System Engineering Dashboard</h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
                                <div className="bg-blue-500/20 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">üë• Total Users</h4>
                                    <p className="text-2xl font-bold text-blue-400">{allUsers.length}</p>
                                </div>
                                <div className="bg-green-500/20 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">üë§ Clients</h4>
                                    <p className="text-2xl font-bold text-green-400">
                                        {allUsers.filter(u => u.role === 'client').length}
                                    </p>
                                </div>
                                <div className="bg-purple-500/20 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">üë©‚Äç‚öïÔ∏è Specialists</h4>
                                    <p className="text-2xl font-bold text-purple-400">
                                        {allUsers.filter(u => u.role === 'specialist').length}
                                    </p>
                                </div>
                                <div className="bg-orange-500/20 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">üìä Measurements</h4>
                                    <p className="text-2xl font-bold text-orange-400">
                                        {Object.values(globalUserData).reduce((sum, data) => sum + (data.measurements?.length || 0), 0)}
                                    </p>
                                </div>
                                <div className="bg-cyan-500/20 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">üéØ Goals</h4>
                                    <p className="text-2xl font-bold text-cyan-400">
                                        {Object.values(globalUserData).reduce((sum, data) => sum + (data.goals?.length || 0), 0)}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">üé® App Configuration</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">App Name</label>
                                        <input
                                            type="text"
                                            value={appConfig.appName}
                                            onChange={(e) => updateAppConfig('appName', e.target.value)}
                                            className="editable-field"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Theme</label>
                                        <select 
                                            value={appConfig.theme}
                                            onChange={(e) => updateAppConfig('theme', e.target.value)}
                                            className="editable-field"
                                        >
                                            <option value="coastal-blue">Coastal Blue (Current)</option>
                                            <option value="medical-green">Medical Green</option>
                                            <option value="fitness-orange">Fitness Orange</option>
                                            <option value="dark-mode">Dark Mode</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Feature Toggles</label>
                                        <div className="space-y-2">
                                            {Object.entries(appConfig.features).map(([feature, enabled]) => (
                                                <label key={feature} className="flex items-center space-x-2">
                                                    <input 
                                                        type="checkbox" 
                                                        checked={enabled}
                                                        onChange={(e) => updateFeature(feature, e.target.checked)}
                                                        className="rounded"
                                                    />
                                                    <span className="capitalize">{feature}</span>
                                                </label>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                        <input 
                                            type="checkbox" 
                                            checked={appConfig.notifications}
                                            onChange={(e) => updateAppConfig('notifications', e.target.checked)}
                                            className="rounded"
                                        />
                                        <span>Enable Notifications</span>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                        <input 
                                            type="checkbox" 
                                            checked={appConfig.exportEnabled}
                                            onChange={(e) => updateAppConfig('exportEnabled', e.target.checked)}
                                            className="rounded"
                                        />
                                        <span>Enable Data Export</span>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium mb-2">Max Measurements per User</label>
                                        <input
                                            type="number"
                                            value={appConfig.maxMeasurements}
                                            onChange={(e) => updateAppConfig('maxMeasurements', parseInt(e.target.value))}
                                            className="editable-field"
                                        />
                                    </div>
                                </div>
                            </div>

                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">üíª Custom Code Editor</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">JavaScript Code</label>
                                        <textarea
                                            value={customCode}
                                            onChange={(e) => setCustomCode(e.target.value)}
                                            className="w-full h-48 p-3 rounded-lg bg-gray-800 border border-gray-600 text-green-300 font-mono text-sm focus:border-blue-400 focus:outline-none resize-none"
                                            placeholder="Enter custom JavaScript code..."
                                        />
                                    </div>
                                    <button
                                        onClick={executeCustomCode}
                                        className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition-all duration-300"
                                    >
                                        üöÄ Execute Custom Code
                                    </button>
                                </div>

                                <div className="mt-6">
                                    <h4 className="font-medium mb-3">‚ö° Quick Actions</h4>
                                    <div className="space-y-2">
                                        <button
                                            onClick={() => {
                                                document.title = appConfig.appName;
                                                addNotification("App title updated! üè∑Ô∏è");
                                            }}
                                            className="w-full bg-blue-500/20 hover:bg-blue-500/30 py-2 rounded text-sm"
                                        >
                                            üè∑Ô∏è Update Page Title
                                        </button>
                                        <button
                                            onClick={() => {
                                                document.body.style.filter = appConfig.theme === 'dark-mode' ? 'invert(1)' : 'none';
                                                addNotification("Theme applied! üé®");
                                            }}
                                            className="w-full bg-purple-500/20 hover:bg-purple-500/30 py-2 rounded text-sm"
                                        >
                                            üé® Apply Theme
                                        </button>
                                        <button
                                            onClick={generateSystemReport}
                                            className="w-full bg-green-500/20 hover:bg-green-500/30 py-2 rounded text-sm"
                                        >
                                            üìä Generate System Report
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">üíæ System Management</h3>
                                <div className="flex space-x-3">
                                    <button
                                        onClick={() => exportData({
                                            users: allUsers,
                                            userData: globalUserData,
                                            config: appConfig,
                                            timestamp: new Date().toISOString()
                                        }, 'complete_system_backup')}
                                        className="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg text-sm transition-colors"
                                    >
                                        üì• Full System Export
                                    </button>
                                    <button 
                                        onClick={resetAppData}
                                        className="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg text-sm transition-colors"
                                    >
                                        üîÑ Reset All Data
                                    </button>
                                    <button
                                        onClick={() => {
                                            window.location.reload();
                                        }}
                                        className="bg-orange-500 hover:bg-orange-600 px-4 py-2 rounded-lg text-sm transition-colors"
                                    >
                                        üîÉ Restart App
                                    </button>
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div className="bg-white/5 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">üîê Security Status</h4>
                                    <p className="text-green-400 text-sm">All systems secure</p>
                                    <p className="text-xs text-gray-400 mt-1">Last scan: 2 hours ago</p>
                                </div>
                                <div className="bg-white/5 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">üìà Performance</h4>
                                    <p className="text-blue-400 text-sm">Optimal performance</p>
                                    <p className="text-xs text-gray-400 mt-1">Avg response: 180ms</p>
                                </div>
                                <div className="bg-white/5 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">üíæ Storage</h4>
                                    <p className="text-orange-400 text-sm">2.3GB / 100GB used</p>
                                    <p className="text-xs text-gray-400 mt-1">97.7% available</p>
                                </div>
                                <div className="bg-white/5 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">‚ö° System Load</h4>
                                    <p className="text-purple-400 text-sm">12% CPU usage</p>
                                    <p className="text-xs text-gray-400 mt-1">All systems normal</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Nutrition Component
            const NutritionComponent = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;
                const [nutritionTargets, setNutritionTargets] = useState({
                    protein: '',
                    carbs: '',
                    fat: '',
                    calories: ''
                });

                const assignNutritionPlan = () => {
                    if (nutritionTargets.protein || nutritionTargets.carbs || nutritionTargets.fat || nutritionTargets.calories) {
                        const targets = {
                            protein: parseFloat(nutritionTargets.protein) || 0,
                            carbs: parseFloat(nutritionTargets.carbs) || 0,
                            fat: parseFloat(nutritionTargets.fat) || 0,
                            calories: parseFloat(nutritionTargets.calories) || 0
                        };

                        const planUpdate = {
                            dailyTargets: targets,
                            assignedBy: currentUser.id,
                            assignedDate: new Date().toISOString().split('T')[0]
                        };

                        const targetId = selectedClientId || currentUser.id;
                        const targetData = getUserData(targetId);
                        globalUserData[targetId] = {
                            ...targetData,
                            nutritionPlan: { ...targetData.nutritionPlan, ...planUpdate }
                        };

                        setNutritionTargets({ protein: '', carbs: '', fat: '', calories: '' });
                        addNotification(`Nutrition plan assigned to ${displayUser.name}! ü•ó`);
                    }
                };

                const logNutrition = (nutritionData) => {
                    const targetId = selectedClientId || currentUser.id;
                    const targetData = getUserData(targetId);
                    globalUserData[targetId] = {
                        ...targetData,
                        nutritionPlan: {
                            ...targetData.nutritionPlan,
                            currentIntake: nutritionData
                        }
                    };
                    addNotification("Nutrition intake logged! ü•ó");
                };

                const progressPercent = (current, target) => target > 0 ? Math.round((current / target) * 100) : 0;

                return (
                    <div className="space-y-6">
                        {selectedClientId && (
                            <div className="card rounded-xl p-4 bg-green-500/20">
                                <p className="text-center">
                                    ü•ó Managing nutrition for: <strong>{displayUser.name}</strong>
                                    <button
                                        onClick={() => setSelectedClientId(null)}
                                        className="ml-4 bg-gray-500/20 hover:bg-gray-500/30 px-3 py-1 rounded text-sm"
                                    >
                                        ‚Üê Back
                                    </button>
                                </p>
                            </div>
                        )}

                        {hasPermission('assignNutrition') && (
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">ü•ó Assign Nutrition Plan</h3>
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                                    <input
                                        type="number"
                                        placeholder="Protein Target (g)"
                                        value={nutritionTargets.protein}
                                        onChange={(e) => setNutritionTargets({...nutritionTargets, protein: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Carbs Target (g)"
                                        value={nutritionTargets.carbs}
                                        onChange={(e) => setNutritionTargets({...nutritionTargets, carbs: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Fat Target (g)"
                                        value={nutritionTargets.fat}
                                        onChange={(e) => setNutritionTargets({...nutritionTargets, fat: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Calories Target"
                                        value={nutritionTargets.calories}
                                        onChange={(e) => setNutritionTargets({...nutritionTargets, calories: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                </div>
                                <button
                                    onClick={assignNutritionPlan}
                                    className="w-full bg-gradient-to-r from-green-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-green-700 hover:to-blue-700 transition-all duration-300"
                                >
                                    üéØ Assign Nutrition Plan
                                </button>
                            </div>
                        )}

                        {/* Current Plan Display */}
                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">üìä Current Nutrition Plan</h3>
                                <button
                                    onClick={() => exportData(userData.nutritionPlan, `${displayUser.name.replace(/\s+/g, '_')}_nutrition`)}
                                    className="bg-green-500/20 hover:bg-green-500/30 px-3 py-1 rounded text-sm transition-colors"
                                >
                                    üìä Export Plan
                                </button>
                            </div>
                            
                            {userData.nutritionPlan.assignedBy ? (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div className="bg-blue-500/20 p-4 rounded-lg">
                                        <div className="flex justify-between items-center mb-2">
                                            <h4 className="font-medium">ü•© Protein</h4>
                                            <span className="text-sm">{progressPercent(userData.nutritionPlan.currentIntake.protein, userData.nutritionPlan.dailyTargets.protein)}%</span>
                                        </div>
                                        <p className="text-2xl font-bold text-blue-400 mb-2">
                                            {userData.nutritionPlan.currentIntake.protein}g
                                        </p>
                                        <p className="text-sm text-gray-400">Goal: {userData.nutritionPlan.dailyTargets.protein}g</p>
                                        <div className="w-full bg-gray-700 rounded-full h-2 mt-2">
                                            <div 
                                                className="bg-blue-500 h-2 rounded-full transition-all duration-300"
                                                style={{ width: `${Math.min(progressPercent(userData.nutritionPlan.currentIntake.protein, userData.nutritionPlan.dailyTargets.protein), 100)}%` }}
                                            ></div>
                                        </div>
                                    </div>

                                    <div className="bg-green-500/20 p-4 rounded-lg">
                                        <div className="flex justify-between items-center mb-2">
                                            <h4 className="font-medium">üçû Carbs</h4>
                                            <span className="text-sm">{progressPercent(userData.nutritionPlan.currentIntake.carbs, userData.nutritionPlan.dailyTargets.carbs)}%</span>
                                        </div>
                                        <p className="text-2xl font-bold text-green-400 mb-2">
                                            {userData.nutritionPlan.currentIntake.carbs}g
                                        </p>
                                        <p className="text-sm text-gray-400">Goal: {userData.nutritionPlan.dailyTargets.carbs}g</p>
                                        <div className="w-full bg-gray-700 rounded-full h-2 mt-2">
                                            <div 
                                                className="bg-green-500 h-2 rounded-full transition-all duration-300"
                                                style={{ width: `${Math.min(progressPercent(userData.nutritionPlan.currentIntake.carbs, userData.nutritionPlan.dailyTargets.carbs), 100)}%` }}
                                            ></div>
                                        </div>
                                    </div>

                                    <div className="bg-orange-500/20 p-4 rounded-lg">
                                        <div className="flex justify-between items-center mb-2">
                                            <h4 className="font-medium">ü•ë Fat</h4>
                                            <span className="text-sm">{progressPercent(userData.nutritionPlan.currentIntake.fat, userData.nutritionPlan.dailyTargets.fat)}%</span>
                                        </div>
                                        <p className="text-2xl font-bold text-orange-400 mb-2">
                                            {userData.nutritionPlan.currentIntake.fat}g
                                        </p>
                                        <p className="text-sm text-gray-400">Goal: {userData.nutritionPlan.dailyTargets.fat}g</p>
                                        <div className="w-full bg-gray-700 rounded-full h-2 mt-2">
                                            <div 
                                                className="bg-orange-500 h-2 rounded-full transition-all duration-300"
                                                style={{ width: `${Math.min(progressPercent(userData.nutritionPlan.currentIntake.fat, userData.nutritionPlan.dailyTargets.fat), 100)}%` }}
                                            ></div>
                                        </div>
                                    </div>

                                    <div className="bg-purple-500/20 p-4 rounded-lg">
                                        <div className="flex justify-between items-center mb-2">
                                            <h4 className="font-medium">üî• Calories</h4>
                                            <span className="text-sm">{progressPercent(userData.nutritionPlan.currentIntake.calories, userData.nutritionPlan.dailyTargets.calories)}%</span>
                                        </div>
                                        <p className="text-2xl font-bold text-purple-400 mb-2">
                                            {userData.nutritionPlan.currentIntake.calories}
                                        </p>
                                        <p className="text-sm text-gray-400">Goal: {userData.nutritionPlan.dailyTargets.calories}</p>
                                        <div className="w-full bg-gray-700 rounded-full h-2 mt-2">
                                            <div 
                                                className="bg-purple-500 h-2 rounded-full transition-all duration-300"
                                                style={{ width: `${Math.min(progressPercent(userData.nutritionPlan.currentIntake.calories, userData.nutritionPlan.dailyTargets.calories), 100)}%` }}
                                            ></div>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="text-center py-8 text-gray-400">
                                    <div className="text-4xl mb-2">ü•ó</div>
                                    <p>No nutrition plan assigned yet</p>
                                    <p className="text-sm">
                                        {hasPermission('assignNutrition') 
                                            ? 'Create a nutrition plan above!' 
                                            : 'Contact your specialist to get a nutrition plan assigned!'
                                        }
                                    </p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Chat Component
            const ChatComponent = () => {
                const messagesEndRef = useRef(null);

                const scrollToBottom = () => {
                    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
                };

                useEffect(() => {
                    scrollToBottom();
                }, [chatMessages]);

                const sendMessage = () => {
                    if (currentMessage.trim()) {
                        setChatMessages([...chatMessages, {
                            id: Date.now(),
                            text: currentMessage,
                            sender: currentUser.name,
                            timestamp: new Date().toLocaleTimeString(),
                            isUser: true
                        }]);
                        setCurrentMessage('');
                        
                        // Auto-reply simulation
                        setTimeout(() => {
                            const responses = [
                                "Thanks for your message! I'll review your progress and get back to you soon. üìã",
                                "Great progress on your health journey! Keep up the excellent work! üí™",
                                "I've noted your question. Let's discuss this in detail during our next session. üó£Ô∏è",
                                "Your dedication to your health goals is inspiring! üåü",
                                "I'll coordinate with your fitness specialist about your recent measurements. üìä",
                                "Let's schedule a follow-up to discuss your nutrition plan. ü•ó"
                            ];
                            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                            
                            setChatMessages(prev => [...prev, {
                                id: Date.now(),
                                text: randomResponse,
                                sender: "Dr. Sarah Mitchell",
                                timestamp: new Date().toLocaleTimeString(),
                                isUser: false
                            }]);
                        }, 1000);
                    }
                };

                return (
                    <div className="space-y-6">
                        <div className="card rounded-xl p-6 h-96 flex flex-col">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">üí¨ Team Communication</h3>
                                <div className="flex space-x-2">
                                    <button className="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg text-sm transition-colors">
                                        üé• Schedule Zoom
                                    </button>
                                    <button className="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg text-sm transition-colors">
                                        üìû Call Now
                                    </button>
                                </div>
                            </div>
                            
                            <div className="flex-1 overflow-y-auto space-y-3 mb-4">
                                {chatMessages.map(msg => (
                                    <div
                                        key={msg.id}
                                        className={`p-3 rounded-lg max-w-xs ${
                                            msg.isUser 
                                                ? 'bg-blue-500/20 text-blue-300 ml-auto' 
                                                : 'bg-gray-700/50 text-gray-300 mr-auto'
                                        }`}
                                    >
                                        <div className="font-medium text-xs mb-1">{msg.sender}</div>
                                        <div className="text-sm whitespace-pre-line">{msg.text}</div>
                                        <div className="text-xs text-gray-500 mt-1">{msg.timestamp}</div>
                                    </div>
                                ))}
                                <div ref={messagesEndRef} />
                            </div>
                            
                            <div className="flex gap-2">
                                <input
                                    type="text"
                                    value={currentMessage}
                                    onChange={(e) => setCurrentMessage(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                                    placeholder="Type your message..."
                                    className="flex-1 p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                />
                                <button
                                    onClick={sendMessage}
                                    className="bg-gradient-to-r from-blue-500 to-cyan-500 px-6 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-cyan-600 transition-all duration-300"
                                >
                                    üì§
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Reports Component
            const ReportsComponent = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;

                const generateReport = () => {
                    if (userData.measurements.length === 0) {
                        return {
                            period: 'No data available',
                            weightChange: 0,
                            bodyFatChange: 0,
                            muscleChange: 0,
                            goalsCompleted: userData.goals.filter(g => g.progress >= 100).length,
                            totalGoals: userData.goals.length,
                            avgProgress: userData.goals.length > 0 ? Math.round(userData.goals.reduce((sum, g) => sum + g.progress, 0) / userData.goals.length) : 0,
                            workoutsCompleted: userData.workouts.filter(w => w.completedToday).length,
                            totalWorkouts: userData.workouts.length,
                            nutritionCompliance: userData.nutritionPlan.dailyTargets.calories > 0 ? Math.round((userData.nutritionPlan.currentIntake.calories / userData.nutritionPlan.dailyTargets.calories) * 100) : 0
                        };
                    }

                    const latestMeasurement = userData.measurements[userData.measurements.length - 1];
                    const firstMeasurement = userData.measurements[0];
                    
                    const weightChange = latestMeasurement.weight - firstMeasurement.weight;
                    const bodyFatChange = (latestMeasurement.bodyFat || 0) - (firstMeasurement.bodyFat || 0);
                    const muscleChange = (latestMeasurement.muscle || 0) - (firstMeasurement.muscle || 0);

                    return {
                        period: `${firstMeasurement.date} to ${latestMeasurement.date}`,
                        weightChange,
                        bodyFatChange,
                        muscleChange,
                        goalsCompleted: userData.goals.filter(g => g.progress >= 100).length,
                        totalGoals: userData.goals.length,
                        avgProgress: userData.goals.length > 0 ? Math.round(userData.goals.reduce((sum, g) => sum + g.progress, 0) / userData.goals.length) : 0,
                        workoutsCompleted: userData.workouts.filter(w => w.completedToday).length,
                        totalWorkouts: userData.workouts.length,
                        nutritionCompliance: userData.nutritionPlan.dailyTargets.calories > 0 ? Math.round((userData.nutritionPlan.currentIntake.calories / userData.nutritionPlan.dailyTargets.calories) * 100) : 0
                    };
                };

                const report = generateReport();

                const exportReport = () => {
                    const reportData = {
                        generatedAt: new Date().toISOString(),
                        user: displayUser.name,
                        summary: report,
                        measurements: userData.measurements,
                        goals: userData.goals,
                        workouts: userData.workouts,
                        nutrition: userData.nutritionPlan,
                        specializedTests: userData.specializedTests
                    };
                    
                    exportData(reportData, `${displayUser.name.replace(/\s+/g, '_')}_health_report`);
                    addNotification("Health report exported! üìä");
                };

                return (
                    <div className="space-y-6">
                        {selectedClientId && (
                            <div className="card rounded-xl p-4 bg-blue-500/20">
                                <p className="text-center">
                                    üìà Viewing report for: <strong>{displayUser.name}</strong>
                                    <button
                                        onClick={() => setSelectedClientId(null)}
                                        className="ml-4 bg-gray-500/20 hover:bg-gray-500/30 px-3 py-1 rounded text-sm"
                                    >
                                        ‚Üê Back
                                    </button>
                                </p>
                            </div>
                        )}

                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">üìà Health Progress Report</h3>
                                <button
                                    onClick={exportReport}
                                    className="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg text-sm transition-colors"
                                >
                                    üìä Export Full Report
                                </button>
                            </div>
                            
                            {userData.measurements.length > 0 ? (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">üìä Weight Progress</h4>
                                        <p className={`text-2xl font-bold ${report.weightChange < 0 ? 'text-green-400' : report.weightChange > 0 ? 'text-orange-400' : 'text-gray-400'}`}>
                                            {report.weightChange > 0 ? '+' : ''}{report.weightChange.toFixed(1)} lbs
                                        </p>
                                        <p className="text-sm text-gray-400">Overall change</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">üî• Body Fat Change</h4>
                                        <p className={`text-2xl font-bold ${report.bodyFatChange < 0 ? 'text-green-400' : report.bodyFatChange > 0 ? 'text-orange-400' : 'text-gray-400'}`}>
                                            {report.bodyFatChange > 0 ? '+' : ''}{report.bodyFatChange.toFixed(1)}%
                                        </p>
                                        <p className="text-sm text-gray-400">Overall change</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">üí™ Muscle Change</h4>
                                        <p className={`text-2xl font-bold ${report.muscleChange > 0 ? 'text-green-400' : report.muscleChange < 0 ? 'text-orange-400' : 'text-gray-400'}`}>
                                            {report.muscleChange > 0 ? '+' : ''}{report.muscleChange.toFixed(1)} lbs
                                        </p>
                                        <p className="text-sm text-gray-400">Muscle mass change</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">üéØ Goals Completed</h4>
                                        <p className="text-2xl font-bold text-blue-400">
                                            {report.goalsCompleted}/{report.totalGoals}
                                        </p>
                                        <p className="text-sm text-gray-400">Achievement rate</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">üìà Average Progress</h4>
                                        <p className="text-2xl font-bold text-green-400">{report.avgProgress}%</p>
                                        <p className="text-sm text-gray-400">Across all goals</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">üí™ Workout Completion</h4>
                                        <p className="text-2xl font-bold text-purple-400">
                                            {report.workoutsCompleted}/{report.totalWorkouts}
                                        </p>
                                        <p className="text-sm text-gray-400">Today's progress</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">ü•ó Nutrition Compliance</h4>
                                        <p className="text-2xl font-bold text-green-400">{report.nutritionCompliance}%</p>
                                        <p className="text-sm text-gray-400">Calorie target met</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">‚è±Ô∏è Report Period</h4>
                                        <p className="text-sm text-blue-400">{report.period}</p>
                                        <p className="text-sm text-gray-400">Data timeframe</p>
                                    </div>
                                </div>
                            ) : (
                                <div className="text-center py-12 text-gray-400">
                                    <div className="text-6xl mb-4">üìä</div>
                                    <h4 className="text-2xl font-bold mb-2">No Data to Report</h4>
                                    <p className="text-lg mb-4">Start tracking measurements to generate health reports</p>
                                    <button
                                        onClick={() => setActiveTab('measurements')}
                                        className="bg-gradient-to-r from-blue-600 to-cyan-500 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-cyan-600 transition-all duration-300"
                                    >
                                        üìè Add First Measurement
                                    </button>
                                </div>
                            )}
                        </div>

                        {userData.measurements.length > 0 && (
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">üìã Detailed Analysis</h3>
                                <div className="space-y-4">
                                    <div className="p-4 bg-green-500/10 border-l-4 border-green-500 rounded">
                                        <h4 className="font-medium text-green-400 mb-2">‚úÖ Achievements</h4>
                                        <ul className="text-sm space-y-1">
                                            <li>‚Ä¢ {userData.measurements.length} health measurements recorded</li>
                                            <li>‚Ä¢ {report.goalsCompleted} goals completed successfully</li>
                                            <li>‚Ä¢ {userData.workouts.length} workouts in program</li>
                                            <li>‚Ä¢ {userData.specializedTests.length} specialized tests performed</li>
                                            {report.weightChange !== 0 && <li>‚Ä¢ Weight change of {report.weightChange.toFixed(1)} lbs achieved</li>}
                                            {userData.nutritionPlan.assignedBy && <li>‚Ä¢ Custom nutrition plan assigned and tracked</li>}
                                        </ul>
                                    </div>

                                    <div className="p-4 bg-blue-500/10 border-l-4 border-blue-500 rounded">
                                        <h4 className="font-medium text-blue-400 mb-2">üìä Recommendations</h4>
                                        <ul className="text-sm space-y-1">
                                            <li>‚Ä¢ Continue consistent health tracking</li>
                                            <li>‚Ä¢ Maintain regular communication with specialists</li>
                                            <li>‚Ä¢ Focus on completing assigned workouts</li>
                                            <li>‚Ä¢ Track nutrition intake daily for best results</li>
                                            {report.avgProgress < 80 && <li>‚Ä¢ Consider adjusting goals for better achievement rates</li>}
                                            {userData.specializedTests.length === 0 && <li>‚Ä¢ Schedule specialized tests for comprehensive health assessment</li>}
                                        </ul>
                                    </div>

                                    <div className="p-4 bg-orange-500/10 border-l-4 border-orange-500 rounded">
                                        <h4 className="font-medium text-orange-400 mb-2">‚ö†Ô∏è Areas for Improvement</h4>
                                        <ul className="text-sm space-y-1">
                                            {report.workoutsCompleted === 0 && report.totalWorkouts > 0 && <li>‚Ä¢ Complete assigned workouts for better progress</li>}
                                            {report.nutritionCompliance < 80 && <li>‚Ä¢ Improve nutrition plan adherence</li>}
                                            {userData.measurements.length < 5 && <li>‚Ä¢ Increase measurement frequency for better tracking</li>}
                                            {userData.goals.length === 0 && <li>‚Ä¢ Set specific health goals to track progress</li>}
                                            {report.avgProgress < 50 && <li>‚Ä¢ Review and adjust current goals for achievability</li>}
                                            <li>‚Ä¢ Consider scheduling regular check-ins with specialists</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Main content renderer
            const renderContent = () => {
                switch(activeTab) {
                    case 'dashboard':
                        return <Dashboard />;
                    case 'measurements':
                        return <MeasurementsComponent />;
                    case 'nutrition':
                        return <NutritionComponent />;
                    case 'workouts':
                        return <WorkoutsComponent />;
                    case 'goals':
                        return <GoalsComponent />;
                    case 'tests':
                        return <SpecializedTestsComponent />;
                    case 'chat':
                        return <ChatComponent />;
                    case 'users':
                        return <UsersComponent />;
                    case 'engineer':
                        return <EngineerComponent />;
                    case 'reports':
                        return <ReportsComponent />;
                    default:
                        return <Dashboard />;
                }
            };

            // Main App Return
            if (!currentUser) {
                return <LoginForm />;
            }

            return (
                <div className="min-h-screen gradient-bg p-4">
                    <div className="max-w-7xl mx-auto">
                        <Navigation />
                        {renderContent()}
                    </div>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>                                                                    {currentUser.role === 'owner' && <option value="admin">Admin</option>}
                                                                </select>
                                                            )}
                                                        </div>
                                                    )}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Client Overview Cards */}
                        {(hasPermission('viewClients') || hasPermission('viewAllUsers')) && (
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">üìä Client Overview</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {allUsers.filter(user => user.role === 'client').map(client => {
                                        const clientData = getUserData(client.id);
                                        return (
                                            <div key={client.id} className="bg-white/5 rounded-lg p-4 hover:bg-white/10 transition-colors">
                                                <div className="flex items-center space-x-3 mb-3">
                                                    <span className="text-2xl">{client.avatar}</span>
                                                    <div>
                                                        <h4 className="font-medium">{client.name}</h4>
                                                        <p className="text-sm text-gray-400">{client.email}</p>
                                                    </div>
                                                </div>
                                                <div className="space-y-2 text-sm">
                                                    <p><span className="text-gray-400">Specialist:</span> {
                                                        client.specialistId 
                                                            ? allUsers.find(u => u.id === client.specialistId)?.name || 'Unknown'
                                                            : 'Unassigned'
                                                    }</p>
                                                    <p><span className="text-gray-400">Measurements:</span> {clientData.measurements.length}</p>
                                                    <p><span className="text-gray-400">Goals:</span> {clientData.goals.length}</p>
                                                    <p><span className="text-gray-400">Tests:</span> {clientData.specializedTests.length}</p>
                                                </div>
                                                <button
                                                    onClick={() => setSelectedClientId(client.id)}
                                                    className="w-full mt-3 bg-blue-500/20 hover:bg-blue-500/30 py-2 rounded text-sm transition-colors"
                                                >
                                                    View Full Profile
                                                </button>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Workouts Component
            const WorkoutsComponent = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;
                const [newWorkout, setNewWorkout] = useState({
                    name: '',
                    exercises: [''],
                    targetClientId: selectedClientId || (currentUser.role === 'client' ? currentUser.id : '')
                });

                const addExercise = () => {
                    setNewWorkout({
                        ...newWorkout,
                        exercises: [...newWorkout.exercises, '']
                    });
                };

                const updateExercise = (index, value) => {
                    const updatedExercises = [...newWorkout.exercises];
                    updatedExercises[index] = value;
                    setNewWorkout({
                        ...newWorkout,
                        exercises: updatedExercises
                    });
                };

                const createWorkout = () => {
                    if (newWorkout.name && newWorkout.exercises.some(ex => ex.trim())) {
                        const workout = {
                            id: Date.now(),
                            name: newWorkout.name,
                            exercises: newWorkout.exercises.filter(ex => ex.trim()),
                            assigned: hasPermission('assignWorkouts'),
                            completedToday: false,
                            assignedBy: currentUser.id,
                            clientId: newWorkout.targetClientId
                        };
                        
                        updateUserData(newWorkout.targetClientId, 'workouts', workout);
                        setNewWorkout({
                            name: '',
                            exercises: [''],
                            targetClientId: selectedClientId || (currentUser.role === 'client' ? currentUser.id : '')
                        });

                        const targetUser = allUsers.find(u => u.id === newWorkout.targetClientId);
                        addNotification(`Workout assigned to ${targetUser?.name || 'client'}! üí™`);
                    }
                };

                const toggleWorkoutCompletion = (workoutId) => {
                    const targetId = selectedClientId || currentUser.id;
                    const targetData = getUserData(targetId);
                    const updatedWorkouts = targetData.workouts.map(workout => 
                        workout.id === workoutId 
                            ? { ...workout, completedToday: !workout.completedToday }
                            : workout
                    );
                    globalUserData[targetId] = { ...targetData, workouts: updatedWorkouts };
                    addNotification("Workout status updated! üí™");
                };

                const getClientsForAssignment = () => {
                    if (currentUser.role === 'client') return [];
                    return allUsers.filter(user => user.role === 'client');
                };

                return (
                    <div className="space-y-6">
                        {selectedClientId && (
                            <div className="card rounded-xl p-4 bg-purple-500/20">
                                <p className="text-center">
                                    üí™ Managing workouts for: <strong>{displayUser.name}</strong>
                                    <button
                                        onClick={() => setSelectedClientId(null)}
                                        className="ml-4 bg-gray-500/20 hover:bg-gray-500/30 px-3 py-1 rounded text-sm"
                                    >
                                        ‚Üê Back
                                    </button>
                                </p>
                            </div>
                        )}

                        {/* Create/Assign Workout */}
                        {hasPermission('assignWorkouts') && (
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">üí™ Create & Assign Workout</h3>
                                <div className="space-y-4">
                                    <input
                                        type="text"
                                        placeholder="Workout Name (e.g., Upper Body Strength)"
                                        value={newWorkout.name}
                                        onChange={(e) => setNewWorkout({...newWorkout, name: e.target.value})}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    
                                    {getClientsForAssignment().length > 0 && !selectedClientId && (
                                        <select
                                            value={newWorkout.targetClientId}
                                            onChange={(e) => setNewWorkout({...newWorkout, targetClientId: e.target.value})}
                                            className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                        >
                                            <option value="">Select Client</option>
                                            {getClientsForAssignment().map(client => (
                                                <option key={client.id} value={client.id}>{client.name}</option>
                                            ))}
                                        </select>
                                    )}

                                    <div className="space-y-2">
                                        <label className="block text-sm font-medium">Exercises:</label>
                                        {newWorkout.exercises.map((exercise, index) => (
                                            <div key={index} className="flex gap-2">
                                                <input
                                                    type="text"
                                                    placeholder={`Exercise ${index + 1} (e.g., Push-ups x15)`}
                                                    value={exercise}
                                                    onChange={(e) => updateExercise(index, e.target.value)}
                                                    className="flex-1 p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                                />
                                                {newWorkout.exercises.length > 1 && (
                                                    <button
                                                        onClick={() => setNewWorkout({
                                                            ...newWorkout,
                                                            exercises: newWorkout.exercises.filter((_, i) => i !== index)
                                                        })}
                                                        className="bg-red-500/20 hover:bg-red-500/30 px-3 py-2 rounded text-sm"
                                                    >
                                                        ‚úï
                                                    </button>
                                                )}
                                            </div>
                                        ))}
                                        <button
                                            onClick={addExercise}
                                            className="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg text-sm transition-colors"
                                        >
                                            + Add Exercise
                                        </button>
                                    </div>

                                    <button
                                        onClick={createWorkout}
                                        disabled={!newWorkout.name || !newWorkout.targetClientId}
                                        className="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition-all duration-300 disabled:opacity-50"
                                    >
                                        üéØ Create & Assign Workout
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Workouts List */}
                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">
                                    {selectedClientId ? `üí™ ${displayUser.name}'s Workouts` : 'üí™ My Workouts'}
                                </h3>
                                <button
                                    onClick={() => exportData(userData.workouts, `${displayUser.name.replace(/\s+/g, '_')}_workouts`)}
                                    className="bg-green-500/20 hover:bg-green-500/30 px-3 py-1 rounded text-sm transition-colors"
                                >
                                    üìä Export Workouts
                                </button>
                            </div>
                            {userData.workouts.length > 0 ? (
                                <div className="space-y-4">
                                    {userData.workouts
                                        .filter(workout => currentUser.role !== 'client' || workout.assigned)
                                        .map(workout => (
                                        <div key={workout.id} className={`p-4 rounded-lg ${
                                            workout.completedToday ? 'bg-green-500/20 border-l-4 border-green-500' : 'bg-blue-500/20 border-l-4 border-blue-500'
                                        }`}>
                                            <div className="flex justify-between items-start mb-3">
                                                <div>
                                                    <h4 className="font-medium text-lg">{workout.name}</h4>
                                                    {workout.assignedBy && (
                                                        <p className="text-sm text-gray-400">
                                                            Assigned by: {allUsers.find(u => u.id === workout.assignedBy)?.name || 'Unknown'}
                                                        </p>
                                                    )}
                                                </div>
                                                <div className="flex items-center space-x-2">
                                                    <span className={`text-xs px-2 py-1 rounded ${
                                                        workout.completedToday ? 'bg-green-500 text-white' : 'bg-orange-500 text-white'
                                                    }`}>
                                                        {workout.completedToday ? '‚úÖ Complete' : '‚è≥ Pending'}
                                                    </span>
                                                    <button
                                                        onClick={() => toggleWorkoutCompletion(workout.id)}
                                                        className={`px-3 py-1 rounded text-sm transition-colors ${
                                                            workout.completedToday 
                                                                ? 'bg-gray-600 hover:bg-gray-700 text-white' 
                                                                : 'bg-green-600 hover:bg-green-700 text-white'
                                                        }`}
                                                    >
                                                        {workout.completedToday ? 'Mark Incomplete' : 'Mark Complete'}
                                                    </button>
                                                </div>
                                            </div>
                                            <div className="space-y-1">
                                                {workout.exercises.map((exercise, index) => (
                                                    <p key={index} className="text-sm text-gray-300">‚Ä¢ {exercise}</p>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div className="text-center py-8 text-gray-400">
                                    <div className="text-4xl mb-2">üí™</div>
                                    <p>No workouts available yet</p>
                                    <p className="text-sm">
                                        {hasPermission('assignWorkouts') 
                                            ? 'Create your first workout above!' 
                                            : 'Contact your specialist to get workouts assigned!'
                                        }
                                    </p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Goals Component
            const GoalsComponent = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;
                const [newGoal, setNewGoal] = useState({
                    title: '',
                    target: '',
                    current: '',
                    deadline: '',
                    clientId: selectedClientId || currentUser.id
                });

                const addGoal = () => {
                    if (newGoal.title && newGoal.target) {
                        const goal = {
                            id: Date.now(),
                            title: newGoal.title,
                            target: newGoal.target,
                            current: newGoal.current || '0',
                            deadline: newGoal.deadline,
                            progress: Math.round((parseFloat(newGoal.current) / parseFloat(newGoal.target)) * 100) || 0,
                            assignedBy: currentUser.id,
                            createdDate: new Date().toISOString().split('T')[0]
                        };
                        
                        updateUserData(newGoal.clientId, 'goals', goal);
                        setNewGoal({ 
                            title: '', 
                            target: '', 
                            current: '', 
                            deadline: '',
                            clientId: selectedClientId || currentUser.id
                        });

                        addNotification(`New goal added for ${displayUser.name}! üéØ`);
                    }
                };

                const updateGoalProgress = (goalId, newCurrent) => {
                    const targetId = selectedClientId || currentUser.id;
                    const targetData = getUserData(targetId);
                    const updatedGoals = targetData.goals.map(goal => {
                        if (goal.id === goalId) {
                            const progress = Math.round((parseFloat(newCurrent) / parseFloat(goal.target)) * 100) || 0;
                            return { ...goal, current: newCurrent, progress };
                        }
                        return goal;
                    });
                    globalUserData[targetId] = { ...targetData, goals: updatedGoals };
                    addNotification("Goal progress updated! üéØ");
                };

                return (
                    <div className="space-y-6">
                        {selectedClientId && (
                            <div className="card rounded-xl p-4 bg-green-500/20">
                                <p className="text-center">
                                    üéØ Managing goals for: <strong>{displayUser.name}</strong>
                                    <button
                                        onClick={() => setSelectedClientId(null)}
                                        className="ml-4 bg-gray-500/20 hover:bg-gray-500/30 px-3 py-1 rounded text-sm"
                                    >
                                        ‚Üê Back
                                    </button>
                                </p>
                            </div>
                        )}

                        <div className="card rounded-xl p-6">
                            <h3 className="text-xl font-semibold mb-4">üéØ Add New Goal</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <input
                                    type="text"
                                    placeholder="Goal Title (e.g., Weight Loss Goal)"
                                    value={newGoal.title}
                                    onChange={(e) => setNewGoal({...newGoal, title: e.target.value})}
                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                />
                                <input
                                    type="text"
                                    placeholder="Target (e.g., 150 lbs)"
                                    value={newGoal.target}
                                    onChange={(e) => setNewGoal({...newGoal, target: e.target.value})}
                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                />
                                <input
                                    type="text"
                                    placeholder="Current Progress"
                                    value={newGoal.current}
                                    onChange={(e) => setNewGoal({...newGoal, current: e.target.value})}
                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                />
                                <input
                                    type="date"
                                    value={newGoal.deadline}
                                    onChange={(e) => setNewGoal({...newGoal, deadline: e.target.value})}
                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                />
                            </div>

                            <button
                                onClick={addGoal}
                                className="w-full bg-gradient-to-r from-green-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-green-700 hover:to-blue-700 transition-all duration-300"
                            >
                                ‚ûï Add Goal
                            </button>
                        </div>

                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">üìä Current Goals</h3>
                                <button
                                    onClick={() => exportData(userData.goals, `${displayUser.name.replace(/\s+/g, '_')}_goals`)}
                                    className="bg-green-500/20 hover:bg-green-500/30 px-3 py-1 rounded text-sm transition-colors"
                                >
                                    üìä Export Goals
                                </button>
                            </div>
                            {userData.goals.length > 0 ? (
                                <div className="space-y-4">
                                    {userData.goals.map(goal => (
                                        <div key={goal.id} className="bg-white/5 rounded-lg p-4">
                                            <div className="flex justify-between items-center mb-3">
                                                <div>
                                                    <h4 className="font-medium">{goal.title}</h4>
                                                    {goal.assignedBy && (
                                                        <p className="text-sm text-gray-400">
                                                            Set by: {allUsers.find(u => u.id === goal.assignedBy)?.name || 'Unknown'}
                                                        </p>
                                                    )}
                                                </div>
                                                <span className="text-sm text-gray-400">{goal.progress}%</span>
                                            </div>
                                            <div className="w-full bg-gray-700 rounded-full h-3 mb-3">
                                                <div 
                                                    className="bg-gradient-to-r from-green-500 to-blue-500 h-3 rounded-full transition-all duration-300"
                                                    style={{ width: `${Math.min(goal.progress, 100)}%` }}
                                                ></div>
                                            </div>
                                            <div className="flex justify-between items-center text-sm text-gray-400 mb-2">
                                                <span>Current: {goal.current} / Target: {goal.target}</span>
                                                <span>Due: {goal.deadline}</span>
                                            </div>
                                            <div className="flex gap-2">
                                                <input
                                                    type="text"
                                                    placeholder="Update progress"
                                                    className="flex-1 p-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/50 text-sm focus:border-blue-400 focus:outline-none"
                                                    onKeyPress={(e) => {
                                                        if (e.key === 'Enter' && e.target.value) {
                                                            updateGoalProgress(goal.id, e.target.value);
                                                            e.target.value = '';
                                                        }
                                                    }}
                                                />
                                                <button
                                                    onClick={(e) => {
                                                        const input = e.target.parentElement.querySelector('input');
                                                        if (input && input.value) {
                                                            updateGoalProgress(goal.id, input.value);
                                                            input.value = '';
                                                        }
                                                    }}
                                                    className="bg-blue-500 hover:bg-blue-600 px-3 py-2 rounded text-sm transition-colors"
                                                >
                                                    Update
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div className="text-center py-8 text-gray-400">
                                    <div className="text-4xl mb-2">üéØ</div>
                                    <p>No goals set yet</p>
                                    <p className="text-sm">Add your first goal above to get started!</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Specialized Tests Component
            const SpecializedTestsComponent = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;
                const [newTest, setNewTest] = useState({
                    testName: '',
                    results: '',
                    date: new Date().toISOString().split('T')[0],
                    clientId: selectedClientId || currentUser.id
                });

                const addTest = () => {
                    if (newTest.testName && newTest.results) {
                        const test = {
                            id: Date.now(),
                            testName: newTest.testName,
                            results: newTest.results,
                            date: newTest.date,
                            performedBy: currentUser.id,
                            clientId: newTest.clientId
                        };
                        
                        updateUserData(newTest.clientId, 'specializedTests', test);
                        setNewTest({
                            testName: '',
                            results: '',
                            date: new Date().toISOString().split('T')[0],
                            clientId: selectedClientId || currentUser.id
                        });

                        addNotification(`Specialized test added for ${displayUser.name}! üß™`);
                    }
                };

                return (
                    <div className="space-y-6">
                        {selectedClientId && (
                            <div className="card rounded-xl p-4 bg-cyan-500/20">
                                <p className="text-center">
                                    üß™ Managing tests for: <strong>{displayUser.name}</strong>
                                    <button
                                        onClick={() => setSelectedClientId(null)}
                                        className="ml-4 bg-gray-500/20 hover:bg-gray-500/30 px-3 py-1 rounded text-sm"
                                    >
                                        ‚Üê Back
                                    </button>
                                </p>
                            </div>
                        )}

                        {hasPermission('specializedTests') && (
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">üß™ Add Specialized Test</h3>
                                <div className="space-y-4">
                                    <input
                                        type="date"
                                        value={newTest.date}
                                        onChange={(e) => setNewTest({...newTest, date: e.target.value})}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Test Name (e.g., Body Composition Analysis, VO2 Max Test)"
                                        value={newTest.testName}
                                        onChange={(e) => setNewTest({...newTest, testName: e.target.value})}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <textarea
                                        placeholder="Test Results and Notes"
                                        value={newTest.results}
                                        onChange={(e) => setNewTest({...newTest, results: e.target.value})}
                                        className="w-full p-3 h-32 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none resize-none"
                                    />
                                    
                                    <button
                                        onClick={addTest}
                                        className="w-full bg-gradient-to-r from-cyan-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-cyan-700 hover:to-blue-700 transition-all duration-300"
                                    >
                                        üß™ Add Test Results
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">üìã Test History</h3>
                                <button
                                    onClick={() => exportData(userData.specializedTests, `${displayUser.name.replace(/\s+/g, '_')}_tests`)}
                                    className="bg-green-500/20 hover:bg-green-500/30 px-3 py-1 rounded text-sm transition-colors"
                                >
                                    üìä Export Tests
                                </button>
                            </div>
                            {userData.specializedTests.length > 0 ? (
                                <div className="space-y-4">
                                    {userData.specializedTests.map(test => (
                                        <div key={test.id} className="bg-white/5 rounded-lg p-4">
                                            <div className="flex justify-between items-center mb-2">
                                                <h4 className="font-medium text-lg">{test.testName}</h4>
                                                <span className="text-sm text-gray-400">{new Date(test.date).toLocaleDateString()}</span>
                                            </div>
                                            <p className="text-gray-300 mb-2">{test.results}</p>
                                            <p className="text-sm text-blue-400">
                                                Performed by: {allUsers.find(u => u.id === test.performedBy)?.name || 'Unknown'}
                                            </p>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div className="text-center py-8 text-gray-400">
                                    <div className="text-4xl mb-2">üß™</div>
                                    <p>No specialized tests recorded yet</p>
                                    <p className="text-sm">
                                        {hasPermission('specializedTests') 
                                            ? 'Add your first test above!' 
                                            : 'Tests will appear here when performed by specialists'
                                        }
                                    </p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Engineer Component with REAL editing capabilities
            const EngineerComponent = () => {
                const [appConfig, setAppConfig] = useState({
                    appName: 'Coastal Fitness & Correction',
                    theme: 'coastal-blue',
                    features: {
                        measurements: true,
                        nutrition: true,
                        workouts: true,
                        goals: true,
                        tests: true,
                        chat: true,
                        reports: true
                    },
                    notifications: true,
                    exportEnabled: true,
                    maxMeasurements: 1000,
                    autoBackup: true
                });

                const [customCode, setCustomCode] = useState('// Add custom JavaScript here\nconsole.log("Custom feature loaded!");');

                const updateAppConfig = (key, value) => {
                    setAppConfig(prev => ({
                        ...prev,
                        [key]: value
                    }));
                    addNotification(`App ${key} updated! üîß`);
                };

                const updateFeature = (feature, enabled) => {
                    setAppConfig(prev => ({
                        ...prev,                                                <p className="text-sm text-gray-400">üî• Body Fat</p>
                                                <p className="text-2xl font-bold text-orange-400">{latestMeasurement.bodyFat || 0}%</p>
                                                <p className="text-xs text-gray-400">Current level</p>
                                            </div>
                                            <div className="text-3xl">üìâ</div>
                                        </div>
                                    </div>
                                    
                                    <div className="card rounded-xl p-6 hover:scale-105 transition-transform">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-sm text-gray-400">ü©∫ Blood Pressure</p>
                                                <p className="text-2xl font-bold text-red-400">{latestMeasurement.bloodPressure || 'N/A'}</p>
                                                <p className="text-xs text-gray-400">Latest reading</p>
                                            </div>
                                            <div className="text-3xl">‚ù§Ô∏è</div>
                                        </div>
                                    </div>
                                    
                                    <div className="card rounded-xl p-6 hover:scale-105 transition-transform">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-sm text-gray-400">üìà Total Entries</p>
                                                <p className="text-2xl font-bold text-purple-400">{userData.measurements.length}</p>
                                                <p className="text-xs text-gray-400">Measurements logged</p>
                                            </div>
                                            <div className="text-3xl">üìä</div>
                                        </div>
                                    </div>
                                </div>

                                {/* Client-specific: Assigned Workouts & Nutrition */}
                                {(currentUser.role === 'client' || selectedClientId) && (
                                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <div className="card rounded-xl p-6">
                                            <h3 className="text-xl font-semibold mb-4">üí™ Assigned Workouts</h3>
                                            {assignedWorkouts.length > 0 ? (
                                                <div className="space-y-3">
                                                    {assignedWorkouts.map(workout => (
                                                        <div key={workout.id} className={`p-4 rounded-lg ${
                                                            workout.completedToday ? 'bg-green-500/20 border-l-4 border-green-500' : 'bg-blue-500/20 border-l-4 border-blue-500'
                                                        }`}>
                                                            <div className="flex justify-between items-center mb-2">
                                                                <h4 className="font-medium">{workout.name}</h4>
                                                                <span className={`text-xs px-2 py-1 rounded ${
                                                                    workout.completedToday ? 'bg-green-500 text-white' : 'bg-orange-500 text-white'
                                                                }`}>
                                                                    {workout.completedToday ? '‚úÖ Complete' : '‚è≥ Pending'}
                                                                </span>
                                                            </div>
                                                            <div className="text-sm text-gray-300">
                                                                {workout.exercises.join(' ‚Ä¢ ')}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            ) : (
                                                <div className="text-center py-8 text-gray-400">
                                                    <div className="text-4xl mb-2">üí™</div>
                                                    <p>No workouts assigned yet</p>
                                                    <p className="text-sm">Contact your specialist to get started!</p>
                                                </div>
                                            )}
                                        </div>

                                        <div className="card rounded-xl p-6">
                                            <h3 className="text-xl font-semibold mb-4">ü•ó Nutrition Plan</h3>
                                            {userData.nutritionPlan.assignedBy ? (
                                                <div className="space-y-4">
                                                    <div className="grid grid-cols-2 gap-3">
                                                        <div className="bg-blue-500/20 p-3 rounded">
                                                            <p className="text-xs text-gray-400">Protein</p>
                                                            <p className="text-lg font-bold text-blue-400">
                                                                {userData.nutritionPlan.currentIntake.protein}g / {userData.nutritionPlan.dailyTargets.protein}g
                                                            </p>
                                                        </div>
                                                        <div className="bg-green-500/20 p-3 rounded">
                                                            <p className="text-xs text-gray-400">Carbs</p>
                                                            <p className="text-lg font-bold text-green-400">
                                                                {userData.nutritionPlan.currentIntake.carbs}g / {userData.nutritionPlan.dailyTargets.carbs}g
                                                            </p>
                                                        </div>
                                                        <div className="bg-orange-500/20 p-3 rounded">
                                                            <p className="text-xs text-gray-400">Fat</p>
                                                            <p className="text-lg font-bold text-orange-400">
                                                                {userData.nutritionPlan.currentIntake.fat}g / {userData.nutritionPlan.dailyTargets.fat}g
                                                            </p>
                                                        </div>
                                                        <div className="bg-purple-500/20 p-3 rounded">
                                                            <p className="text-xs text-gray-400">Calories</p>
                                                            <p className="text-lg font-bold text-purple-400">
                                                                {userData.nutritionPlan.currentIntake.calories} / {userData.nutritionPlan.dailyTargets.calories}
                                                            </p>
                                                        </div>
                                                    </div>
                                                    
                                                    {userData.nutritionPlan.mealPlan.length > 0 && (
                                                        <div className="mt-4">
                                                            <h4 className="font-medium mb-2">Today's Meal Plan:</h4>
                                                            <div className="space-y-1 text-sm text-gray-300">
                                                                {userData.nutritionPlan.mealPlan.map((meal, index) => (
                                                                    <p key={index}>‚Ä¢ {meal}</p>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            ) : (
                                                <div className="text-center py-8 text-gray-400">
                                                    <div className="text-4xl mb-2">ü•ó</div>
                                                    <p>No nutrition plan assigned yet</p>
                                                    <p className="text-sm">Contact your specialist to get started!</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}

                                {/* Progress Chart */}
                                <div className="card rounded-xl p-6">
                                    <h3 className="text-xl font-semibold mb-4">üìà Health Progress Tracking</h3>
                                    <div className="chart-container">
                                        <canvas ref={canvasRef}></canvas>
                                    </div>
                                </div>

                                {/* Goals and Tests */}
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div className="card rounded-xl p-6">
                                        <h3 className="text-xl font-semibold mb-4">üéØ Health Goals</h3>
                                        {userData.goals.length > 0 ? (
                                            <div className="space-y-4">
                                                {userData.goals.map(goal => (
                                                    <div key={goal.id} className="bg-white/5 rounded-lg p-4 hover:bg-white/10 transition-colors">
                                                        <div className="flex justify-between items-center mb-2">
                                                            <h4 className="font-medium">{goal.title}</h4>
                                                            <span className="text-sm text-gray-400">{goal.progress}%</span>
                                                        </div>
                                                        <div className="w-full bg-gray-700 rounded-full h-2">
                                                            <div 
                                                                className="bg-gradient-to-r from-blue-500 to-cyan-500 h-2 rounded-full transition-all duration-300"
                                                                style={{ width: `${goal.progress}%` }}
                                                            ></div>
                                                        </div>
                                                        <p className="text-sm text-gray-400 mt-2">
                                                            {goal.current} / {goal.target} ‚Ä¢ Due: {goal.deadline}
                                                        </p>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="text-center py-8 text-gray-400">
                                                <div className="text-4xl mb-2">üéØ</div>
                                                <p>No goals set yet</p>
                                                <p className="text-sm">Set your first health goal to get started!</p>
                                            </div>
                                        )}
                                    </div>

                                    <div className="card rounded-xl p-6">
                                        <h3 className="text-xl font-semibold mb-4">üß™ Specialized Tests</h3>
                                        {userData.specializedTests.length > 0 ? (
                                            <div className="space-y-3">
                                                {userData.specializedTests.map(test => (
                                                    <div key={test.id} className="bg-white/5 p-3 rounded-lg">
                                                        <div className="flex justify-between items-center mb-1">
                                                            <h4 className="font-medium text-sm">{test.testName}</h4>
                                                            <span className="text-xs text-gray-400">{test.date}</span>
                                                        </div>
                                                        <p className="text-sm text-gray-300">{test.results}</p>
                                                        <p className="text-xs text-blue-400 mt-1">
                                                            Performed by: {allUsers.find(u => u.id === test.performedBy)?.name || 'Unknown'}
                                                        </p>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="text-center py-8 text-gray-400">
                                                <div className="text-4xl mb-2">üß™</div>
                                                <p>No specialized tests yet</p>
                                                <p className="text-sm">Tests will appear here when performed</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </>
                        )}

                        {/* Notifications */}
                        {notifications.length > 0 && (
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">üîî Recent Notifications</h3>
                                <div className="space-y-3">
                                    {notifications.slice(0, 5).map(notification => (
                                        <div key={notification.id} className={`p-3 rounded-lg ${
                                            notification.type === 'success' ? 'bg-green-500/20 border-l-4 border-green-500' :
                                            notification.type === 'warning' ? 'bg-yellow-500/20 border-l-4 border-yellow-500' :
                                            'bg-blue-500/20 border-l-4 border-blue-500'
                                        }`}>
                                            <p className="text-sm">{notification.message}</p>
                                            <p className="text-xs text-gray-400 mt-1">{notification.time}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Measurements Component
            const MeasurementsComponent = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;
                const [newMeasurement, setNewMeasurement] = useState({
                    date: new Date().toISOString().split('T')[0],
                    weight: '',
                    bodyFat: '',
                    muscle: '',
                    bmi: '',
                    bloodPressure: '',
                    protein: '',
                    carbs: '',
                    fat: '',
                    calories: ''
                });

                const addMeasurement = () => {
                    if (newMeasurement.weight) {
                        const measurement = {
                            id: Date.now(),
                            date: newMeasurement.date,
                            weight: parseFloat(newMeasurement.weight),
                            bodyFat: parseFloat(newMeasurement.bodyFat) || 0,
                            muscle: parseFloat(newMeasurement.muscle) || 0,
                            bmi: parseFloat(newMeasurement.bmi) || 0,
                            bloodPressure: newMeasurement.bloodPressure || '',
                            protein: parseFloat(newMeasurement.protein) || 0,
                            carbs: parseFloat(newMeasurement.carbs) || 0,
                            fat: parseFloat(newMeasurement.fat) || 0,
                            calories: parseFloat(newMeasurement.calories) || 0,
                            enteredBy: currentUser.id
                        };
                        
                        updateUserData(selectedClientId || currentUser.id, 'measurements', measurement);
                        setNewMeasurement({
                            date: new Date().toISOString().split('T')[0],
                            weight: '',
                            bodyFat: '',
                            muscle: '',
                            bmi: '',
                            bloodPressure: '',
                            protein: '',
                            carbs: '',
                            fat: '',
                            calories: ''
                        });

                        addNotification(`Measurement added for ${displayUser.name}! üìä`);
                    }
                };

                return (
                    <div className="space-y-6">
                        {selectedClientId && (
                            <div className="card rounded-xl p-4 bg-blue-500/20">
                                <p className="text-center">
                                    üìä Adding measurement for: <strong>{displayUser.name}</strong>
                                    <button
                                        onClick={() => setSelectedClientId(null)}
                                        className="ml-4 bg-gray-500/20 hover:bg-gray-500/30 px-3 py-1 rounded text-sm"
                                    >
                                        ‚Üê Back
                                    </button>
                                </p>
                            </div>
                        )}

                        <div className="card rounded-xl p-6">
                            <h3 className="text-xl font-semibold mb-4">üìã Add New Measurement & Nutrition Log</h3>
                            
                            {/* Body Measurements */}
                            <div className="mb-6">
                                <h4 className="text-lg font-medium mb-3">Body Measurements</h4>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <input
                                        type="date"
                                        value={newMeasurement.date}
                                        onChange={(e) => setNewMeasurement({...newMeasurement, date: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Weight (lbs) *"
                                        value={newMeasurement.weight}
                                        onChange={(e) => setNewMeasurement({...newMeasurement, weight: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                        required
                                    />
                                    <input
                                        type="number"
                                        placeholder="Body Fat %"
                                        value={newMeasurement.bodyFat}
                                        onChange={(e) => setNewMeasurement({...newMeasurement, bodyFat: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Muscle Mass (lbs)"
                                        value={newMeasurement.muscle}
                                        onChange={(e) => setNewMeasurement({...newMeasurement, muscle: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="number"
                                        placeholder="BMI"
                                        value={newMeasurement.bmi}
                                        onChange={(e) => setNewMeasurement({...newMeasurement, bmi: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Blood Pressure"
                                        value={newMeasurement.bloodPressure}
                                        onChange={(e) => setNewMeasurement({...newMeasurement, bloodPressure: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                </div>
                            </div>

                            {/* Nutrition Logging */}
                            <div className="mb-6">
                                <h4 className="text-lg font-medium mb-3">Nutrition Intake (Optional)</h4>
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <input
                                        type="number"
                                        placeholder="Protein (g)"
                                        value={newMeasurement.protein}
                                        onChange={(e) => setNewMeasurement({...newMeasurement, protein: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Carbs (g)"
                                        value={newMeasurement.carbs}
                                        onChange={(e) => setNewMeasurement({...newMeasurement, carbs: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Fat (g)"
                                        value={newMeasurement.fat}
                                        onChange={(e) => setNewMeasurement({...newMeasurement, fat: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Calories"
                                        value={newMeasurement.calories}
                                        onChange={(e) => setNewMeasurement({...newMeasurement, calories: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                </div>
                            </div>

                            <button
                                onClick={addMeasurement}
                                className="w-full bg-gradient-to-r from-blue-600 to-cyan-500 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-cyan-600 transition-all duration-300"
                            >
                                ‚ûï Add Measurement
                            </button>
                        </div>

                        {/* Measurements History */}
                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">üìà Measurement History</h3>
                                <button
                                    onClick={() => exportData(userData.measurements, `${displayUser.name.replace(/\s+/g, '_')}_measurements`)}
                                    className="bg-green-500/20 hover:bg-green-500/30 px-3 py-1 rounded text-sm transition-colors"
                                >
                                    üìä Export Data
                                </button>
                            </div>
                            {userData.measurements.length > 0 ? (
                                <div className="table-container">
                                    <table className="w-full text-sm">
                                        <thead>
                                            <tr className="border-b border-gray-700">
                                                <th className="text-left p-2">Date</th>
                                                <th className="text-left p-2">Weight</th>
                                                <th className="text-left p-2">Body Fat</th>
                                                <th className="text-left p-2">Muscle</th>
                                                <th className="text-left p-2">BMI</th>
                                                <th className="text-left p-2">BP</th>
                                                <th className="text-left p-2">Protein</th>
                                                <th className="text-left p-2">Carbs</th>
                                                <th className="text-left p-2">Fat</th>
                                                <th className="text-left p-2">Calories</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {userData.measurements.map((measurement, index) => (
                                                <tr key={index} className="border-b border-gray-800 hover:bg-white/5">
                                                    <td className="p-2">{new Date(measurement.date).toLocaleDateString()}</td>
                                                    <td className="p-2">{measurement.weight} lbs</td>
                                                    <td className="p-2">{measurement.bodyFat}%</td>
                                                    <td className="p-2">{measurement.muscle} lbs</td>
                                                    <td className="p-2">{measurement.bmi}</td>
                                                    <td className="p-2">{measurement.bloodPressure}</td>
                                                    <td className="p-2">{measurement.protein}g</td>
                                                    <td className="p-2">{measurement.carbs}g</td>
                                                    <td className="p-2">{measurement.fat}g</td>
                                                    <td className="p-2">{measurement.calories}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            ) : (
                                <div className="text-center py-8 text-gray-400">
                                    <div className="text-4xl mb-2">üìè</div>
                                    <p>No measurements recorded yet</p>
                                    <p className="text-sm">Add your first measurement above to get started!</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Users Management Component
            const UsersComponent = () => {
                const [editingUser, setEditingUser] = useState(null);

                const updateUserRole = (userId, newRole) => {
                    setAllUsers(users => users.map(user => 
                        user.id === userId ? { ...user, role: newRole } : user
                    ));
                    addNotification(`User role updated to ${newRole}! üë•`);
                };

                const assignSpecialistToClient = (clientId, specialistId) => {
                    setAllUsers(users => users.map(user => 
                        user.id === clientId ? { ...user, specialistId } : user
                    ));
                    addNotification("Specialist assigned successfully! üë©‚Äç‚öïÔ∏è");
                };

                const getFilteredUsers = () => {
                    if (currentUser.role === 'specialist') {
                        return allUsers.filter(user => 
                            user.role === 'client' && 
                            (user.specialistId === currentUser.id || user.specialistId === null)
                        );
                    }
                    return allUsers;
                };

                const canEditUser = (user) => {
                    if (currentUser.role === 'owner') return true;
                    if (currentUser.role === 'admin' && user.role !== 'owner') return true;
                    if (currentUser.role === 'specialist' && user.role === 'client') return true;
                    return false;
                };

                return (
                    <div className="space-y-6">
                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">üë• User Management</h3>
                                <button
                                    onClick={() => exportData(allUsers, 'users_list')}
                                    className="bg-green-500/20 hover:bg-green-500/30 px-3 py-1 rounded text-sm transition-colors"
                                >
                                    üìä Export Users
                                </button>
                            </div>
                            
                            <div className="table-container">
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr className="border-b border-gray-700">
                                            <th className="text-left p-3">User</th>
                                            <th className="text-left p-3">Role</th>
                                            <th className="text-left p-3">Email</th>
                                            <th className="text-left p-3">Specialist</th>
                                            <th className="text-left p-3">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {getFilteredUsers().map(user => (
                                            <tr key={user.id} className="border-b border-gray-800 hover:bg-white/5">
                                                <td className="p-3">
                                                    <div className="flex items-center space-x-3">
                                                        <span className="text-2xl">{user.avatar}</span>
                                                        <span className="font-medium">{user.name}</span>
                                                    </div>
                                                </td>
                                                <td className="p-3">
                                                    <RoleBadge role={user.role} />
                                                </td>
                                                <td className="p-3 text-gray-400">{user.email}</td>
                                                <td className="p-3">
                                                    {user.role === 'client' && (
                                                        <div>
                                                            {user.specialistId ? (
                                                                <span className="text-green-400">
                                                                    {allUsers.find(u => u.id === user.specialistId)?.name || 'Unknown'}
                                                                </span>
                                                            ) : (
                                                                <span className="text-orange-400">Unassigned</span>
                                                            )}
                                                        </div>
                                                    )}
                                                </td>
                                                <td className="p-3">
                                                    {canEditUser(user) && (
                                                        <div className="flex space-x-2">
                                                            {user.role === 'client' && (
                                                                <>
                                                                    <button
                                                                        onClick={() => setSelectedClientId(user.id)}
                                                                        className="bg-blue-500/20 hover:bg-blue-500/30 px-2 py-1 rounded text-xs"
                                                                    >
                                                                        View Data
                                                                    </button>
                                                                    
                                                                    {hasPermission('assignSpecialist') && (
                                                                        <select
                                                                            value={user.specialistId || ''}
                                                                            onChange={(e) => assignSpecialistToClient(user.id, e.target.value)}
                                                                            className="bg-white/10 border border-white/20 rounded px-2 py-1 text-xs"
                                                                        >
                                                                            <option value="">No Specialist</option>
                                                                            {allUsers.filter(u => u.role === 'specialist').map(specialist => (
                                                                                <option key={specialist.id} value={specialist.id}>
                                                                                    {specialist.name}
                                                                                </option>
                                                                            ))}
                                                                        </select>
                                                                    )}
                                                                </>
                                                            )}
                                                            
                                                            {(currentUser.role === 'owner' || currentUser.role === 'admin') && (
                                                                <select
                                                                    value={user.role}
                                                                    onChange={(e) => updateUserRole(user.id, e.target.value)}
                                                                    className="bg-white/10 border border-white/20 rounded px-2 py-1 text-xs"
                                                                >
                                                                    <option value="client">Client</option>
                                                                    <option value="specialist">Specialist</option>
                                                                    {currentUser<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåä Coastal Fitness & Correction - Revolutionary Health Platform</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .gradient-bg { background: linear-gradient(135deg, #1e40af 0%, #0ea5e9 50%, #06b6d4 100%); }
        .card { background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease; }
        .card:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .float { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        .glow { box-shadow: 0 0 20px rgba(30, 64, 175, 0.3); }
        .chart-container { position: relative; height: 300px; }
        .logo-text { color: #1e40af; font-weight: 700; font-size: 1.8rem; }
        .logo-subtext { color: #64748b; font-size: 0.75rem; letter-spacing: 2px; }
        .coastal-wave { 
            background: linear-gradient(45deg, #1e40af, #0ea5e9, #06b6d4);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            animation: float 3s ease-in-out infinite;
        }
        .role-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 600;
        }
        .client-badge { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .specialist-badge { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .admin-badge { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .owner-badge { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
        .engineer-badge { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .modal { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background: rgba(0,0,0,0.7); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            z-index: 1000;
        }
        .table-container { max-height: 400px; overflow-y: auto; }
        .feature-editor {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
        }
        .editable-field {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 0.5rem;
            border-radius: 4px;
            color: white;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-900 text-white overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Global state management
        let globalUserDatabase = [];
        let globalUserData = {};

        // Demo accounts with SAMPLE data only
        const demoAccounts = {
            'john.anderson@example.com': { 
                password: 'password123', 
                role: 'client', 
                name: 'John Anderson', 
                avatar: 'üèÉ‚Äç‚ôÇÔ∏è',
                id: 'client_demo_001',
                specialistId: 'specialist_demo_001'
            },
            'sarah.mitchell@coastal.com': { 
                password: 'specialist123', 
                role: 'specialist', 
                name: 'Dr. Sarah Mitchell', 
                avatar: 'ü©∫',
                id: 'specialist_demo_001'
            },
            'admin@coastal.com': { 
                password: 'admin123', 
                role: 'admin', 
                name: 'Admin User', 
                avatar: '‚öôÔ∏è',
                id: 'admin_demo_001'
            },
            'tanya@coastal.com': { 
                password: 'owner123', 
                role: 'owner', 
                name: 'Tanya (Owner)', 
                avatar: 'üèÜ',
                id: 'owner_demo_001'
            },
            'josh.lerner@coastal.com': { 
                password: 'engineer123', 
                role: 'engineer', 
                name: 'Dr. Josh Lerner', 
                avatar: 'üîß',
                id: 'engineer_demo_001'
            }
        };

        // Sample data ONLY for demo accounts
        const demoUserData = {
            'client_demo_001': {
                measurements: [
                    { date: '2024-01-15', weight: 165, bodyFat: 18.2, muscle: 142, bmi: 24.1, bloodPressure: '120/80', protein: 120, carbs: 200, fat: 65, calories: 1850 },
                    { date: '2024-02-15', weight: 163, bodyFat: 17.8, muscle: 144, bmi: 23.8, bloodPressure: '118/78', protein: 125, carbs: 185, fat: 60, calories: 1800 }
                ],
                goals: [
                    { id: 1, title: 'üéØ Weight Loss Goal', target: '155 lbs', current: '163 lbs', progress: 80, deadline: '2024-06-30', assignedBy: 'specialist_demo_001' }
                ],
                workouts: [
                    { id: 1, name: 'Upper Body Strength', exercises: ['Push-ups x15', 'Pull-ups x8', 'Bench Press x12'], assigned: true, completedToday: false, assignedBy: 'specialist_demo_001' }
                ],
                nutritionPlan: {
                    dailyTargets: { protein: 150, carbs: 180, fat: 55, calories: 1750 },
                    currentIntake: { protein: 125, carbs: 185, fat: 60, calories: 1800 },
                    mealPlan: ['Breakfast: Oatmeal with berries', 'Lunch: Grilled chicken salad'],
                    assignedBy: 'specialist_demo_001'
                },
                specializedTests: [
                    { id: 1, testName: 'Body Composition Analysis', date: '2024-01-15', results: 'Body fat: 18.2%, Muscle mass: 142lbs', performedBy: 'specialist_demo_001' }
                ]
            }
        };

        // Initialize user data helper
        const initializeUserData = (userId) => {
            if (!globalUserData[userId]) {
                globalUserData[userId] = {
                    measurements: [],
                    goals: [],
                    workouts: [],
                    nutritionPlan: {
                        dailyTargets: { protein: 0, carbs: 0, fat: 0, calories: 0 },
                        currentIntake: { protein: 0, carbs: 0, fat: 0, calories: 0 },
                        mealPlan: [],
                        assignedBy: null
                    },
                    specializedTests: []
                };
            }
        };

        // Get user data helper
        const getUserData = (userId) => {
            // For demo accounts, return sample data
            if (demoUserData[userId]) {
                return demoUserData[userId];
            }
            // For new users, ensure initialized and return empty data
            initializeUserData(userId);
            return globalUserData[userId];
        };

        // Update user data helper
        const updateUserData = (userId, dataType, newData) => {
            initializeUserData(userId);
            if (Array.isArray(globalUserData[userId][dataType])) {
                globalUserData[userId][dataType] = [...globalUserData[userId][dataType], newData];
            } else {
                globalUserData[userId][dataType] = { ...globalUserData[userId][dataType], ...newData };
            }
        };

        // Export data helper
        const exportData = (data, filename) => {
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        };

        // Logo Component
        const CoastalLogo = ({ size = 'large' }) => {
            const isLarge = size === 'large';
            return (
                <div className="flex items-center space-x-3">
                    <div className={`coastal-wave ${isLarge ? 'w-16 h-16 text-3xl' : 'w-12 h-12 text-xl'}`}>
                        üåä
                    </div>
                    <div className="flex flex-col">
                        <div className={`logo-text ${isLarge ? 'text-3xl' : 'text-xl'}`}>
                            COASTAL
                        </div>
                        <div className={`logo-subtext ${isLarge ? 'text-sm' : 'text-xs'}`}>
                            FITNESS AND CORRECTION
                        </div>
                    </div>
                </div>
            );
        };

        // Role Badge Component
        const RoleBadge = ({ role }) => {
            const badgeClass = `role-badge ${role}-badge`;
            const roleIcons = {
                client: 'üë§',
                specialist: 'üë©‚Äç‚öïÔ∏è',
                admin: 'üõ°Ô∏è',
                owner: 'üëë',
                engineer: 'üë®‚Äçüíª'
            };
            
            return (
                <span className={badgeClass}>
                    {roleIcons[role]} {role.charAt(0).toUpperCase() + role.slice(1)}
                </span>
            );
        };

        // Main App Component
        const App = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [allUsers, setAllUsers] = useState(Object.values(demoAccounts));
            const [selectedClientId, setSelectedClientId] = useState(null);
            const [notifications, setNotifications] = useState([]);
            const [chatMessages, setChatMessages] = useState([]);
            const [currentMessage, setCurrentMessage] = useState('');
            const [showModal, setShowModal] = useState(false);
            const [modalType, setModalType] = useState('');
            const [editingFeature, setEditingFeature] = useState(null);

            // Permission system
            const hasPermission = (action) => {
                if (!currentUser) return false;
                
                const permissions = {
                    client: ['viewOwnData', 'logOwnData', 'chat'],
                    specialist: ['viewClients', 'assignWorkouts', 'assignNutrition', 'logClientData', 'chat', 'specializedTests'],
                    admin: ['viewAllUsers', 'assignSpecialist', 'manageUsers', 'logClientData', 'chat', 'specializedTests', 'assignWorkouts', 'assignNutrition'],
                    owner: ['all'],
                    engineer: ['all', 'customize', 'systemManagement']
                };
                
                return permissions[currentUser?.role]?.includes(action) || permissions[currentUser?.role]?.includes('all');
            };

            // Add notification helper
            const addNotification = (message, type = 'success') => {
                setNotifications(prev => [{
                    id: Date.now(),
                    message,
                    type,
                    time: 'Just now'
                }, ...prev]);
            };

            // Login Component
            const LoginForm = () => {
                const [email, setEmail] = useState('');
                const [password, setPassword] = useState('');
                const [name, setName] = useState('');
                const [error, setError] = useState('');
                const [loading, setLoading] = useState(false);
                const [isSignup, setIsSignup] = useState(false);

                const handleAuth = async (e) => {
                    e.preventDefault();
                    setLoading(true);
                    
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    if (isSignup) {
                        // Create new client account with empty data
                        const newUser = {
                            id: `client_${Date.now()}`,
                            email,
                            name: name || email.split('@')[0],
                            role: 'client',
                            avatar: 'üë§',
                            specialistId: null
                        };
                        
                        setAllUsers(prev => [...prev, newUser]);
                        setCurrentUser(newUser);
                        initializeUserData(newUser.id); // Initialize with empty data
                        addNotification(`Welcome ${newUser.name}! Your health journey starts now. üåä`);
                        setError('');
                    } else {
                        const account = demoAccounts[email];
                        if (account && account.password === password) {
                            setCurrentUser({ ...account, email });
                            addNotification(`Welcome back, ${account.name}! üëã`);
                            setError('');
                        } else {
                            setError('‚ùå Invalid credentials');
                        }
                    }
                    setLoading(false);
                };

                return (
                    <div className="min-h-screen gradient-bg flex items-center justify-center p-4">
                        <div className="glass rounded-3xl p-8 max-w-md w-full float">
                            <div className="text-center mb-8">
                                <div className="flex justify-center mb-4">
                                    <CoastalLogo size="large" />
                                </div>
                                <p className="text-xl text-blue-200">Revolutionary Health Platform</p>
                            </div>
                            
                            <div className="flex mb-6">
                                <button
                                    onClick={() => setIsSignup(false)}
                                    className={`flex-1 py-2 rounded-l-lg transition-colors ${!isSignup ? 'bg-blue-500 text-white' : 'bg-white/10 text-gray-300'}`}
                                >
                                    Login
                                </button>
                                <button
                                    onClick={() => setIsSignup(true)}
                                    className={`flex-1 py-2 rounded-r-lg transition-colors ${isSignup ? 'bg-blue-500 text-white' : 'bg-white/10 text-gray-300'}`}
                                >
                                    Sign Up
                                </button>
                            </div>
                            
                            <form onSubmit={handleAuth} className="space-y-6">
                                {isSignup && (
                                    <div>
                                        <label className="block text-sm font-medium mb-2">üë§ Full Name</label>
                                        <input
                                            type="text"
                                            value={name}
                                            onChange={(e) => setName(e.target.value)}
                                            className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none transition-colors"
                                            placeholder="Enter your full name"
                                            required
                                        />
                                    </div>
                                )}
                                
                                <div>
                                    <label className="block text-sm font-medium mb-2">üìß Email</label>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none transition-colors"
                                        placeholder="Enter your email"
                                        required
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium mb-2">üîí Password</label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none transition-colors"
                                        placeholder="Enter your password"
                                        required
                                    />
                                </div>
                                
                                {error && <p className="text-red-300 text-sm">{error}</p>}
                                
                                <button
                                    type="submit"
                                    disabled={loading}
                                    className="w-full bg-gradient-to-r from-blue-600 to-cyan-500 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-cyan-600 transition-all duration-300 glow disabled:opacity-50"
                                >
                                    {loading ? 'üîÑ Processing...' : (isSignup ? 'üöÄ Start Your Journey' : 'üöÄ Login')}
                                </button>
                            </form>
                            
                            {!isSignup && (
                                <div className="mt-8 text-sm text-center">
                                    <p className="text-blue-200 mb-2">üéÆ Demo Accounts:</p>
                                    <div className="space-y-1 text-xs">
                                        <p>üë§ Client: john.anderson@example.com / password123</p>
                                        <p>üë©‚Äç‚öïÔ∏è Specialist: sarah.mitchell@coastal.com / specialist123</p>
                                        <p>üõ°Ô∏è Admin: admin@coastal.com / admin123</p>
                                        <p>üëë Owner: tanya@coastal.com / owner123</p>
                                        <p>üë®‚Äçüíª Engineer: josh.lerner@coastal.com / engineer123</p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Navigation Component
            const Navigation = () => {
                const getTabsForRole = () => {
                    const baseTabs = [
                        { id: 'dashboard', label: 'üìä Dashboard', icon: 'üìä' }
                    ];

                    if (hasPermission('viewOwnData') || hasPermission('viewClients')) {
                        baseTabs.push(
                            { id: 'measurements', label: 'üìè Measurements', icon: 'üìè' },
                            { id: 'nutrition', label: 'ü•ó Nutrition', icon: 'ü•ó' },
                            { id: 'workouts', label: 'üí™ Workouts', icon: 'üí™' },
                            { id: 'goals', label: 'üéØ Goals', icon: 'üéØ' }
                        );
                    }

                    if (hasPermission('specializedTests')) {
                        baseTabs.push({ id: 'tests', label: 'üß™ Tests', icon: 'üß™' });
                    }

                    if (hasPermission('chat')) {
                        baseTabs.push({ id: 'chat', label: 'üí¨ Chat', icon: 'üí¨' });
                    }

                    if (hasPermission('viewAllUsers') || hasPermission('viewClients')) {
                        baseTabs.push({ id: 'users', label: 'üë• Users', icon: 'üë•' });
                    }
                    
                    if (hasPermission('customize')) {
                        baseTabs.push({ id: 'engineer', label: 'üîß Engineer', icon: 'üîß' });
                    }

                    baseTabs.push({ id: 'reports', label: 'üìà Reports', icon: 'üìà' });
                    
                    return baseTabs;
                };

                return (
                    <nav className="card rounded-xl p-4 mb-6">
                        <div className="flex justify-between items-center mb-4">
                            <CoastalLogo size="small" />
                            <div className="flex items-center space-x-4">
                                <div className="flex items-center space-x-2">
                                    <span className="text-sm text-gray-300">Welcome, {currentUser.name}</span>
                                    <RoleBadge role={currentUser.role} />
                                </div>
                                <button
                                    onClick={() => exportData(getUserData(currentUser.id), `${currentUser.name.replace(/\s+/g, '_')}_health_data`)}
                                    className="bg-green-500/20 hover:bg-green-500/30 px-3 py-2 rounded-lg text-sm transition-colors"
                                >
                                    üìä Export My Data
                                </button>
                                <button 
                                    onClick={() => setCurrentUser(null)}
                                    className="bg-red-500/20 hover:bg-red-500/30 px-4 py-2 rounded-lg text-sm transition-colors"
                                >
                                    üö™ Logout
                                </button>
                            </div>
                        </div>
                        <div className="flex flex-wrap gap-2">
                            {getTabsForRole().map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${
                                        activeTab === tab.id 
                                            ? 'bg-blue-500 text-white shadow-lg' 
                                            : 'bg-white/10 text-gray-300 hover:bg-white/20'
                                    }`}
                                >
                                    {tab.icon} {tab.label}
                                </button>
                            ))}
                        </div>
                    </nav>
                );
            };

            // Dashboard Component
            const Dashboard = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;
                const canvasRef = useRef(null);
                const chartRef = useRef(null);

                useEffect(() => {
                    if (canvasRef.current && userData.measurements.length > 0) {
                        if (chartRef.current) {
                            chartRef.current.destroy();
                        }
                        
                        const ctx = canvasRef.current.getContext('2d');
                        chartRef.current = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: userData.measurements.map(m => new Date(m.date).toLocaleDateString()),
                                datasets: [
                                    {
                                        label: 'Weight (lbs)',
                                        data: userData.measurements.map(m => m.weight),
                                        borderColor: '#0ea5e9',
                                        backgroundColor: 'rgba(14, 165, 233, 0.1)',
                                        tension: 0.4,
                                        fill: true
                                    },
                                    {
                                        label: 'Body Fat %',
                                        data: userData.measurements.map(m => m.bodyFat || 0),
                                        borderColor: '#f59e0b',
                                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                        tension: 0.4,
                                        fill: true
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { 
                                    legend: { 
                                        labels: { color: '#fff' } 
                                    }
                                },
                                scales: {
                                    x: { 
                                        ticks: { color: '#fff' },
                                        grid: { color: 'rgba(255,255,255,0.1)' }
                                    },
                                    y: { 
                                        ticks: { color: '#fff' },
                                        grid: { color: 'rgba(255,255,255,0.1)' }
                                    }
                                }
                            }
                        });
                    }

                    return () => {
                        if (chartRef.current) {
                            chartRef.current.destroy();
                        }
                    };
                }, [userData.measurements]);

                const latestMeasurement = userData.measurements[userData.measurements.length - 1];
                const assignedWorkouts = userData.workouts.filter(w => w.assigned);

                return (
                    <div className="space-y-6">
                        {/* Welcome Banner */}
                        <div className="card rounded-xl p-6 bg-gradient-to-r from-blue-500/20 to-cyan-500/20">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-4">
                                    <div className="text-4xl pulse">{displayUser.avatar}</div>
                                    <div>
                                        <h2 className="text-2xl font-bold">
                                            {selectedClientId ? `Viewing: ${displayUser.name}` : `Welcome back, ${displayUser.name}!`}
                                        </h2>
                                        <p className="text-blue-200">
                                            {userData.measurements.length > 0 
                                                ? 'Your health journey continues today' 
                                                : 'Ready to start your health journey? Add your first measurement!'
                                            }
                                        </p>
                                    </div>
                                </div>
                                {selectedClientId && (
                                    <button
                                        onClick={() => setSelectedClientId(null)}
                                        className="bg-gray-500/20 hover:bg-gray-500/30 px-4 py-2 rounded-lg text-sm transition-colors"
                                    >
                                        ‚Üê Back to My Dashboard
                                    </button>
                                )}
                            </div>
                        </div>

                        {userData.measurements.length === 0 ? (
                            // New user experience
                            <div className="card rounded-xl p-8 text-center">
                                <div className="text-6xl mb-4">üåä</div>
                                <h3 className="text-2xl font-bold mb-4">Start Your Health Journey!</h3>
                                <p className="text-gray-300 mb-6">
                                    Welcome to Coastal Fitness & Correction. Let's begin by tracking your first measurement.
                                </p>
                                <button
                                    onClick={() => setActiveTab('measurements')}
                                    className="bg-gradient-to-r from-blue-600 to-cyan-500 text-white px-8 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-cyan-600 transition-all duration-300"
                                >
                                    üìè Add First Measurement
                                </button>
                            </div>
                        ) : (
                            <>
                                {/* Key Metrics */}
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                    <div className="card rounded-xl p-6 hover:scale-105 transition-transform">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-sm text-gray-400">üìä Current Weight</p>
                                                <p className="text-2xl font-bold text-blue-400">{latestMeasurement.weight} lbs</p>
                                                <p className="text-xs text-green-400">Latest measurement</p>
                                            </div>
                                            <div className="text-3xl">‚öñÔ∏è</div>
                                        </div>
                                    </div>
                                    
                                    <div className="card rounded-xl p-6 hover:scale-105 transition-transform">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-sm text-gray-