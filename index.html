<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒŠ Coastal Fitness & Correction - Revolutionary Health Platform</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e40af">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .gradient-bg { background: linear-gradient(135deg, #1e40af 0%, #0ea5e9 50%, #06b6d4 100%); }
        .card { background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease; }
        .card:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .float { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        .glow { box-shadow: 0 0 20px rgba(30, 64, 175, 0.3); }
        .chart-container { position: relative; height: 300px; }
        .logo-text { color: #1e40af; font-weight: 700; font-size: 1.8rem; }
        .logo-subtext { color: #64748b; font-size: 0.75rem; letter-spacing: 2px; }
        .coastal-wave { 
            background: linear-gradient(45deg, #1e40af, #0ea5e9, #06b6d4);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            animation: float 3s ease-in-out infinite;
        }
        .role-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 600;
        }
        .client-badge { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .specialist-badge { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .admin-badge { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .owner-badge { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
        .engineer-badge { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .modal { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background: rgba(0,0,0,0.7); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            z-index: 1000;
        }
        .table-container { max-height: 400px; overflow-y: auto; }
        .feature-editor {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
        }
        .editable-field {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 0.5rem;
            border-radius: 4px;
            color: white;
            width: 100%;
        }
        .zoom-button {
            background: linear-gradient(45deg, #2D8CFF, #0B5CFF);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        .zoom-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(11, 92, 255, 0.4);
        }
    </style>
</head>
<body class="bg-gray-900 text-white overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Global state management - REAL persistent data
        let globalUserDatabase = JSON.parse(localStorage.getItem('coastalFitnessUsers') || '[]');
        let globalUserData = JSON.parse(localStorage.getItem('coastalFitnessData') || '{}');
        let globalAppConfig = JSON.parse(localStorage.getItem('coastalFitnessConfig') || '{}');

        // Save to localStorage helper
        const saveToStorage = () => {
            localStorage.setItem('coastalFitnessUsers', JSON.stringify(globalUserDatabase));
            localStorage.setItem('coastalFitnessData', JSON.stringify(globalUserData));
            localStorage.setItem('coastalFitnessConfig', JSON.stringify(globalAppConfig));
        };

        // Demo accounts - ONLY these have pre-populated data
        const demoAccounts = {
            'john.anderson@example.com': { 
                password: 'password123', 
                role: 'client', 
                name: 'John Anderson', 
                avatar: 'ğŸƒâ€â™‚ï¸',
                id: 'client_demo_001',
                specialistIds: ['specialist_demo_001']
            },
            'sarah.mitchell@coastal.com': { 
                password: 'specialist123', 
                role: 'specialist', 
                name: 'Dr. Sarah Mitchell', 
                avatar: 'ğŸ©º',
                id: 'specialist_demo_001'
            },
            'admin@coastal.com': { 
                password: 'admin123', 
                role: 'admin', 
                name: 'Admin User', 
                avatar: 'âš™ï¸',
                id: 'admin_demo_001'
            },
            'tanya@coastal.com': { 
                password: 'owner123', 
                role: 'owner', 
                name: 'Tanya (Owner)', 
                avatar: 'ğŸ‘‘',
                id: 'owner_demo_001'
            },
            'josh.lerner@coastal.com': { 
                password: 'engineer123', 
                role: 'engineer', 
                name: 'Dr. Josh Lerner', 
                avatar: 'ğŸ”§',
                id: 'engineer_demo_001'
            }
        };

        // Sample data ONLY for demo client account
        const demoUserData = {
            'client_demo_001': {
                measurements: [
                    { id: 1, date: '2024-01-15', weight: 165, bodyFat: 18.2, muscle: 142, bmi: 24.1, bloodPressure: '120/80', protein: 120, carbs: 200, fat: 65, calories: 1850, type: 'basic' },
                    { id: 2, date: '2024-02-15', weight: 163, bodyFat: 17.8, muscle: 144, bmi: 23.8, bloodPressure: '118/78', protein: 125, carbs: 185, fat: 60, calories: 1800, type: 'basic' }
                ],
                goals: [
                    { id: 1, title: 'ğŸ¯ Weight Loss Goal', target: '155 lbs', current: '163 lbs', progress: 80, deadline: '2024-06-30', assignedBy: 'specialist_demo_001', createdDate: '2024-01-15' }
                ],
                workouts: [
                    { id: 1, name: 'Upper Body Strength', exercises: ['Push-ups x15', 'Pull-ups x8', 'Bench Press x12'], assigned: true, completedToday: false, assignedBy: 'specialist_demo_001', clientId: 'client_demo_001' }
                ],
                nutritionPlan: {
                    dailyTargets: { protein: 150, carbs: 180, fat: 55, calories: 1750 },
                    currentIntake: { protein: 125, carbs: 185, fat: 60, calories: 1800 },
                    mealPlan: ['Breakfast: Oatmeal with berries', 'Lunch: Grilled chicken salad', 'Dinner: Salmon with vegetables'],
                    assignedBy: 'specialist_demo_001',
                    assignedDate: '2024-01-15'
                },
                specializedTests: [
                    { id: 1, testName: 'Body Composition Analysis', date: '2024-01-15', results: 'Body fat: 18.2%, Muscle mass: 142lbs, Bone density: Normal', performedBy: 'specialist_demo_001' }
                ]
            }
        };

        // Initialize demo data on first load
        if (globalUserDatabase.length === 0) {
            globalUserDatabase = Object.values(demoAccounts);
            globalUserData = demoUserData;
            saveToStorage();
        }

        // Initialize user data helper - NEW users get EMPTY data
        const initializeUserData = (userId) => {
            if (!globalUserData[userId]) {
                globalUserData[userId] = {
                    measurements: [],
                    goals: [],
                    workouts: [],
                    nutritionPlan: {
                        dailyTargets: { protein: 0, carbs: 0, fat: 0, calories: 0 },
                        currentIntake: { protein: 0, carbs: 0, fat: 0, calories: 0 },
                        mealPlan: [],
                        assignedBy: null,
                        assignedDate: null
                    },
                    specializedTests: []
                };
                saveToStorage();
            }
        };

        // Get user data helper
        const getUserData = (userId) => {
            if (!globalUserData[userId]) {
                initializeUserData(userId);
            }
            return globalUserData[userId];
        };

        // Update user data helper
        const updateUserData = (userId, dataType, newData) => {
            initializeUserData(userId);
            if (Array.isArray(globalUserData[userId][dataType])) {
                globalUserData[userId][dataType] = [...globalUserData[userId][dataType], newData];
            } else {
                globalUserData[userId][dataType] = { ...globalUserData[userId][dataType], ...newData };
            }
            saveToStorage();
        };

        // Delete user data helper
        const deleteUserData = (userId, dataType, itemId) => {
            if (globalUserData[userId] && Array.isArray(globalUserData[userId][dataType])) {
                globalUserData[userId][dataType] = globalUserData[userId][dataType].filter(item => item.id !== itemId);
                saveToStorage();
            }
        };

        // Export data helper
        const exportData = (data, filename) => {
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        };

        // Logo Component
        const CoastalLogo = ({ size = 'large' }) => {
            const isLarge = size === 'large';
            return (
                <div className="flex items-center space-x-3">
                    <div className={`coastal-wave ${isLarge ? 'w-16 h-16 text-3xl' : 'w-12 h-12 text-xl'}`}>
                        ğŸŒŠ
                    </div>
                    <div className="flex flex-col">
                        <div className={`logo-text ${isLarge ? 'text-3xl' : 'text-xl'}`}>
                            COASTAL
                        </div>
                        <div className={`logo-subtext ${isLarge ? 'text-sm' : 'text-xs'}`}>
                            FITNESS AND CORRECTION
                        </div>
                    </div>
                </div>
            );
        };

        // Role Badge Component
        const RoleBadge = ({ role }) => {
            const badgeClass = `role-badge ${role}-badge`;
            const roleIcons = {
                client: 'ğŸ‘¤',
                specialist: 'ğŸ‘©â€âš•ï¸',
                admin: 'ğŸ›¡ï¸',
                owner: 'ğŸ‘‘',
                engineer: 'ğŸ‘¨â€ğŸ’»'
            };
            
            return (
                <span className={badgeClass}>
                    {roleIcons[role]} {role.charAt(0).toUpperCase() + role.slice(1)}
                </span>
            );
        };

        // Main App Component
        const App = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [allUsers, setAllUsers] = useState(globalUserDatabase);
            const [selectedClientId, setSelectedClientId] = useState(null);
            const [notifications, setNotifications] = useState([]);
            const [chatMessages, setChatMessages] = useState({});
            const [appConfig, setAppConfig] = useState({
                appName: 'Coastal Fitness & Correction',
                theme: 'coastal-blue',
                features: {
                    measurements: true,
                    nutrition: true,
                    workouts: true,
                    goals: true,
                    tests: true,
                    chat: true,
                    reports: true
                },
                notifications: true,
                exportEnabled: true,
                maxMeasurements: 1000,
                autoBackup: true,
                ...globalAppConfig
            });

            // Save users whenever they change
            useEffect(() => {
                globalUserDatabase = allUsers;
                saveToStorage();
            }, [allUsers]);

            // Save app config whenever it changes
            useEffect(() => {
                globalAppConfig = appConfig;
                saveToStorage();
            }, [appConfig]);

            // Permission system
            const hasPermission = (action) => {
                if (!currentUser) return false;
                
                const permissions = {
                    client: ['viewOwnData', 'logOwnData', 'chat'],
                    specialist: ['viewClients', 'assignWorkouts', 'assignNutrition', 'logClientData', 'chat', 'specializedTests'],
                    admin: ['viewAllUsers', 'assignSpecialist', 'manageUsers', 'logClientData', 'chat', 'specializedTests', 'assignWorkouts', 'assignNutrition'],
                    owner: ['all'],
                    engineer: ['all', 'customize', 'systemManagement']
                };
                
                return permissions[currentUser?.role]?.includes(action) || permissions[currentUser?.role]?.includes('all');
            };

            // Check if user can view specific client data
            const canViewClient = (clientId) => {
                if (!currentUser) return false;
                if (currentUser.role === 'client') return clientId === currentUser.id;
                if (currentUser.role === 'specialist') {
                    const client = allUsers.find(u => u.id === clientId);
                    return client?.specialistIds?.includes(currentUser.id) || false;
                }
                return hasPermission('viewAllUsers');
            };

            // Add notification helper
            const addNotification = (message, type = 'success') => {
                setNotifications(prev => [{
                    id: Date.now(),
                    message,
                    type,
                    time: new Date().toLocaleTimeString()
                }, ...prev].slice(0, 10)); // Keep only last 10
            };

            // Login Component
            const LoginForm = () => {
                const [email, setEmail] = useState('');
                const [password, setPassword] = useState('');
                const [name, setName] = useState('');
                const [error, setError] = useState('');
                const [loading, setLoading] = useState(false);
                const [isSignup, setIsSignup] = useState(false);

                const handleAuth = async (e) => {
                    e.preventDefault();
                    setLoading(true);
                    
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    if (isSignup) {
                        // Create new client account with EMPTY data
                        const newUser = {
                            id: `client_${Date.now()}`,
                            email,
                            password, // In real app, this would be hashed
                            name: name || email.split('@')[0],
                            role: 'client',
                            avatar: 'ğŸ‘¤',
                            specialistIds: []
                        };
                        
                        setAllUsers(prev => [...prev, newUser]);
                        setCurrentUser(newUser);
                        initializeUserData(newUser.id); // Initialize with EMPTY data
                        addNotification(`Welcome ${newUser.name}! Your health journey starts now. ğŸŒŠ`);
                        setError('');
                    } else {
                        // Check demo accounts first
                        const demoAccount = demoAccounts[email];
                        if (demoAccount && demoAccount.password === password) {
                            const user = allUsers.find(u => u.id === demoAccount.id);
                            setCurrentUser(user || { ...demoAccount, email });
                            addNotification(`Welcome back, ${demoAccount.name}! ğŸ‘‹`);
                            setError('');
                            return;
                        }
                        
                        // Check regular users
                        const user = allUsers.find(u => u.email === email && u.password === password);
                        if (user) {
                            setCurrentUser(user);
                            addNotification(`Welcome back, ${user.name}! ğŸ‘‹`);
                            setError('');
                        } else {
                            setError('âŒ Invalid credentials');
                        }
                    }
                    setLoading(false);
                };

                return (
                    <div className="min-h-screen gradient-bg flex items-center justify-center p-4">
                        <div className="glass rounded-3xl p-8 max-w-md w-full float">
                            <div className="text-center mb-8">
                                <div className="flex justify-center mb-4">
                                    <CoastalLogo size="large" />
                                </div>
                                <p className="text-xl text-blue-200">Revolutionary Health Platform</p>
                            </div>
                            
                            <div className="flex mb-6">
                                <button
                                    onClick={() => setIsSignup(false)}
                                    className={`flex-1 py-2 rounded-l-lg transition-colors ${!isSignup ? 'bg-blue-500 text-white' : 'bg-white/10 text-gray-300'}`}
                                >
                                    Login
                                </button>
                                <button
                                    onClick={() => setIsSignup(true)}
                                    className={`flex-1 py-2 rounded-r-lg transition-colors ${isSignup ? 'bg-blue-500 text-white' : 'bg-white/10 text-gray-300'}`}
                                >
                                    Sign Up
                                </button>
                            </div>
                            
                            <form onSubmit={handleAuth} className="space-y-6">
                                {isSignup && (
                                    <div>
                                        <label className="block text-sm font-medium mb-2">ğŸ‘¤ Full Name</label>
                                        <input
                                            type="text"
                                            value={name}
                                            onChange={(e) => setName(e.target.value)}
                                            className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none transition-colors"
                                            placeholder="Enter your full name"
                                            required
                                        />
                                    </div>
                                )}
                                
                                <div>
                                    <label className="block text-sm font-medium mb-2">ğŸ“§ Email</label>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none transition-colors"
                                        placeholder="Enter your email"
                                        required
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium mb-2">ğŸ”’ Password</label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none transition-colors"
                                        placeholder="Enter your password"
                                        required
                                    />
                                </div>
                                
                                {error && <p className="text-red-300 text-sm">{error}</p>}
                                
                                <button
                                    type="submit"
                                    disabled={loading}
                                    className="w-full bg-gradient-to-r from-blue-600 to-cyan-500 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-cyan-600 transition-all duration-300 glow disabled:opacity-50"
                                >
                                    {loading ? 'ğŸ”„ Processing...' : (isSignup ? 'ğŸš€ Start Your Journey' : 'ğŸš€ Login')}
                                </button>
                            </form>
                        </div>
                    </div>
                );
            };

            // Navigation Component
            const Navigation = () => {
                const getTabsForRole = () => {
                    const baseTabs = [
                        { id: 'dashboard', label: 'ğŸ“Š Dashboard', icon: 'ğŸ“Š' }
                    ];

                    if (hasPermission('viewOwnData') || hasPermission('viewClients') || hasPermission('logClientData')) {
                        if (appConfig.features.measurements) baseTabs.push({ id: 'measurements', label: 'ğŸ“ Measurements', icon: 'ğŸ“' });
                        if (appConfig.features.nutrition) baseTabs.push({ id: 'nutrition', label: 'ğŸ¥— Nutrition', icon: 'ğŸ¥—' });
                        if (appConfig.features.workouts) baseTabs.push({ id: 'workouts', label: 'ğŸ’ª Workouts', icon: 'ğŸ’ª' });
                        if (appConfig.features.goals) baseTabs.push({ id: 'goals', label: 'ğŸ¯ Goals', icon: 'ğŸ¯' });
                    }

                    if (hasPermission('specializedTests') && appConfig.features.tests) {
                        baseTabs.push({ id: 'tests', label: 'ğŸ§ª Tests', icon: 'ğŸ§ª' });
                    }

                    if (hasPermission('chat') && appConfig.features.chat) {
                        baseTabs.push({ id: 'chat', label: 'ğŸ’¬ Chat', icon: 'ğŸ’¬' });
                    }

                    if (hasPermission('viewAllUsers') || hasPermission('viewClients')) {
                        baseTabs.push({ id: 'users', label: 'ğŸ‘¥ Users', icon: 'ğŸ‘¥' });
                    }
                    
                    if (hasPermission('customize')) {
                        baseTabs.push({ id: 'engineer', label: 'ğŸ”§ Engineer', icon: 'ğŸ”§' });
                    }

                    if (appConfig.features.reports) {
                        baseTabs.push({ id: 'reports', label: 'ğŸ“ˆ Reports', icon: 'ğŸ“ˆ' });
                    }
                    
                    return baseTabs;
                };

                return (
                    <nav className="card rounded-xl p-4 mb-6">
                        <div className="flex justify-between items-center mb-4">
                            <CoastalLogo size="small" />
                            <div className="flex items-center space-x-4">
                                <div className="flex items-center space-x-2">
                                    <span className="text-sm text-gray-300">Welcome, {currentUser.name}</span>
                                    <RoleBadge role={currentUser.role} />
                                </div>
                                <button
                                    onClick={() => exportData(getUserData(currentUser.id), `${currentUser.name.replace(/\s+/g, '_')}_health_data`)}
                                    className="bg-green-500/20 hover:bg-green-500/30 px-3 py-2 rounded-lg text-sm transition-colors"
                                >
                                    ğŸ“Š Export My Data
                                </button>
                                <button 
                                    onClick={() => setCurrentUser(null)}
                                    className="bg-red-500/20 hover:bg-red-500/30 px-4 py-2 rounded-lg text-sm transition-colors"
                                >
                                    ğŸšª Logout
                                </button>
                            </div>
                        </div>
                        <div className="flex flex-wrap gap-2">
                            {getTabsForRole().map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${
                                        activeTab === tab.id 
                                            ? 'bg-blue-500 text-white shadow-lg' 
                                            : 'bg-white/10 text-gray-300 hover:bg-white/20'
                                    }`}
                                >
                                    {tab.icon} {tab.label}
                                </button>
                            ))}
                        </div>
                    </nav>
                );
            };

            // Dashboard Component
            const Dashboard = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;
                const canvasRef = useRef(null);
                const chartRef = useRef(null);

                useEffect(() => {
                    if (canvasRef.current && userData.measurements.length > 0) {
                        if (chartRef.current) {
                            chartRef.current.destroy();
                        }
                        
                        // Get measurements with weight values
                        const weightMeasurements = userData.measurements.filter(m => m.weight > 0);
                        const bodyFatMeasurements = userData.measurements.filter(m => m.bodyFat > 0);
                        
                        const ctx = canvasRef.current.getContext('2d');
                        chartRef.current = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: weightMeasurements.map(m => new Date(m.date).toLocaleDateString()),
                                datasets: [
                                    {
                                        label: 'Weight (lbs)',
                                        data: weightMeasurements.map(m => m.weight),
                                        borderColor: '#0ea5e9',
                                        backgroundColor: 'rgba(14, 165, 233, 0.1)',
                                        tension: 0.4,
                                        fill: true
                                    },
                                    {
                                        label: 'Body Fat %',
                                        data: bodyFatMeasurements.map(m => m.bodyFat),
                                        borderColor: '#f59e0b',
                                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                        tension: 0.4,
                                        fill: true
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { 
                                    legend: { 
                                        labels: { color: '#fff' } 
                                    },
                                    tooltip: {
                                        callbacks: {
                                            afterLabel: function(context) {
                                                if (context.datasetIndex === 1) { // Body Fat dataset
                                                    const measurement = bodyFatMeasurements[context.dataIndex];
                                                    if (measurement.type === 'parrillo') {
                                                        return 'Method: Parrillo Caliper';
                                                    }
                                                }
                                                return '';
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    x: { 
                                        ticks: { color: '#fff' },
                                        grid: { color: 'rgba(255,255,255,0.1)' }
                                    },
                                    y: { 
                                        ticks: { color: '#fff' },
                                        grid: { color: 'rgba(255,255,255,0.1)' }
                                    }
                                }
                            }
                        });
                    }

                    return () => {
                        if (chartRef.current) {
                            chartRef.current.destroy();
                        }
                    };
                }, [userData.measurements]);

                const latestMeasurement = userData.measurements[userData.measurements.length - 1] || {};
                const assignedWorkouts = userData.workouts.filter(w => w.assigned);
                const completedGoals = userData.goals.filter(g => g.progress >= 100).length;
                const totalGoals = userData.goals.length;
                
                // Get latest measurements that have weight
                const latestWithWeight = userData.measurements.filter(m => m.weight > 0).pop() || {};
                const latestWithBodyFat = userData.measurements.filter(m => m.bodyFat > 0).pop() || {};
                const latestWithBP = userData.measurements.filter(m => m.bloodPressure).pop() || {};

                // Get clients for non-client users
                const getClientOptions = () => {
                    if (currentUser.role === 'client') return [];
                    if (currentUser.role === 'specialist') {
                        return allUsers.filter(user => 
                            user.role === 'client' && 
                            user.specialistIds?.includes(currentUser.id)
                        );
                    }
                    return allUsers.filter(user => user.role === 'client');
                };

                return (
                    <div className="space-y-6">
                        {/* Welcome Banner */}
                        <div className="card rounded-xl p-6 bg-gradient-to-r from-blue-500/20 to-cyan-500/20">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-4">
                                    <div className="text-4xl pulse">{displayUser.avatar}</div>
                                    <div>
                                        <h2 className="text-2xl font-bold">
                                            {selectedClientId ? `Viewing: ${displayUser.name}` : `Welcome back, ${displayUser.name}!`}
                                        </h2>
                                        <p className="text-blue-200">
                                            {userData.measurements.length > 0 
                                                ? 'Your health journey continues today' 
                                                : 'Ready to start your health journey? Add your first measurement!'
                                            }
                                        </p>
                                    </div>
                                </div>
                                
                                {/* Client Selection Dropdown for Non-Clients */}
                                {currentUser.role !== 'client' && getClientOptions().length > 0 && (
                                    <div className="flex items-center space-x-2">
                                        <select
                                            value={selectedClientId || ''}
                                            onChange={(e) => setSelectedClientId(e.target.value || null)}
                                            className="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white focus:border-blue-400 focus:outline-none"
                                        >
                                            <option value="">My Dashboard</option>
                                            {getClientOptions().map(client => (
                                                <option key={client.id} value={client.id}>
                                                    {client.name} ({client.email})
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                )}
                            </div>
                        </div>

                        {userData.measurements.length === 0 ? (
                            // New user experience
                            <div className="card rounded-xl p-8 text-center">
                                <div className="text-6xl mb-4">ğŸŒŠ</div>
                                <h3 className="text-2xl font-bold mb-4">Start Your Health Journey!</h3>
                                <p className="text-gray-300 mb-6">
                                    Welcome to Coastal Fitness & Correction. Let's begin by tracking your first measurement.
                                </p>
                                <button
                                    onClick={() => setActiveTab('measurements')}
                                    className="bg-gradient-to-r from-blue-600 to-cyan-500 text-white px-8 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-cyan-600 transition-all duration-300"
                                >
                                    ğŸ“ Add First Measurement
                                </button>
                            </div>
                        ) : (
                            <>
                                {/* Key Metrics */}
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                    <div className="card rounded-xl p-6 hover:scale-105 transition-transform">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-sm text-gray-400">ğŸ“Š Current Weight</p>
                                                <p className="text-2xl font-bold text-blue-400">{latestWithWeight.weight || '---'} lbs</p>
                                                <p className="text-xs text-green-400">{latestWithWeight.date ? new Date(latestWithWeight.date).toLocaleDateString() : 'No data'}</p>
                                            </div>
                                            <div className="text-3xl">âš–ï¸</div>
                                        </div>
                                    </div>
                                    
                                    <div className="card rounded-xl p-6 hover:scale-105 transition-transform">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-sm text-gray-400">ğŸ”¥ Body Fat</p>
                                                <p className="text-2xl font-bold text-orange-400">{latestWithBodyFat.bodyFat || '---'}%</p>
                                                <p className="text-xs text-gray-400">{latestWithBodyFat.type === 'parrillo' ? 'Parrillo method' : 'Current level'}</p>
                                            </div>
                                            <div className="text-3xl">ğŸ“‰</div>
                                        </div>
                                    </div>
                                    
                                    <div className="card rounded-xl p-6 hover:scale-105 transition-transform">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-sm text-gray-400">ğŸ©º Blood Pressure</p>
                                                <p className="text-2xl font-bold text-red-400">{latestWithBP.bloodPressure || 'N/A'}</p>
                                                <p className="text-xs text-gray-400">{latestWithBP.date ? new Date(latestWithBP.date).toLocaleDateString() : 'No data'}</p>
                                            </div>
                                            <div className="text-3xl">â¤ï¸</div>
                                        </div>
                                    </div>
                                    
                                    <div className="card rounded-xl p-6 hover:scale-105 transition-transform">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-sm text-gray-400">ğŸ¯ Goals Progress</p>
                                                <p className="text-2xl font-bold text-green-400">{completedGoals}/{totalGoals}</p>
                                                <p className="text-xs text-gray-400">Completed</p>
                                            </div>
                                            <div className="text-3xl">ğŸ†</div>
                                        </div>
                                    </div>
                                </div>

                                {/* Client-specific: Assigned Workouts & Nutrition */}
                                {(currentUser.role === 'client' || selectedClientId) && (
                                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <div className="card rounded-xl p-6">
                                            <h3 className="text-xl font-semibold mb-4">ğŸ’ª Today's Workouts</h3>
                                            {assignedWorkouts.length > 0 ? (
                                                <div className="space-y-3">
                                                    {assignedWorkouts.slice(0, 3).map(workout => (
                                                        <div key={workout.id} className={`p-4 rounded-lg ${
                                                            workout.completedToday ? 'bg-green-500/20 border-l-4 border-green-500' : 'bg-blue-500/20 border-l-4 border-blue-500'
                                                        }`}>
                                                            <div className="flex justify-between items-center mb-2">
                                                                <h4 className="font-medium">{workout.name}</h4>
                                                                <span className={`text-xs px-2 py-1 rounded ${
                                                                    workout.completedToday ? 'bg-green-500 text-white' : 'bg-orange-500 text-white'
                                                                }`}>
                                                                    {workout.completedToday ? 'âœ… Complete' : 'â³ Pending'}
                                                                </span>
                                                            </div>
                                                            <div className="text-sm text-gray-300">
                                                                {workout.exercises.slice(0, 3).join(' â€¢ ')}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            ) : (
                                                <div className="text-center py-8 text-gray-400">
                                                    <div className="text-4xl mb-2">ğŸ’ª</div>
                                                    <p>No workouts assigned yet</p>
                                                    <p className="text-sm">Contact your specialist to get started!</p>
                                                </div>
                                            )}
                                        </div>

                                        <div className="card rounded-xl p-6">
                                            <h3 className="text-xl font-semibold mb-4">ğŸ¥— Nutrition Today</h3>
                                            {userData.nutritionPlan.assignedBy ? (
                                                <div className="space-y-4">
                                                    <div className="grid grid-cols-2 gap-3">
                                                        <div className="bg-blue-500/20 p-3 rounded">
                                                            <p className="text-xs text-gray-400">Protein</p>
                                                            <p className="text-lg font-bold text-blue-400">
                                                                {userData.nutritionPlan.currentIntake.protein}g / {userData.nutritionPlan.dailyTargets.protein}g
                                                            </p>
                                                        </div>
                                                        <div className="bg-green-500/20 p-3 rounded">
                                                            <p className="text-xs text-gray-400">Carbs</p>
                                                            <p className="text-lg font-bold text-green-400">
                                                                {userData.nutritionPlan.currentIntake.carbs}g / {userData.nutritionPlan.dailyTargets.carbs}g
                                                            </p>
                                                        </div>
                                                        <div className="bg-orange-500/20 p-3 rounded">
                                                            <p className="text-xs text-gray-400">Fat</p>
                                                            <p className="text-lg font-bold text-orange-400">
                                                                {userData.nutritionPlan.currentIntake.fat}g / {userData.nutritionPlan.dailyTargets.fat}g
                                                            </p>
                                                        </div>
                                                        <div className="bg-purple-500/20 p-3 rounded">
                                                            <p className="text-xs text-gray-400">Calories</p>
                                                            <p className="text-lg font-bold text-purple-400">
                                                                {userData.nutritionPlan.currentIntake.calories} / {userData.nutritionPlan.dailyTargets.calories}
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            ) : (
                                                <div className="text-center py-8 text-gray-400">
                                                    <div className="text-4xl mb-2">ğŸ¥—</div>
                                                    <p>No nutrition plan assigned yet</p>
                                                    <p className="text-sm">Contact your specialist to get started!</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}

                                {/* Progress Chart */}
                                <div className="card rounded-xl p-6">
                                    <h3 className="text-xl font-semibold mb-4">ğŸ“ˆ Health Progress Tracking</h3>
                                    <div className="chart-container">
                                        <canvas ref={canvasRef}></canvas>
                                    </div>
                                </div>
                            </>
                        )}

                        {/* Notifications */}
                        {notifications.length > 0 && (
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">ğŸ”” Recent Activity</h3>
                                <div className="space-y-3 max-h-60 overflow-y-auto">
                                    {notifications.map(notification => (
                                        <div key={notification.id} className={`p-3 rounded-lg ${
                                            notification.type === 'success' ? 'bg-green-500/20 border-l-4 border-green-500' :
                                            notification.type === 'warning' ? 'bg-yellow-500/20 border-l-4 border-yellow-500' :
                                            notification.type === 'error' ? 'bg-red-500/20 border-l-4 border-red-500' :
                                            'bg-blue-500/20 border-l-4 border-blue-500'
                                        }`}>
                                            <p className="text-sm">{notification.message}</p>
                                            <p className="text-xs text-gray-400 mt-1">{notification.time}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Measurements Component - FULLY FUNCTIONAL with Advanced Methods
            const MeasurementsComponent = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;
                const [measurementType, setMeasurementType] = useState('basic');
                const [newMeasurement, setNewMeasurement] = useState({
                    date: new Date().toISOString().split('T')[0],
                    weight: '',
                    bodyFat: '',
                    muscle: '',
                    bmi: '',
                    bloodPressure: '',
                    protein: '',
                    carbs: '',
                    fat: '',
                    calories: '',
                    // Circumference measurements
                    neck: '',
                    shoulders: '',
                    chest: '',
                    upperArm: '',
                    lowerArm: '',
                    waist: '',
                    hips: '',
                    upperThigh: '',
                    calf: '',
                    // Parrillo Caliper measurements (in mm)
                    parrillo_chest: '',
                    parrillo_abdominal: '',
                    parrillo_thigh: '',
                    parrillo_bicep: '',
                    parrillo_tricep: '',
                    parrillo_subscapular: '',
                    parrillo_suprailiac: '',
                    parrillo_lowerBack: '',
                    parrillo_calf: ''
                });

                // Check if user can add measurements for the current target
                const canAddMeasurements = () => {
                    if (selectedClientId) {
                        return canViewClient(selectedClientId) && hasPermission('logClientData');
                    }
                    return hasPermission('viewOwnData') || hasPermission('logClientData');
                };

                const addMeasurement = () => {
                    if (!canAddMeasurements()) {
                        addNotification('You do not have permission to add measurements for this user', 'error');
                        return;
                    }

                    if (newMeasurement.weight || measurementType !== 'basic') {
                        const measurement = {
                            id: Date.now(),
                            date: newMeasurement.date,
                            type: measurementType,
                            // Basic measurements
                            weight: parseFloat(newMeasurement.weight) || 0,
                            bodyFat: parseFloat(newMeasurement.bodyFat) || 0,
                            muscle: parseFloat(newMeasurement.muscle) || 0,
                            bmi: parseFloat(newMeasurement.bmi) || 0,
                            bloodPressure: newMeasurement.bloodPressure || '',
                            // Nutrition
                            protein: parseFloat(newMeasurement.protein) || 0,
                            carbs: parseFloat(newMeasurement.carbs) || 0,
                            fat: parseFloat(newMeasurement.fat) || 0,
                            calories: parseFloat(newMeasurement.calories) || 0,
                            // Circumference measurements
                            circumference: {
                                neck: parseFloat(newMeasurement.neck) || 0,
                                shoulders: parseFloat(newMeasurement.shoulders) || 0,
                                chest: parseFloat(newMeasurement.chest) || 0,
                                upperArm: parseFloat(newMeasurement.upperArm) || 0,
                                lowerArm: parseFloat(newMeasurement.lowerArm) || 0,
                                waist: parseFloat(newMeasurement.waist) || 0,
                                hips: parseFloat(newMeasurement.hips) || 0,
                                upperThigh: parseFloat(newMeasurement.upperThigh) || 0,
                                calf: parseFloat(newMeasurement.calf) || 0
                            },
                            // Parrillo measurements
                            parrillo: {
                                chest: parseFloat(newMeasurement.parrillo_chest) || 0,
                                abdominal: parseFloat(newMeasurement.parrillo_abdominal) || 0,
                                thigh: parseFloat(newMeasurement.parrillo_thigh) || 0,
                                bicep: parseFloat(newMeasurement.parrillo_bicep) || 0,
                                tricep: parseFloat(newMeasurement.parrillo_tricep) || 0,
                                subscapular: parseFloat(newMeasurement.parrillo_subscapular) || 0,
                                suprailiac: parseFloat(newMeasurement.parrillo_suprailiac) || 0,
                                lowerBack: parseFloat(newMeasurement.parrillo_lowerBack) || 0,
                                calf: parseFloat(newMeasurement.parrillo_calf) || 0
                            },
                            enteredBy: currentUser.id
                        };
                        
                        // Calculate body fat percentage if Parrillo measurements are provided
                        if (measurementType === 'parrillo') {
                            const parrilloSum = Object.values(measurement.parrillo).reduce((sum, val) => sum + val, 0);
                            if (parrilloSum > 0) {
                                // Parrillo body fat calculation (simplified)
                                measurement.bodyFat = (parrilloSum * 0.27) + 0.5;
                            }
                        }
                        
                        updateUserData(selectedClientId || currentUser.id, 'measurements', measurement);
                        
                        // Update nutrition intake if values provided
                        if (measurement.protein || measurement.carbs || measurement.fat || measurement.calories) {
                            const targetId = selectedClientId || currentUser.id;
                            const targetData = getUserData(targetId);
                            globalUserData[targetId].nutritionPlan.currentIntake = {
                                protein: measurement.protein,
                                carbs: measurement.carbs,
                                fat: measurement.fat,
                                calories: measurement.calories
                            };
                            saveToStorage();
                        }
                        
                        // Reset form
                        setNewMeasurement({
                            date: new Date().toISOString().split('T')[0],
                            weight: '',
                            bodyFat: '',
                            muscle: '',
                            bmi: '',
                            bloodPressure: '',
                            protein: '',
                            carbs: '',
                            fat: '',
                            calories: '',
                            neck: '',
                            shoulders: '',
                            chest: '',
                            upperArm: '',
                            lowerArm: '',
                            waist: '',
                            hips: '',
                            upperThigh: '',
                            calf: '',
                            parrillo_chest: '',
                            parrillo_abdominal: '',
                            parrillo_thigh: '',
                            parrillo_bicep: '',
                            parrillo_tricep: '',
                            parrillo_subscapular: '',
                            parrillo_suprailiac: '',
                            parrillo_lowerBack: '',
                            parrillo_calf: ''
                        });

                        addNotification(`${measurementType.charAt(0).toUpperCase() + measurementType.slice(1)} measurement added for ${displayUser.name}! ğŸ“Š`);
                    }
                };

                const deleteMeasurement = (measurementId) => {
                    if (confirm('Are you sure you want to delete this measurement?')) {
                        deleteUserData(selectedClientId || currentUser.id, 'measurements', measurementId);
                        addNotification('Measurement deleted successfully! ğŸ—‘ï¸');
                    }
                };

                return (
                    <div className="space-y-6">
                        {selectedClientId && (
                            <div className="card rounded-xl p-4 bg-blue-500/20">
                                <p className="text-center">
                                    ğŸ“Š Adding measurement for: <strong>{displayUser.name}</strong>
                                    <button
                                        onClick={() => setSelectedClientId(null)}
                                        className="ml-4 bg-gray-500/20 hover:bg-gray-500/30 px-3 py-1 rounded text-sm"
                                    >
                                        â† Back
                                    </button>
                                </p>
                            </div>
                        )}

                        {canAddMeasurements() && (
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">ğŸ“‹ Add New Measurement & Nutrition Log</h3>
                                
                                {/* Measurement Type Selector */}
                                <div className="flex space-x-2 mb-6">
                                    <button
                                        onClick={() => setMeasurementType('basic')}
                                        className={`px-4 py-2 rounded-lg transition-colors ${
                                            measurementType === 'basic' 
                                                ? 'bg-blue-500 text-white' 
                                                : 'bg-white/10 text-gray-300 hover:bg-white/20'
                                        }`}
                                    >
                                        Basic Measurements
                                    </button>
                                    <button
                                        onClick={() => setMeasurementType('circumference')}
                                        className={`px-4 py-2 rounded-lg transition-colors ${
                                            measurementType === 'circumference' 
                                                ? 'bg-blue-500 text-white' 
                                                : 'bg-white/10 text-gray-300 hover:bg-white/20'
                                        }`}
                                    >
                                        Circumference
                                    </button>
                                    <button
                                        onClick={() => setMeasurementType('parrillo')}
                                        className={`px-4 py-2 rounded-lg transition-colors ${
                                            measurementType === 'parrillo' 
                                                ? 'bg-blue-500 text-white' 
                                                : 'bg-white/10 text-gray-300 hover:bg-white/20'
                                        }`}
                                    >
                                        Parrillo Caliper
                                    </button>
                                </div>
                                
                                {/* Date Input (always shown) */}
                                <div className="mb-4">
                                    <input
                                        type="date"
                                        value={newMeasurement.date}
                                        onChange={(e) => setNewMeasurement({...newMeasurement, date: e.target.value})}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                    />
                                </div>

                                {/* Basic Measurements */}
                                {measurementType === 'basic' && (
                                    <>
                                        <div className="mb-6">
                                            <h4 className="text-lg font-medium mb-3">Body Measurements</h4>
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <input
                                                    type="number"
                                                    placeholder="Weight (lbs) *"
                                                    value={newMeasurement.weight}
                                                    onChange={(e) => setNewMeasurement({...newMeasurement, weight: e.target.value})}
                                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                                    required
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Body Fat %"
                                                    value={newMeasurement.bodyFat}
                                                    onChange={(e) => setNewMeasurement({...newMeasurement, bodyFat: e.target.value})}
                                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Muscle Mass (lbs)"
                                                    value={newMeasurement.muscle}
                                                    onChange={(e) => setNewMeasurement({...newMeasurement, muscle: e.target.value})}
                                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="BMI"
                                                    value={newMeasurement.bmi}
                                                    onChange={(e) => setNewMeasurement({...newMeasurement, bmi: e.target.value})}
                                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                                />
                                                <input
                                                    type="text"
                                                    placeholder="Blood Pressure (e.g., 120/80)"
                                                    value={newMeasurement.bloodPressure}
                                                    onChange={(e) => setNewMeasurement({...newMeasurement, bloodPressure: e.target.value})}
                                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                                />
                                            </div>
                                        </div>

                                        {/* Nutrition Logging */}
                                        <div className="mb-6">
                                            <h4 className="text-lg font-medium mb-3">Today's Nutrition Intake (Optional)</h4>
                                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                                <input
                                                    type="number"
                                                    placeholder="Protein (g)"
                                                    value={newMeasurement.protein}
                                                    onChange={(e) => setNewMeasurement({...newMeasurement, protein: e.target.value})}
                                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Carbs (g)"
                                                    value={newMeasurement.carbs}
                                                    onChange={(e) => setNewMeasurement({...newMeasurement, carbs: e.target.value})}
                                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Fat (g)"
                                                    value={newMeasurement.fat}
                                                    onChange={(e) => setNewMeasurement({...newMeasurement, fat: e.target.value})}
                                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Calories"
                                                    value={newMeasurement.calories}
                                                    onChange={(e) => setNewMeasurement({...newMeasurement, calories: e.target.value})}
                                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                                />
                                            </div>
                                        </div>
                                    </>
                                )}

                                {/* Circumference Measurements */}
                                {measurementType === 'circumference' && (
                                    <div className="mb-6">
                                        <h4 className="text-lg font-medium mb-3">Circumference Measurements (inches)</h4>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Neck"
                                                value={newMeasurement.neck}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, neck: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Shoulders"
                                                value={newMeasurement.shoulders}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, shoulders: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Chest"
                                                value={newMeasurement.chest}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, chest: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Upper Arm"
                                                value={newMeasurement.upperArm}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, upperArm: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Lower Arm"
                                                value={newMeasurement.lowerArm}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, lowerArm: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Waist"
                                                value={newMeasurement.waist}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, waist: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Hips"
                                                value={newMeasurement.hips}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, hips: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Upper Thigh"
                                                value={newMeasurement.upperThigh}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, upperThigh: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Calf"
                                                value={newMeasurement.calf}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, calf: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                        </div>
                                        
                                        {/* Weight input for circumference */}
                                        <div className="mt-4">
                                            <input
                                                type="number"
                                                placeholder="Weight (lbs) - Optional"
                                                value={newMeasurement.weight}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, weight: e.target.value})}
                                                className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                        </div>
                                    </div>
                                )}

                                {/* Parrillo Caliper Measurements */}
                                {measurementType === 'parrillo' && (
                                    <div className="mb-6">
                                        <h4 className="text-lg font-medium mb-3">Parrillo Caliper Method (mm)</h4>
                                        <div className="bg-blue-500/10 p-3 rounded-lg mb-4">
                                            <p className="text-sm">ğŸ“ Measure skinfold thickness at each site in millimeters</p>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Chest (mm)"
                                                value={newMeasurement.parrillo_chest}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, parrillo_chest: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Abdominal (mm)"
                                                value={newMeasurement.parrillo_abdominal}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, parrillo_abdominal: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Thigh (mm)"
                                                value={newMeasurement.parrillo_thigh}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, parrillo_thigh: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Bicep (mm)"
                                                value={newMeasurement.parrillo_bicep}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, parrillo_bicep: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Tricep (mm)"
                                                value={newMeasurement.parrillo_tricep}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, parrillo_tricep: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Subscapular (mm)"
                                                value={newMeasurement.parrillo_subscapular}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, parrillo_subscapular: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Suprailiac (mm)"
                                                value={newMeasurement.parrillo_suprailiac}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, parrillo_suprailiac: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Lower Back (mm)"
                                                value={newMeasurement.parrillo_lowerBack}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, parrillo_lowerBack: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="number"
                                                step="0.1"
                                                placeholder="Calf (mm)"
                                                value={newMeasurement.parrillo_calf}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, parrillo_calf: e.target.value})}
                                                className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                        </div>
                                        
                                        {/* Weight input for Parrillo */}
                                        <div className="mt-4">
                                            <input
                                                type="number"
                                                placeholder="Weight (lbs) - Optional"
                                                value={newMeasurement.weight}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, weight: e.target.value})}
                                                className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                        </div>
                                    </div>
                                )}

                                <button
                                    onClick={addMeasurement}
                                    className="w-full bg-gradient-to-r from-blue-600 to-cyan-500 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-cyan-600 transition-all duration-300"
                                >
                                    â• Add {measurementType.charAt(0).toUpperCase() + measurementType.slice(1)} Measurement
                                </button>
                            </div>
                        )}

                        {/* Measurements History */}
                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">ğŸ“ˆ Measurement History</h3>
                                <button
                                    onClick={() => exportData(userData.measurements, `${displayUser.name.replace(/\s+/g, '_')}_measurements`)}
                                    className="bg-green-500/20 hover:bg-green-500/30 px-3 py-1 rounded text-sm transition-colors"
                                >
                                    ğŸ“Š Export Data
                                </button>
                            </div>
                            {userData.measurements.length > 0 ? (
                                <div className="space-y-4">
                                    {userData.measurements.map((measurement) => (
                                        <div key={measurement.id} className="bg-white/5 rounded-lg p-4">
                                            <div className="flex justify-between items-start mb-3">
                                                <div>
                                                    <h4 className="font-medium text-lg">
                                                        {measurement.type === 'parrillo' ? 'ğŸ“ Parrillo Caliper' : 
                                                         measurement.type === 'circumference' ? 'ğŸ“ Circumference' : 
                                                         'ğŸ“Š Basic'} Measurement
                                                    </h4>
                                                    <p className="text-sm text-gray-400">
                                                        {new Date(measurement.date).toLocaleDateString()} â€¢ 
                                                        Entered by: {allUsers.find(u => u.id === measurement.enteredBy)?.name || 'Unknown'}
                                                    </p>
                                                </div>
                                                <button
                                                    onClick={() => deleteMeasurement(measurement.id)}
                                                    className="text-red-400 hover:text-red-300"
                                                >
                                                    ğŸ—‘ï¸
                                                </button>
                                            </div>
                                            
                                            {/* Display based on measurement type */}
                                            {measurement.type === 'circumference' ? (
                                                <div className="grid grid-cols-2 md:grid-cols-3 gap-3 text-sm">
                                                    {measurement.weight > 0 && <p><span className="text-gray-400">Weight:</span> {measurement.weight} lbs</p>}
                                                    {measurement.circumference && Object.entries(measurement.circumference).map(([key, value]) => (
                                                        value > 0 && <p key={key}><span className="text-gray-400 capitalize">{key}:</span> {value}"</p>
                                                    ))}
                                                </div>
                                            ) : measurement.type === 'parrillo' ? (
                                                <div>
                                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3 text-sm mb-3">
                                                        {measurement.weight > 0 && <p><span className="text-gray-400">Weight:</span> {measurement.weight} lbs</p>}
                                                        {measurement.parrillo && Object.entries(measurement.parrillo).map(([key, value]) => (
                                                            value > 0 && <p key={key}><span className="text-gray-400 capitalize">{key}:</span> {value}mm</p>
                                                        ))}
                                                    </div>
                                                    {measurement.bodyFat > 0 && (
                                                        <div className="bg-blue-500/20 p-2 rounded mt-2">
                                                            <p className="text-sm font-medium">Calculated Body Fat: {measurement.bodyFat.toFixed(1)}%</p>
                                                        </div>
                                                    )}
                                                </div>
                                            ) : (
                                                <div className="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                                                    {measurement.weight > 0 && <p><span className="text-gray-400">Weight:</span> {measurement.weight} lbs</p>}
                                                    {measurement.bodyFat > 0 && <p><span className="text-gray-400">Body Fat:</span> {measurement.bodyFat}%</p>}
                                                    {measurement.muscle > 0 && <p><span className="text-gray-400">Muscle:</span> {measurement.muscle} lbs</p>}
                                                    {measurement.bmi > 0 && <p><span className="text-gray-400">BMI:</span> {measurement.bmi}</p>}
                                                    {measurement.bloodPressure && <p><span className="text-gray-400">BP:</span> {measurement.bloodPressure}</p>}
                                                    {measurement.protein > 0 && <p><span className="text-gray-400">Protein:</span> {measurement.protein}g</p>}
                                                    {measurement.carbs > 0 && <p><span className="text-gray-400">Carbs:</span> {measurement.carbs}g</p>}
                                                    {measurement.fat > 0 && <p><span className="text-gray-400">Fat:</span> {measurement.fat}g</p>}
                                                    {measurement.calories > 0 && <p><span className="text-gray-400">Calories:</span> {measurement.calories}</p>}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div className="text-center py-8 text-gray-400">
                                    <div className="text-4xl mb-2">ğŸ“</div>
                                    <p>No measurements recorded yet</p>
                                    <p className="text-sm">Add your first measurement above to get started!</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Nutrition Component - FULLY FUNCTIONAL
            const NutritionComponent = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;
                const [nutritionTargets, setNutritionTargets] = useState({
                    protein: '',
                    carbs: '',
                    fat: '',
                    calories: ''
                });
                const [mealPlan, setMealPlan] = useState(['', '', '']);

                const assignNutritionPlan = () => {
                    if (nutritionTargets.protein || nutritionTargets.carbs || nutritionTargets.fat || nutritionTargets.calories) {
                        const targets = {
                            protein: parseFloat(nutritionTargets.protein) || 0,
                            carbs: parseFloat(nutritionTargets.carbs) || 0,
                            fat: parseFloat(nutritionTargets.fat) || 0,
                            calories: parseFloat(nutritionTargets.calories) || 0
                        };

                        const planUpdate = {
                            dailyTargets: targets,
                            mealPlan: mealPlan.filter(meal => meal.trim()),
                            assignedBy: currentUser.id,
                            assignedDate: new Date().toISOString().split('T')[0]
                        };

                        const targetId = selectedClientId || currentUser.id;
                        const targetData = getUserData(targetId);
                        globalUserData[targetId] = {
                            ...targetData,
                            nutritionPlan: { ...targetData.nutritionPlan, ...planUpdate }
                        };
                        saveToStorage();

                        setNutritionTargets({ protein: '', carbs: '', fat: '', calories: '' });
                        setMealPlan(['', '', '']);
                        addNotification(`Nutrition plan assigned to ${displayUser.name}! ğŸ¥—`);
                    }
                };

                const progressPercent = (current, target) => target > 0 ? Math.round((current / target) * 100) : 0;

                return (
                    <div className="space-y-6">
                        {selectedClientId && (
                            <div className="card rounded-xl p-4 bg-green-500/20">
                                <p className="text-center">
                                    ğŸ¥— Managing nutrition for: <strong>{displayUser.name}</strong>
                                    <button
                                        onClick={() => setSelectedClientId(null)}
                                        className="ml-4 bg-gray-500/20 hover:bg-gray-500/30 px-3 py-1 rounded text-sm"
                                    >
                                        â† Back
                                    </button>
                                </p>
                            </div>
                        )}

                        {hasPermission('assignNutrition') && (
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">ğŸ¥— Assign Nutrition Plan</h3>
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                                    <input
                                        type="number"
                                        placeholder="Protein Target (g)"
                                        value={nutritionTargets.protein}
                                        onChange={(e) => setNutritionTargets({...nutritionTargets, protein: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Carbs Target (g)"
                                        value={nutritionTargets.carbs}
                                        onChange={(e) => setNutritionTargets({...nutritionTargets, carbs: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Fat Target (g)"
                                        value={nutritionTargets.fat}
                                        onChange={(e) => setNutritionTargets({...nutritionTargets, fat: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Calories Target"
                                        value={nutritionTargets.calories}
                                        onChange={(e) => setNutritionTargets({...nutritionTargets, calories: e.target.value})}
                                        className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                </div>
                                
                                <div className="space-y-3 mb-4">
                                    <h4 className="font-medium">Meal Plan (Optional)</h4>
                                    <input
                                        type="text"
                                        placeholder="Breakfast (e.g., Oatmeal with berries)"
                                        value={mealPlan[0]}
                                        onChange={(e) => setMealPlan([e.target.value, mealPlan[1], mealPlan[2]])}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Lunch (e.g., Grilled chicken salad)"
                                        value={mealPlan[1]}
                                        onChange={(e) => setMealPlan([mealPlan[0], e.target.value, mealPlan[2]])}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Dinner (e.g., Salmon with vegetables)"
                                        value={mealPlan[2]}
                                        onChange={(e) => setMealPlan([mealPlan[0], mealPlan[1], e.target.value])}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                </div>
                                
                                <button
                                    onClick={assignNutritionPlan}
                                    className="w-full bg-gradient-to-r from-green-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-green-700 hover:to-blue-700 transition-all duration-300"
                                >
                                    ğŸ¯ Assign Nutrition Plan
                                </button>
                            </div>
                        )}

                        {/* Current Plan Display */}
                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">ğŸ“Š Current Nutrition Plan</h3>
                                <button
                                    onClick={() => exportData(userData.nutritionPlan, `${displayUser.name.replace(/\s+/g, '_')}_nutrition`)}
                                    className="bg-green-500/20 hover:bg-green-500/30 px-3 py-1 rounded text-sm transition-colors"
                                >
                                    ğŸ“Š Export Plan
                                </button>
                            </div>
                            
                            {userData.nutritionPlan.assignedBy ? (
                                <div className="space-y-6">
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                        <div className="bg-blue-500/20 p-4 rounded-lg">
                                            <div className="flex justify-between items-center mb-2">
                                                <h4 className="font-medium">ğŸ¥© Protein</h4>
                                                <span className="text-sm">{progressPercent(userData.nutritionPlan.currentIntake.protein, userData.nutritionPlan.dailyTargets.protein)}%</span>
                                            </div>
                                            <p className="text-2xl font-bold text-blue-400 mb-2">
                                                {userData.nutritionPlan.currentIntake.protein}g
                                            </p>
                                            <p className="text-sm text-gray-400">Goal: {userData.nutritionPlan.dailyTargets.protein}g</p>
                                            <div className="w-full bg-gray-700 rounded-full h-2 mt-2">
                                                <div 
                                                    className="bg-blue-500 h-2 rounded-full transition-all duration-300"
                                                    style={{ width: `${Math.min(progressPercent(userData.nutritionPlan.currentIntake.protein, userData.nutritionPlan.dailyTargets.protein), 100)}%` }}
                                                ></div>
                                            </div>
                                        </div>

                                        <div className="bg-green-500/20 p-4 rounded-lg">
                                            <div className="flex justify-between items-center mb-2">
                                                <h4 className="font-medium">ğŸ Carbs</h4>
                                                <span className="text-sm">{progressPercent(userData.nutritionPlan.currentIntake.carbs, userData.nutritionPlan.dailyTargets.carbs)}%</span>
                                            </div>
                                            <p className="text-2xl font-bold text-green-400 mb-2">
                                                {userData.nutritionPlan.currentIntake.carbs}g
                                            </p>
                                            <p className="text-sm text-gray-400">Goal: {userData.nutritionPlan.dailyTargets.carbs}g</p>
                                            <div className="w-full bg-gray-700 rounded-full h-2 mt-2">
                                                <div 
                                                    className="bg-green-500 h-2 rounded-full transition-all duration-300"
                                                    style={{ width: `${Math.min(progressPercent(userData.nutritionPlan.currentIntake.carbs, userData.nutritionPlan.dailyTargets.carbs), 100)}%` }}
                                                ></div>
                                            </div>
                                        </div>

                                        <div className="bg-orange-500/20 p-4 rounded-lg">
                                            <div className="flex justify-between items-center mb-2">
                                                <h4 className="font-medium">ğŸ¥‘ Fat</h4>
                                                <span className="text-sm">{progressPercent(userData.nutritionPlan.currentIntake.fat, userData.nutritionPlan.dailyTargets.fat)}%</span>
                                            </div>
                                            <p className="text-2xl font-bold text-orange-400 mb-2">
                                                {userData.nutritionPlan.currentIntake.fat}g
                                            </p>
                                            <p className="text-sm text-gray-400">Goal: {userData.nutritionPlan.dailyTargets.fat}g</p>
                                            <div className="w-full bg-gray-700 rounded-full h-2 mt-2">
                                                <div 
                                                    className="bg-orange-500 h-2 rounded-full transition-all duration-300"
                                                    style={{ width: `${Math.min(progressPercent(userData.nutritionPlan.currentIntake.fat, userData.nutritionPlan.dailyTargets.fat), 100)}%` }}
                                                ></div>
                                            </div>
                                        </div>

                                        <div className="bg-purple-500/20 p-4 rounded-lg">
                                            <div className="flex justify-between items-center mb-2">
                                                <h4 className="font-medium">ğŸ”¥ Calories</h4>
                                                <span className="text-sm">{progressPercent(userData.nutritionPlan.currentIntake.calories, userData.nutritionPlan.dailyTargets.calories)}%</span>
                                            </div>
                                            <p className="text-2xl font-bold text-purple-400 mb-2">
                                                {userData.nutritionPlan.currentIntake.calories}
                                            </p>
                                            <p className="text-sm text-gray-400">Goal: {userData.nutritionPlan.dailyTargets.calories}</p>
                                            <div className="w-full bg-gray-700 rounded-full h-2 mt-2">
                                                <div 
                                                    className="bg-purple-500 h-2 rounded-full transition-all duration-300"
                                                    style={{ width: `${Math.min(progressPercent(userData.nutritionPlan.currentIntake.calories, userData.nutritionPlan.dailyTargets.calories), 100)}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                    </div>

                                    {userData.nutritionPlan.mealPlan && userData.nutritionPlan.mealPlan.length > 0 && (
                                        <div className="bg-white/5 rounded-lg p-4">
                                            <h4 className="font-medium mb-3">ğŸ½ï¸ Today's Meal Plan</h4>
                                            <div className="space-y-2">
                                                {userData.nutritionPlan.mealPlan.map((meal, index) => (
                                                    <div key={index} className="flex items-center space-x-2">
                                                        <span className="text-2xl">
                                                            {index === 0 ? 'ğŸŒ…' : index === 1 ? 'â˜€ï¸' : 'ğŸŒ™'}
                                                        </span>
                                                        <p className="text-sm">{meal}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    <div className="text-sm text-gray-400">
                                        <p>Plan assigned by: {allUsers.find(u => u.id === userData.nutritionPlan.assignedBy)?.name || 'Unknown'}</p>
                                        <p>Date: {userData.nutritionPlan.assignedDate}</p>
                                    </div>
                                </div>
                            ) : (
                                <div className="text-center py-8 text-gray-400">
                                    <div className="text-4xl mb-2">ğŸ¥—</div>
                                    <p>No nutrition plan assigned yet</p>
                                    <p className="text-sm">
                                        {hasPermission('assignNutrition') 
                                            ? 'Create a nutrition plan above!' 
                                            : 'Contact your specialist to get a nutrition plan assigned!'
                                        }
                                    </p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Workouts Component - FULLY FUNCTIONAL with YouTube URLs
            const WorkoutsComponent = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;
                const [newWorkout, setNewWorkout] = useState({
                    name: '',
                    exercises: [''],
                    youtubeUrl: '',
                    targetClientId: selectedClientId || (currentUser.role === 'client' ? currentUser.id : '')
                });

                const addExercise = () => {
                    setNewWorkout({
                        ...newWorkout,
                        exercises: [...newWorkout.exercises, '']
                    });
                };

                const updateExercise = (index, value) => {
                    const updatedExercises = [...newWorkout.exercises];
                    updatedExercises[index] = value;
                    setNewWorkout({
                        ...newWorkout,
                        exercises: updatedExercises
                    });
                };

                const removeExercise = (index) => {
                    setNewWorkout({
                        ...newWorkout,
                        exercises: newWorkout.exercises.filter((_, i) => i !== index)
                    });
                };

                const createWorkout = () => {
                    if (newWorkout.name && newWorkout.exercises.some(ex => ex.trim())) {
                        const workout = {
                            id: Date.now(),
                            name: newWorkout.name,
                            exercises: newWorkout.exercises.filter(ex => ex.trim()),
                            youtubeUrl: newWorkout.youtubeUrl,
                            assigned: true,
                            completedToday: false,
                            assignedBy: currentUser.id,
                            clientId: newWorkout.targetClientId,
                            createdDate: new Date().toISOString().split('T')[0]
                        };
                        
                        updateUserData(newWorkout.targetClientId, 'workouts', workout);
                        setNewWorkout({
                            name: '',
                            exercises: [''],
                            youtubeUrl: '',
                            targetClientId: selectedClientId || (currentUser.role === 'client' ? currentUser.id : '')
                        });

                        const targetUser = allUsers.find(u => u.id === newWorkout.targetClientId);
                        addNotification(`Workout assigned to ${targetUser?.name || 'client'}! ğŸ’ª`);
                    }
                };

                const toggleWorkoutCompletion = (workoutId) => {
                    const targetId = selectedClientId || currentUser.id;
                    const targetData = getUserData(targetId);
                    const updatedWorkouts = targetData.workouts.map(workout => 
                        workout.id === workoutId 
                            ? { ...workout, completedToday: !workout.completedToday }
                            : workout
                    );
                    globalUserData[targetId] = { ...targetData, workouts: updatedWorkouts };
                    saveToStorage();
                    addNotification("Workout status updated! ğŸ’ª");
                };

                const deleteWorkout = (workoutId) => {
                    if (confirm('Are you sure you want to delete this workout?')) {
                        deleteUserData(selectedClientId || currentUser.id, 'workouts', workoutId);
                        addNotification('Workout deleted successfully! ğŸ—‘ï¸');
                    }
                };

                const getClientsForAssignment = () => {
                    if (currentUser.role === 'client') return [];
                    if (currentUser.role === 'specialist') {
                        return allUsers.filter(user => 
                            user.role === 'client' && 
                            user.specialistIds?.includes(currentUser.id)
                        );
                    }
                    return allUsers.filter(user => user.role === 'client');
                };

                return (
                    <div className="space-y-6">
                        {selectedClientId && (
                            <div className="card rounded-xl p-4 bg-purple-500/20">
                                <p className="text-center">
                                    ğŸ’ª Managing workouts for: <strong>{displayUser.name}</strong>
                                    <button
                                        onClick={() => setSelectedClientId(null)}
                                        className="ml-4 bg-gray-500/20 hover:bg-gray-500/30 px-3 py-1 rounded text-sm"
                                    >
                                        â† Back
                                    </button>
                                </p>
                            </div>
                        )}

                        {/* Create/Assign Workout */}
                        {hasPermission('assignWorkouts') && (
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">ğŸ’ª Create & Assign Workout</h3>
                                <div className="space-y-4">
                                    <input
                                        type="text"
                                        placeholder="Workout Name (e.g., Upper Body Strength)"
                                        value={newWorkout.name}
                                        onChange={(e) => setNewWorkout({...newWorkout, name: e.target.value})}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                    />
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">ğŸ“¹ YouTube URL (Optional)</label>
                                        <input
                                            type="url"
                                            placeholder="https://youtube.com/watch?v=... (for workout instructions)"
                                            value={newWorkout.youtubeUrl}
                                            onChange={(e) => setNewWorkout({...newWorkout, youtubeUrl: e.target.value})}
                                            className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                        />
                                    </div>
                                    
                                    {getClientsForAssignment().length > 0 && !selectedClientId && (
                                        <select
                                            value={newWorkout.targetClientId}
                                            onChange={(e) => setNewWorkout({...newWorkout, targetClientId: e.target.value})}
                                            className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                        >
                                            <option value="">Select Client</option>
                                            {getClientsForAssignment().map(client => (
                                                <option key={client.id} value={client.id}>{client.name}</option>
                                            ))}
                                        </select>
                                    )}

                                    <div className="space-y-2">
                                        <label className="block text-sm font-medium">Exercises:</label>
                                        {newWorkout.exercises.map((exercise, index) => (
                                            <div key={index} className="flex gap-2">
                                                <input
                                                    type="text"
                                                    placeholder={`Exercise ${index + 1} (e.g., Push-ups x15)`}
                                                    value={exercise}
                                                    onChange={(e) => updateExercise(index, e.target.value)}
                                                    className="flex-1 p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                                />
                                                {newWorkout.exercises.length > 1 && (
                                                    <button
                                                        onClick={() => removeExercise(index)}
                                                        className="bg-red-500/20 hover:bg-red-500/30 px-3 py-2 rounded text-sm"
                                                    >
                                                        âœ•
                                                    </button>
                                                )}
                                            </div>
                                        ))}
                                        <button
                                            onClick={addExercise}
                                            className="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg text-sm transition-colors"
                                        >
                                            + Add Exercise
                                        </button>
                                    </div>

                                    <button
                                        onClick={createWorkout}
                                        disabled={!newWorkout.name || !newWorkout.targetClientId}
                                        className="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition-all duration-300 disabled:opacity-50"
                                    >
                                        ğŸ¯ Create & Assign Workout
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Workouts List */}
                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">
                                    {selectedClientId ? `ğŸ’ª ${displayUser.name}'s Workouts` : 'ğŸ’ª My Workouts'}
                                </h3>
                                <button
                                    onClick={() => exportData(userData.workouts, `${displayUser.name.replace(/\s+/g, '_')}_workouts`)}
                                    className="bg-green-500/20 hover:bg-green-500/30 px-3 py-1 rounded text-sm transition-colors"
                                >
                                    ğŸ“Š Export Workouts
                                </button>
                            </div>
                            {userData.workouts.length > 0 ? (
                                <div className="space-y-4">
                                    {userData.workouts.map(workout => (
                                        <div key={workout.id} className={`p-4 rounded-lg ${
                                            workout.completedToday ? 'bg-green-500/20 border-l-4 border-green-500' : 'bg-blue-500/20 border-l-4 border-blue-500'
                                        }`}>
                                            <div className="flex justify-between items-start mb-3">
                                                <div>
                                                    <h4 className="font-medium text-lg">{workout.name}</h4>
                                                    {workout.assignedBy && (
                                                        <p className="text-sm text-gray-400">
                                                            Assigned by: {allUsers.find(u => u.id === workout.assignedBy)?.name || 'Unknown'}
                                                            {workout.createdDate && ` on ${new Date(workout.createdDate).toLocaleDateString()}`}
                                                        </p>
                                                    )}
                                                </div>
                                                <div className="flex items-center space-x-2">
                                                    <span className={`text-xs px-2 py-1 rounded ${
                                                        workout.completedToday ? 'bg-green-500 text-white' : 'bg-orange-500 text-white'
                                                    }`}>
                                                        {workout.completedToday ? 'âœ… Complete' : 'â³ Pending'}
                                                    </span>
                                                    <button
                                                        onClick={() => toggleWorkoutCompletion(workout.id)}
                                                        className={`px-3 py-1 rounded text-sm transition-colors ${
                                                            workout.completedToday 
                                                                ? 'bg-gray-600 hover:bg-gray-700 text-white' 
                                                                : 'bg-green-600 hover:bg-green-700 text-white'
                                                        }`}
                                                    >
                                                        {workout.completedToday ? 'Mark Incomplete' : 'Mark Complete'}
                                                    </button>
                                                    {(hasPermission('assignWorkouts') || workout.assignedBy === currentUser.id) && (
                                                        <button
                                                            onClick={() => deleteWorkout(workout.id)}
                                                            className="text-red-400 hover:text-red-300"
                                                        >
                                                            ğŸ—‘ï¸
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                            <div className="space-y-1">
                                                {workout.exercises.map((exercise, index) => (
                                                    <p key={index} className="text-sm text-gray-300">â€¢ {exercise}</p>
                                                ))}
                                            </div>
                                            {workout.youtubeUrl && (
                                                <div className="mt-3">
                                                    <a
                                                        href={workout.youtubeUrl}
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                        className="inline-flex items-center space-x-2 bg-red-600/20 hover:bg-red-600/30 px-4 py-2 rounded-lg text-sm transition-colors"
                                                    >
                                                        <span>ğŸ“¹</span>
                                                        <span>Watch Instructions on YouTube</span>
                                                    </a>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div className="text-center py-8 text-gray-400">
                                    <div className="text-4xl mb-2">ğŸ’ª</div>
                                    <p>No workouts available yet</p>
                                    <p className="text-sm">
                                        {hasPermission('assignWorkouts') 
                                            ? 'Create your first workout above!' 
                                            : 'Contact your specialist to get workouts assigned!'
                                        }
                                    </p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Goals Component - FULLY FUNCTIONAL
            const GoalsComponent = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;
                const [newGoal, setNewGoal] = useState({
                    title: '',
                    target: '',
                    current: '',
                    deadline: '',
                    clientId: selectedClientId || currentUser.id
                });

                const addGoal = () => {
                    if (newGoal.title && newGoal.target) {
                        const goal = {
                            id: Date.now(),
                            title: newGoal.title,
                            target: newGoal.target,
                            current: newGoal.current || '0',
                            deadline: newGoal.deadline,
                            progress: Math.round((parseFloat(newGoal.current) / parseFloat(newGoal.target)) * 100) || 0,
                            assignedBy: currentUser.id,
                            createdDate: new Date().toISOString().split('T')[0]
                        };
                        
                        updateUserData(newGoal.clientId, 'goals', goal);
                        setNewGoal({ 
                            title: '', 
                            target: '', 
                            current: '', 
                            deadline: '',
                            clientId: selectedClientId || currentUser.id
                        });

                        addNotification(`New goal added for ${displayUser.name}! ğŸ¯`);
                    }
                };

                const updateGoalProgress = (goalId, newCurrent) => {
                    const targetId = selectedClientId || currentUser.id;
                    const targetData = getUserData(targetId);
                    const updatedGoals = targetData.goals.map(goal => {
                        if (goal.id === goalId) {
                            const currentValue = parseFloat(newCurrent) || 0;
                            const targetValue = parseFloat(goal.target) || 1;
                            const progress = Math.round((currentValue / targetValue) * 100) || 0;
                            return { ...goal, current: newCurrent, progress: Math.min(progress, 100) };
                        }
                        return goal;
                    });
                    globalUserData[targetId] = { ...targetData, goals: updatedGoals };
                    saveToStorage();
                    addNotification("Goal progress updated! ğŸ¯");
                };

                const deleteGoal = (goalId) => {
                    if (confirm('Are you sure you want to delete this goal?')) {
                        deleteUserData(selectedClientId || currentUser.id, 'goals', goalId);
                        addNotification('Goal deleted successfully! ğŸ—‘ï¸');
                    }
                };

                return (
                    <div className="space-y-6">
                        {selectedClientId && (
                            <div className="card rounded-xl p-4 bg-green-500/20">
                                <p className="text-center">
                                    ğŸ¯ Managing goals for: <strong>{displayUser.name}</strong>
                                    <button
                                        onClick={() => setSelectedClientId(null)}
                                        className="ml-4 bg-gray-500/20 hover:bg-gray-500/30 px-3 py-1 rounded text-sm"
                                    >
                                        â† Back
                                    </button>
                                </p>
                            </div>
                        )}

                        <div className="card rounded-xl p-6">
                            <h3 className="text-xl font-semibold mb-4">ğŸ¯ Add New Goal</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <input
                                    type="text"
                                    placeholder="Goal Title (e.g., Weight Loss Goal)"
                                    value={newGoal.title}
                                    onChange={(e) => setNewGoal({...newGoal, title: e.target.value})}
                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                />
                                <input
                                    type="text"
                                    placeholder="Target (e.g., 150 lbs)"
                                    value={newGoal.target}
                                    onChange={(e) => setNewGoal({...newGoal, target: e.target.value})}
                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                />
                                <input
                                    type="text"
                                    placeholder="Current Progress (e.g., 165 lbs)"
                                    value={newGoal.current}
                                    onChange={(e) => setNewGoal({...newGoal, current: e.target.value})}
                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                />
                                <input
                                    type="date"
                                    value={newGoal.deadline}
                                    onChange={(e) => setNewGoal({...newGoal, deadline: e.target.value})}
                                    className="p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                />
                            </div>

                            <button
                                onClick={addGoal}
                                className="w-full bg-gradient-to-r from-green-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-green-700 hover:to-blue-700 transition-all duration-300"
                            >
                                â• Add Goal
                            </button>
                        </div>

                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">ğŸ“Š Current Goals</h3>
                                <button
                                    onClick={() => exportData(userData.goals, `${displayUser.name.replace(/\s+/g, '_')}_goals`)}
                                    className="bg-green-500/20 hover:bg-green-500/30 px-3 py-1 rounded text-sm transition-colors"
                                >
                                    ğŸ“Š Export Goals
                                </button>
                            </div>
                            {userData.goals.length > 0 ? (
                                <div className="space-y-4">
                                    {userData.goals.map(goal => (
                                        <div key={goal.id} className="bg-white/5 rounded-lg p-4">
                                            <div className="flex justify-between items-center mb-3">
                                                <div>
                                                    <h4 className="font-medium">{goal.title}</h4>
                                                    {goal.assignedBy && (
                                                        <p className="text-sm text-gray-400">
                                                            Set by: {allUsers.find(u => u.id === goal.assignedBy)?.name || 'Unknown'}
                                                            {goal.createdDate && ` on ${new Date(goal.createdDate).toLocaleDateString()}`}
                                                        </p>
                                                    )}
                                                </div>
                                                <div className="flex items-center space-x-2">
                                                    <span className={`text-sm px-2 py-1 rounded ${
                                                        goal.progress >= 100 ? 'bg-green-500 text-white' : 
                                                        goal.progress >= 75 ? 'bg-blue-500 text-white' :
                                                        goal.progress >= 50 ? 'bg-yellow-500 text-white' :
                                                        'bg-gray-500 text-white'
                                                    }`}>
                                                        {goal.progress}%
                                                    </span>
                                                    <button
                                                        onClick={() => deleteGoal(goal.id)}
                                                        className="text-red-400 hover:text-red-300"
                                                    >
                                                        ğŸ—‘ï¸
                                                    </button>
                                                </div>
                                            </div>
                                            <div className="w-full bg-gray-700 rounded-full h-3 mb-3">
                                                <div 
                                                    className={`h-3 rounded-full transition-all duration-300 ${
                                                        goal.progress >= 100 ? 'bg-gradient-to-r from-green-500 to-green-400' :
                                                        goal.progress >= 75 ? 'bg-gradient-to-r from-blue-500 to-cyan-500' :
                                                        goal.progress >= 50 ? 'bg-gradient-to-r from-yellow-500 to-orange-500' :
                                                        'bg-gradient-to-r from-gray-500 to-gray-400'
                                                    }`}
                                                    style={{ width: `${Math.min(goal.progress, 100)}%` }}
                                                ></div>
                                            </div>
                                            <div className="flex justify-between items-center text-sm text-gray-400 mb-2">
                                                <span>Current: {goal.current} / Target: {goal.target}</span>
                                                <span>Due: {goal.deadline || 'No deadline'}</span>
                                            </div>
                                            <div className="flex gap-2">
                                                <input
                                                    type="text"
                                                    placeholder="Update progress"
                                                    className="flex-1 p-2 rounded bg-white/10 border border-white/20 text-white placeholder-white/50 text-sm focus:border-blue-400 focus:outline-none"
                                                    onKeyPress={(e) => {
                                                        if (e.key === 'Enter' && e.target.value) {
                                                            updateGoalProgress(goal.id, e.target.value);
                                                            e.target.value = '';
                                                        }
                                                    }}
                                                />
                                                <button
                                                    onClick={(e) => {
                                                        const input = e.target.parentElement.querySelector('input');
                                                        if (input && input.value) {
                                                            updateGoalProgress(goal.id, input.value);
                                                            input.value = '';
                                                        }
                                                    }}
                                                    className="bg-blue-500 hover:bg-blue-600 px-3 py-2 rounded text-sm transition-colors"
                                                >
                                                    Update
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div className="text-center py-8 text-gray-400">
                                    <div className="text-4xl mb-2">ğŸ¯</div>
                                    <p>No goals set yet</p>
                                    <p className="text-sm">Add your first goal above to get started!</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Specialized Tests Component - FULLY FUNCTIONAL
            const SpecializedTestsComponent = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;
                const [newTest, setNewTest] = useState({
                    testName: '',
                    results: '',
                    date: new Date().toISOString().split('T')[0],
                    clientId: selectedClientId || currentUser.id
                });

                const testTypes = [
                    'Body Composition Analysis',
                    'VO2 Max Test',
                    'Metabolic Rate Test',
                    'Flexibility Assessment',
                    'Strength Testing',
                    'Cardiovascular Assessment',
                    'Blood Work Analysis',
                    'Hormone Panel',
                    'Food Sensitivity Test',
                    'Postural Analysis'
                ];

                const addTest = () => {
                    if (newTest.testName && newTest.results) {
                        const test = {
                            id: Date.now(),
                            testName: newTest.testName,
                            results: newTest.results,
                            date: newTest.date,
                            performedBy: currentUser.id,
                            clientId: newTest.clientId
                        };
                        
                        updateUserData(newTest.clientId, 'specializedTests', test);
                        setNewTest({
                            testName: '',
                            results: '',
                            date: new Date().toISOString().split('T')[0],
                            clientId: selectedClientId || currentUser.id
                        });

                        addNotification(`Specialized test added for ${displayUser.name}! ğŸ§ª`);
                    }
                };

                const deleteTest = (testId) => {
                    if (confirm('Are you sure you want to delete this test result?')) {
                        deleteUserData(selectedClientId || currentUser.id, 'specializedTests', testId);
                        addNotification('Test result deleted successfully! ğŸ—‘ï¸');
                    }
                };

                return (
                    <div className="space-y-6">
                        {selectedClientId && (
                            <div className="card rounded-xl p-4 bg-cyan-500/20">
                                <p className="text-center">
                                    ğŸ§ª Managing tests for: <strong>{displayUser.name}</strong>
                                    <button
                                        onClick={() => setSelectedClientId(null)}
                                        className="ml-4 bg-gray-500/20 hover:bg-gray-500/30 px-3 py-1 rounded text-sm"
                                    >
                                        â† Back
                                    </button>
                                </p>
                            </div>
                        )}

                        {hasPermission('specializedTests') && (
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">ğŸ§ª Add Specialized Test</h3>
                                <div className="space-y-4">
                                    <input
                                        type="date"
                                        value={newTest.date}
                                        onChange={(e) => setNewTest({...newTest, date: e.target.value})}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                    />
                                    
                                    <select
                                        value={newTest.testName}
                                        onChange={(e) => setNewTest({...newTest, testName: e.target.value})}
                                        className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                    >
                                        <option value="">Select Test Type</option>
                                        {testTypes.map(test => (
                                            <option key={test} value={test}>{test}</option>
                                        ))}
                                        <option value="Other">Other (Custom)</option>
                                    </select>
                                    
                                    {newTest.testName === 'Other' && (
                                        <input
                                            type="text"
                                            placeholder="Custom Test Name"
                                            onChange={(e) => setNewTest({...newTest, testName: e.target.value})}
                                            className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                        />
                                    )}
                                    
                                    <textarea
                                        placeholder="Test Results and Notes"
                                        value={newTest.results}
                                        onChange={(e) => setNewTest({...newTest, results: e.target.value})}
                                        className="w-full p-3 h-32 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none resize-none"
                                    />
                                    
                                    <button
                                        onClick={addTest}
                                        className="w-full bg-gradient-to-r from-cyan-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-cyan-700 hover:to-blue-700 transition-all duration-300"
                                    >
                                        ğŸ§ª Add Test Results
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">ğŸ“‹ Test History</h3>
                                <button
                                    onClick={() => exportData(userData.specializedTests, `${displayUser.name.replace(/\s+/g, '_')}_tests`)}
                                    className="bg-green-500/20 hover:bg-green-500/30 px-3 py-1 rounded text-sm transition-colors"
                                >
                                    ğŸ“Š Export Tests
                                </button>
                            </div>
                            {userData.specializedTests.length > 0 ? (
                                <div className="space-y-4">
                                    {userData.specializedTests.map(test => (
                                        <div key={test.id} className="bg-white/5 rounded-lg p-4">
                                            <div className="flex justify-between items-start mb-2">
                                                <div>
                                                    <h4 className="font-medium text-lg">{test.testName}</h4>
                                                    <p className="text-sm text-gray-400">
                                                        {new Date(test.date).toLocaleDateString()} â€¢ 
                                                        Performed by: {allUsers.find(u => u.id === test.performedBy)?.name || 'Unknown'}
                                                    </p>
                                                </div>
                                                {(hasPermission('specializedTests') || test.performedBy === currentUser.id) && (
                                                    <button
                                                        onClick={() => deleteTest(test.id)}
                                                        className="text-red-400 hover:text-red-300"
                                                    >
                                                        ğŸ—‘ï¸
                                                    </button>
                                                )}
                                            </div>
                                            <div className="bg-white/5 rounded p-3 mt-2">
                                                <p className="text-gray-300 whitespace-pre-wrap">{test.results}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div className="text-center py-8 text-gray-400">
                                    <div className="text-4xl mb-2">ğŸ§ª</div>
                                    <p>No specialized tests recorded yet</p>
                                    <p className="text-sm">
                                        {hasPermission('specializedTests') 
                                            ? 'Add your first test above!' 
                                            : 'Tests will appear here when performed by specialists'
                                        }
                                    </p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Chat Component with ZOOM SCHEDULING - FULLY FUNCTIONAL
            const ChatComponent = () => {
                const [selectedChat, setSelectedChat] = useState(null);
                const [currentMessage, setCurrentMessage] = useState('');
                const [showZoomScheduler, setShowZoomScheduler] = useState(false);
                const [zoomDetails, setZoomDetails] = useState({
                    date: '',
                    time: '',
                    duration: '30'
                });
                const messagesEndRef = useRef(null);

                // Initialize chat messages if not exists
                if (!chatMessages[currentUser.id]) {
                    setChatMessages(prev => ({
                        ...prev,
                        [currentUser.id]: []
                    }));
                }

                const getChatPartners = () => {
                    if (currentUser.role === 'client') {
                        // Clients can chat with their assigned specialists
                        return allUsers.filter(u => 
                            u.role === 'specialist' && 
                            currentUser.specialistIds?.includes(u.id)
                        );
                    } else if (currentUser.role === 'specialist') {
                        // Specialists can chat with their assigned clients
                        return allUsers.filter(u => 
                            u.role === 'client' && 
                            u.specialistIds?.includes(currentUser.id)
                        );
                    }
                    // Admins, owners, engineers can chat with everyone
                    return allUsers.filter(u => u.id !== currentUser.id);
                };

                const scrollToBottom = () => {
                    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
                };

                useEffect(() => {
                    scrollToBottom();
                }, [chatMessages, selectedChat]);

                const sendMessage = () => {
                    if (currentMessage.trim() && selectedChat) {
                        const chatKey = [currentUser.id, selectedChat.id].sort().join('-');
                        const newMessage = {
                            id: Date.now(),
                            text: currentMessage,
                            senderId: currentUser.id,
                            senderName: currentUser.name,
                            timestamp: new Date().toLocaleTimeString(),
                            date: new Date().toISOString()
                        };

                        setChatMessages(prev => ({
                            ...prev,
                            [chatKey]: [...(prev[chatKey] || []), newMessage]
                        }));
                        setCurrentMessage('');
                        addNotification(`Message sent to ${selectedChat.name}! ğŸ’¬`);
                    }
                };

                const scheduleZoom = () => {
                    if (zoomDetails.date && zoomDetails.time && selectedChat) {
                        const meetingDetails = {
                            id: Date.now(),
                            type: 'zoom',
                            date: zoomDetails.date,
                            time: zoomDetails.time,
                            duration: zoomDetails.duration,
                            meetingUrl: `https://zoom.us/j/${Math.floor(Math.random() * 9999999999)}`,
                            scheduledBy: currentUser.name,
                            scheduledWith: selectedChat.name
                        };

                        const chatKey = [currentUser.id, selectedChat.id].sort().join('-');
                        const zoomMessage = {
                            id: Date.now(),
                            text: `ğŸ“… Zoom Meeting Scheduled\nğŸ—“ï¸ Date: ${zoomDetails.date}\nâ° Time: ${zoomDetails.time}\nâ±ï¸ Duration: ${zoomDetails.duration} minutes\nğŸ”— Join: ${meetingDetails.meetingUrl}`,
                            senderId: currentUser.id,
                            senderName: currentUser.name,
                            timestamp: new Date().toLocaleTimeString(),
                            date: new Date().toISOString(),
                            isZoomInvite: true,
                            meetingDetails
                        };

                        setChatMessages(prev => ({
                            ...prev,
                            [chatKey]: [...(prev[chatKey] || []), zoomMessage]
                        }));

                        setShowZoomScheduler(false);
                        setZoomDetails({ date: '', time: '', duration: '30' });
                        addNotification(`Zoom meeting scheduled with ${selectedChat.name}! ğŸ¥`);
                    }
                };

                const getChatHistory = () => {
                    if (!selectedChat) return [];
                    const chatKey = [currentUser.id, selectedChat.id].sort().join('-');
                    return chatMessages[chatKey] || [];
                };

                return (
                    <div className="space-y-6">
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            {/* Chat Partners List */}
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">ğŸ’¬ Conversations</h3>
                                <div className="space-y-2">
                                    {getChatPartners().length > 0 ? (
                                        getChatPartners().map(partner => (
                                            <button
                                                key={partner.id}
                                                onClick={() => setSelectedChat(partner)}
                                                className={`w-full p-3 rounded-lg text-left transition-colors ${
                                                    selectedChat?.id === partner.id 
                                                        ? 'bg-blue-500/20 border-l-4 border-blue-500' 
                                                        : 'bg-white/5 hover:bg-white/10'
                                                }`}
                                            >
                                                <div className="flex items-center space-x-3">
                                                    <span className="text-2xl">{partner.avatar}</span>
                                                    <div>
                                                        <p className="font-medium">{partner.name}</p>
                                                        <p className="text-xs text-gray-400">
                                                            <RoleBadge role={partner.role} />
                                                        </p>
                                                    </div>
                                                </div>
                                            </button>
                                        ))
                                    ) : (
                                        <div className="text-center py-4 text-gray-400">
                                            <p>No conversations available</p>
                                            {currentUser.role === 'client' && (
                                                <p className="text-sm mt-2">You'll be able to chat once a specialist is assigned to you</p>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Chat Window */}
                            <div className="lg:col-span-2 card rounded-xl p-6">
                                {selectedChat ? (
                                    <div className="flex flex-col h-[600px]">
                                        <div className="flex justify-between items-center mb-4">
                                            <div className="flex items-center space-x-3">
                                                <span className="text-3xl">{selectedChat.avatar}</span>
                                                <div>
                                                    <h3 className="text-xl font-semibold">{selectedChat.name}</h3>
                                                    <p className="text-sm text-gray-400">{selectedChat.role}</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => setShowZoomScheduler(!showZoomScheduler)}
                                                className="zoom-button"
                                            >
                                                ğŸ¥ Schedule Zoom
                                            </button>
                                        </div>

                                        {/* Zoom Scheduler */}
                                        {showZoomScheduler && (
                                            <div className="bg-blue-500/10 rounded-lg p-4 mb-4">
                                                <h4 className="font-medium mb-3">ğŸ“… Schedule Zoom Meeting</h4>
                                                <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                                    <input
                                                        type="date"
                                                        value={zoomDetails.date}
                                                        onChange={(e) => setZoomDetails({...zoomDetails, date: e.target.value})}
                                                        min={new Date().toISOString().split('T')[0]}
                                                        className="p-2 rounded bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                                    />
                                                    <input
                                                        type="time"
                                                        value={zoomDetails.time}
                                                        onChange={(e) => setZoomDetails({...zoomDetails, time: e.target.value})}
                                                        className="p-2 rounded bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                                    />
                                                    <select
                                                        value={zoomDetails.duration}
                                                        onChange={(e) => setZoomDetails({...zoomDetails, duration: e.target.value})}
                                                        className="p-2 rounded bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                                    >
                                                        <option value="15">15 minutes</option>
                                                        <option value="30">30 minutes</option>
                                                        <option value="45">45 minutes</option>
                                                        <option value="60">1 hour</option>
                                                    </select>
                                                </div>
                                                <button
                                                    onClick={scheduleZoom}
                                                    className="mt-3 w-full bg-gradient-to-r from-blue-600 to-cyan-500 text-white py-2 rounded font-semibold hover:from-blue-700 hover:to-cyan-600 transition-all"
                                                >
                                                    ğŸ“… Send Zoom Invite
                                                </button>
                                            </div>
                                        )}
                                        
                                        {/* Messages */}
                                        <div className="flex-1 overflow-y-auto space-y-3 mb-4 p-4 bg-black/20 rounded-lg">
                                            {getChatHistory().length > 0 ? (
                                                getChatHistory().map(msg => (
                                                    <div
                                                        key={msg.id}
                                                        className={`p-3 rounded-lg max-w-xs ${
                                                            msg.senderId === currentUser.id 
                                                                ? 'bg-blue-500/20 text-blue-300 ml-auto' 
                                                                : 'bg-gray-700/50 text-gray-300 mr-auto'
                                                        }`}
                                                    >
                                                        <div className="font-medium text-xs mb-1">{msg.senderName}</div>
                                                        {msg.isZoomInvite ? (
                                                            <div className="space-y-1">
                                                                <p className="text-sm whitespace-pre-line">{msg.text}</p>
                                                                <button
                                                                    onClick={() => window.open(msg.meetingDetails.meetingUrl, '_blank')}
                                                                    className="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white py-1 px-2 rounded text-xs transition-colors"
                                                                >
                                                                    ğŸ”— Join Meeting
                                                                </button>
                                                            </div>
                                                        ) : (
                                                            <div className="text-sm whitespace-pre-line">{msg.text}</div>
                                                        )}
                                                        <div className="text-xs text-gray-500 mt-1">{msg.timestamp}</div>
                                                    </div>
                                                ))
                                            ) : (
                                                <div className="text-center py-8 text-gray-400">
                                                    <p>No messages yet. Start the conversation!</p>
                                                </div>
                                            )}
                                            <div ref={messagesEndRef} />
                                        </div>
                                        
                                        {/* Message Input */}
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                value={currentMessage}
                                                onChange={(e) => setCurrentMessage(e.target.value)}
                                                onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                                                placeholder="Type your message..."
                                                className="flex-1 p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <button
                                                onClick={sendMessage}
                                                className="bg-gradient-to-r from-blue-500 to-cyan-500 px-6 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-cyan-600 transition-all duration-300"
                                            >
                                                ğŸ“¤
                                            </button>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="flex items-center justify-center h-[600px] text-gray-400">
                                        <div className="text-center">
                                            <div className="text-6xl mb-4">ğŸ’¬</div>
                                            <p className="text-xl">Select a conversation to start chatting</p>
                                            <p className="text-sm mt-2">You can also schedule Zoom meetings!</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // Users Component - FULLY FUNCTIONAL
            const UsersComponent = () => {
                const [editingUser, setEditingUser] = useState(null);
                const [showAddUser, setShowAddUser] = useState(false);
                const [newUser, setNewUser] = useState({
                    name: '',
                    email: '',
                    password: '',
                    role: 'client'
                });

                const updateUserRole = (userId, newRole) => {
                    setAllUsers(users => users.map(user => 
                        user.id === userId ? { ...user, role: newRole } : user
                    ));
                    addNotification(`User role updated to ${newRole}! ğŸ‘¥`);
                };

                const addSpecialistToClient = (clientId, specialistId) => {
                    setAllUsers(users => users.map(user => {
                        if (user.id === clientId) {
                            const currentSpecialists = user.specialistIds || [];
                            if (!currentSpecialists.includes(specialistId)) {
                                return { ...user, specialistIds: [...currentSpecialists, specialistId] };
                            }
                        }
                        return user;
                    }));
                    addNotification("Specialist assigned successfully! ğŸ‘©â€âš•ï¸");
                };

                const removeSpecialistFromClient = (clientId, specialistId) => {
                    setAllUsers(users => users.map(user => {
                        if (user.id === clientId && user.specialistIds) {
                            return { ...user, specialistIds: user.specialistIds.filter(id => id !== specialistId) };
                        }
                        return user;
                    }));
                    addNotification("Specialist removed successfully! ğŸ‘©â€âš•ï¸");
                };

                const getFilteredUsers = () => {
                    if (currentUser.role === 'specialist') {
                        return allUsers.filter(user => 
                            user.role === 'client' && 
                            (user.specialistIds?.includes(currentUser.id) || !user.specialistIds?.length)
                        );
                    }
                    return allUsers;
                };

                const canEditUser = (user) => {
                    if (currentUser.role === 'owner') return true;
                    if (currentUser.role === 'admin' && user.role !== 'owner') return true;
                    if (currentUser.role === 'specialist' && user.role === 'client') return true;
                    return false;
                };

                const addNewUser = () => {
                    if (newUser.name && newUser.email && newUser.password) {
                        const user = {
                            id: `${newUser.role}_${Date.now()}`,
                            ...newUser,
                            avatar: newUser.role === 'client' ? 'ğŸ‘¤' : 
                                    newUser.role === 'specialist' ? 'ğŸ‘©â€âš•ï¸' :
                                    newUser.role === 'admin' ? 'ğŸ›¡ï¸' :
                                    newUser.role === 'owner' ? 'ğŸ‘‘' : 'ğŸ”§',
                            specialistIds: newUser.role === 'client' ? [] : undefined
                        };
                        
                        setAllUsers(prev => [...prev, user]);
                        initializeUserData(user.id);
                        setShowAddUser(false);
                        setNewUser({ name: '', email: '', password: '', role: 'client' });
                        addNotification(`New ${user.role} user created: ${user.name}! ğŸ‘¥`);
                    }
                };

                const deleteUser = (userId) => {
                    if (userId === currentUser.id) {
                        alert("You cannot delete your own account!");
                        return;
                    }
                    
                    if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                        setAllUsers(users => users.filter(u => u.id !== userId));
                        delete globalUserData[userId];
                        saveToStorage();
                        addNotification('User deleted successfully! ğŸ—‘ï¸');
                    }
                };

                return (
                    <div className="space-y-6">
                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">ğŸ‘¥ User Management</h3>
                                <div className="flex space-x-2">
                                    {(currentUser.role === 'owner' || currentUser.role === 'admin') && (
                                        <button
                                            onClick={() => setShowAddUser(true)}
                                            className="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg text-sm transition-colors"
                                        >
                                            â• Add User
                                        </button>
                                    )}
                                    <button
                                        onClick={() => exportData(allUsers, 'users_list')}
                                        className="bg-green-500/20 hover:bg-green-500/30 px-3 py-1 rounded text-sm transition-colors"
                                    >
                                        ğŸ“Š Export Users
                                    </button>
                                </div>
                            </div>
                            
                            {/* Add User Modal */}
                            {showAddUser && (
                                <div className="modal">
                                    <div className="bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4">
                                        <h3 className="text-xl font-semibold mb-4">â• Add New User</h3>
                                        <div className="space-y-4">
                                            <input
                                                type="text"
                                                placeholder="Full Name"
                                                value={newUser.name}
                                                onChange={(e) => setNewUser({...newUser, name: e.target.value})}
                                                className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="email"
                                                placeholder="Email"
                                                value={newUser.email}
                                                onChange={(e) => setNewUser({...newUser, email: e.target.value})}
                                                className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <input
                                                type="password"
                                                placeholder="Password"
                                                value={newUser.password}
                                                onChange={(e) => setNewUser({...newUser, password: e.target.value})}
                                                className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:border-blue-400 focus:outline-none"
                                            />
                                            <select
                                                value={newUser.role}
                                                onChange={(e) => setNewUser({...newUser, role: e.target.value})}
                                                className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                            >
                                                <option value="client">Client</option>
                                                <option value="specialist">Specialist</option>
                                                {currentUser.role === 'owner' && (
                                                    <>
                                                        <option value="admin">Admin</option>
                                                        <option value="engineer">Engineer</option>
                                                    </>
                                                )}
                                            </select>
                                            <div className="flex space-x-2">
                                                <button
                                                    onClick={addNewUser}
                                                    className="flex-1 bg-blue-500 hover:bg-blue-600 py-2 rounded-lg transition-colors"
                                                >
                                                    Create User
                                                </button>
                                                <button
                                                    onClick={() => setShowAddUser(false)}
                                                    className="flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded-lg transition-colors"
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            <div className="table-container overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr className="border-b border-gray-700">
                                            <th className="text-left p-3">User</th>
                                            <th className="text-left p-3">Role</th>
                                            <th className="text-left p-3">Email</th>
                                            <th className="text-left p-3">Specialists</th>
                                            <th className="text-left p-3">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {getFilteredUsers().map(user => (
                                            <tr key={user.id} className="border-b border-gray-800 hover:bg-white/5">
                                                <td className="p-3">
                                                    <div className="flex items-center space-x-3">
                                                        <span className="text-2xl">{user.avatar}</span>
                                                        <span className="font-medium">{user.name}</span>
                                                    </div>
                                                </td>
                                                <td className="p-3">
                                                    <RoleBadge role={user.role} />
                                                </td>
                                                <td className="p-3 text-gray-400">{user.email}</td>
                                                <td className="p-3">
                                                    {user.role === 'client' && (
                                                        <div className="space-y-2">
                                                            {user.specialistIds?.length > 0 ? (
                                                                <div className="space-y-1">
                                                                    {user.specialistIds.map(specialistId => {
                                                                        const specialist = allUsers.find(u => u.id === specialistId);
                                                                        return specialist ? (
                                                                            <div key={specialistId} className="flex items-center space-x-2">
                                                                                <span className="text-green-400 text-xs">
                                                                                    {specialist.name}
                                                                                </span>
                                                                                {hasPermission('assignSpecialist') && (
                                                                                    <button
                                                                                        onClick={() => removeSpecialistFromClient(user.id, specialistId)}
                                                                                        className="text-red-400 hover:text-red-300 text-xs"
                                                                                    >
                                                                                        âœ•
                                                                                    </button>
                                                                                )}
                                                                            </div>
                                                                        ) : null;
                                                                    })}
                                                                </div>
                                                            ) : (
                                                                <span className="text-orange-400 text-xs">Unassigned</span>
                                                            )}
                                                            
                                                            {hasPermission('assignSpecialist') && (
                                                                <select
                                                                    onChange={(e) => {
                                                                        if (e.target.value) {
                                                                            addSpecialistToClient(user.id, e.target.value);
                                                                            e.target.value = '';
                                                                        }
                                                                    }}
                                                                    className="bg-white/10 border border-white/20 rounded px-2 py-1 text-xs w-full"
                                                                >
                                                                    <option value="">+ Add Specialist</option>
                                                                    {allUsers.filter(u => 
                                                                        u.role === 'specialist' && 
                                                                        !user.specialistIds?.includes(u.id)
                                                                    ).map(specialist => (
                                                                        <option key={specialist.id} value={specialist.id}>
                                                                            {specialist.name}
                                                                        </option>
                                                                    ))}
                                                                </select>
                                                            )}
                                                        </div>
                                                    )}
                                                </td>
                                                <td className="p-3">
                                                    {canEditUser(user) && (
                                                        <div className="flex space-x-2">
                                                            {user.role === 'client' && (
                                                                <button
                                                                    onClick={() => {
                                                                        setSelectedClientId(user.id);
                                                                        setActiveTab('dashboard');
                                                                    }}
                                                                    className="bg-blue-500/20 hover:bg-blue-500/30 px-2 py-1 rounded text-xs"
                                                                >
                                                                    View Data
                                                                </button>
                                                            )}
                                                            
                                                            {(currentUser.role === 'owner' || (currentUser.role === 'admin' && user.role !== 'owner')) && (
                                                                <select
                                                                    value={user.role}
                                                                    onChange={(e) => updateUserRole(user.id, e.target.value)}
                                                                    className="bg-white/10 border border-white/20 rounded px-2 py-1 text-xs"
                                                                >
                                                                    <option value="client">Client</option>
                                                                    <option value="specialist">Specialist</option>
                                                                    <option value="admin">Admin</option>
                                                                    {currentUser.role === 'owner' && <option value="engineer">Engineer</option>}
                                                                </select>
                                                            )}
                                                            
                                                            {(currentUser.role === 'owner' || currentUser.role === 'admin') && user.id !== currentUser.id && (
                                                                <button
                                                                    onClick={() => deleteUser(user.id)}
                                                                    className="text-red-400 hover:text-red-300"
                                                                >
                                                                    ğŸ—‘ï¸
                                                                </button>
                                                            )}
                                                        </div>
                                                    )}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Client Overview Cards */}
                        {(hasPermission('viewClients') || hasPermission('viewAllUsers')) && (
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">ğŸ“Š Client Overview</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {allUsers.filter(user => user.role === 'client').map(client => {
                                        const clientData = getUserData(client.id);
                                        const latestWithWeight = clientData.measurements.filter(m => m.weight > 0).pop();
                                        const completedGoals = clientData.goals.filter(g => g.progress >= 100).length;
                                        
                                        return (
                                            <div key={client.id} className="bg-white/5 rounded-lg p-4 hover:bg-white/10 transition-colors">
                                                <div className="flex items-center space-x-3 mb-3">
                                                    <span className="text-2xl">{client.avatar}</span>
                                                    <div>
                                                        <h4 className="font-medium">{client.name}</h4>
                                                        <p className="text-sm text-gray-400">{client.email}</p>
                                                    </div>
                                                </div>
                                                <div className="space-y-2 text-sm">
                                                    <p><span className="text-gray-400">Specialists:</span> {
                                                        client.specialistIds?.length > 0
                                                            ? client.specialistIds.map(id => allUsers.find(u => u.id === id)?.name).filter(Boolean).join(', ')
                                                            : 'Unassigned'
                                                    }</p>
                                                    <p><span className="text-gray-400">Measurements:</span> {clientData.measurements.length}</p>
                                                    <p><span className="text-gray-400">Goals:</span> {completedGoals}/{clientData.goals.length}</p>
                                                    <p><span className="text-gray-400">Tests:</span> {clientData.specializedTests.length}</p>
                                                    {latestWithWeight && (
                                                        <p><span className="text-gray-400">Weight:</span> {latestWithWeight.weight} lbs</p>
                                                    )}
                                                </div>
                                                <button
                                                    onClick={() => {
                                                        setSelectedClientId(client.id);
                                                        setActiveTab('dashboard');
                                                    }}
                                                    className="w-full mt-3 bg-blue-500/20 hover:bg-blue-500/30 py-2 rounded text-sm transition-colors"
                                                >
                                                    View Full Profile
                                                </button>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Engineer Component with REAL functionality
            const EngineerComponent = () => {
                const [customCode, setCustomCode] = useState('// Enter custom JavaScript code here\nconsole.log("Hello from Engineer Mode!");');
                const [theme, setTheme] = useState(appConfig.theme);

                const updateAppConfig = (key, value) => {
                    setAppConfig(prev => ({
                        ...prev,
                        [key]: value
                    }));
                    addNotification(`App ${key} updated! ğŸ”§`);
                };

                const updateFeature = (feature, enabled) => {
                    setAppConfig(prev => ({
                        ...prev,
                        features: {
                            ...prev.features,
                            [feature]: enabled
                        }
                    }));
                    addNotification(`Feature ${feature} ${enabled ? 'enabled' : 'disabled'}! ğŸ”§`);
                };

                const executeCustomCode = () => {
                    try {
                        // Create a sandboxed environment for code execution
                        const func = new Function('console', 'alert', 'addNotification', customCode);
                        func(console, alert, addNotification);
                        addNotification("Custom code executed successfully! ğŸ’»", 'success');
                    } catch (error) {
                        addNotification(`Code error: ${error.message}`, 'error');
                    }
                };

                const resetAppData = () => {
                    if (confirm('âš ï¸ This will reset ALL user data (except demo accounts). Are you sure?')) {
                        // Reset to only demo accounts
                        globalUserDatabase = Object.values(demoAccounts);
                        globalUserData = demoUserData;
                        setAllUsers(globalUserDatabase);
                        saveToStorage();
                        addNotification("App data has been reset! ğŸ”„");
                    }
                };

                const clearAllData = () => {
                    if (confirm('âš ï¸ This will clear ALL data including demo accounts. Are you sure?')) {
                        if (confirm('âš ï¸ FINAL WARNING: This action cannot be undone. Continue?')) {
                            localStorage.clear();
                            globalUserDatabase = [];
                            globalUserData = {};
                            globalAppConfig = {};
                            window.location.reload();
                        }
                    }
                };

                const generateSystemReport = () => {
                    const systemData = {
                        totalUsers: allUsers.length,
                        usersByRole: {
                            clients: allUsers.filter(u => u.role === 'client').length,
                            specialists: allUsers.filter(u => u.role === 'specialist').length,
                            admins: allUsers.filter(u => u.role === 'admin').length,
                            owners: allUsers.filter(u => u.role === 'owner').length,
                            engineers: allUsers.filter(u => u.role === 'engineer').length
                        },
                        totalMeasurements: Object.values(globalUserData).reduce((sum, data) => sum + (data.measurements?.length || 0), 0),
                        totalGoals: Object.values(globalUserData).reduce((sum, data) => sum + (data.goals?.length || 0), 0),
                        totalWorkouts: Object.values(globalUserData).reduce((sum, data) => sum + (data.workouts?.length || 0), 0),
                        totalTests: Object.values(globalUserData).reduce((sum, data) => sum + (data.specializedTests?.length || 0), 0),
                        appConfig: appConfig,
                        timestamp: new Date().toISOString()
                    };
                    
                    exportData(systemData, 'system_report');
                    addNotification("System report generated! ğŸ“Š");
                };

                const applyTheme = (selectedTheme) => {
                    setTheme(selectedTheme);
                    updateAppConfig('theme', selectedTheme);
                    
                    // Apply theme changes
                    switch(selectedTheme) {
                        case 'dark-mode':
                            document.body.style.filter = 'brightness(0.8) contrast(1.2)';
                            break;
                        case 'medical-green':
                            document.body.style.filter = 'hue-rotate(45deg)';
                            break;
                        case 'fitness-orange':
                            document.body.style.filter = 'hue-rotate(-30deg) saturate(1.2)';
                            break;
                        default:
                            document.body.style.filter = 'none';
                    }
                };

                return (
                    <div className="space-y-6">
                        <div className="card rounded-xl p-6">
                            <h3 className="text-xl font-semibold mb-4">ğŸ”§ System Engineering Dashboard</h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
                                <div className="bg-blue-500/20 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">ğŸ‘¥ Total Users</h4>
                                    <p className="text-2xl font-bold text-blue-400">{allUsers.length}</p>
                                </div>
                                <div className="bg-green-500/20 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">ğŸ‘¤ Clients</h4>
                                    <p className="text-2xl font-bold text-green-400">
                                        {allUsers.filter(u => u.role === 'client').length}
                                    </p>
                                </div>
                                <div className="bg-purple-500/20 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">ğŸ‘©â€âš•ï¸ Specialists</h4>
                                    <p className="text-2xl font-bold text-purple-400">
                                        {allUsers.filter(u => u.role === 'specialist').length}
                                    </p>
                                </div>
                                <div className="bg-orange-500/20 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">ğŸ“Š Measurements</h4>
                                    <p className="text-2xl font-bold text-orange-400">
                                        {Object.values(globalUserData).reduce((sum, data) => sum + (data.measurements?.length || 0), 0)}
                                    </p>
                                </div>
                                <div className="bg-cyan-500/20 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">ğŸ¯ Goals</h4>
                                    <p className="text-2xl font-bold text-cyan-400">
                                        {Object.values(globalUserData).reduce((sum, data) => sum + (data.goals?.length || 0), 0)}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">ğŸ¨ App Configuration</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">App Name</label>
                                        <input
                                            type="text"
                                            value={appConfig.appName}
                                            onChange={(e) => {
                                                updateAppConfig('appName', e.target.value);
                                                document.title = e.target.value;
                                            }}
                                            className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Theme</label>
                                        <select 
                                            value={theme}
                                            onChange={(e) => applyTheme(e.target.value)}
                                            className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:border-blue-400 focus:outline-none"
                                        >
                                            <option value="coastal-blue">Coastal Blue (Default)</option>
                                            <option value="medical-green">Medical Green</option>
                                            <option value="fitness-orange">Fitness Orange</option>
                                            <option value="dark-mode">Dark Mode</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Feature Toggles</label>
                                        <div className="space-y-2">
                                            {Object.entries(appConfig.features).map(([feature, enabled]) => (
                                                <label key={feature} className="flex items-center space-x-2">
                                                    <input 
                                                        type="checkbox" 
                                                        checked={enabled}
                                                        onChange={(e) => updateFeature(feature, e.target.checked)}
                                                        className="rounded"
                                                    />
                                                    <span className="capitalize">{feature}</span>
                                                </label>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                        <input 
                                            type="checkbox" 
                                            checked={appConfig.notifications}
                                            onChange={(e) => updateAppConfig('notifications', e.target.checked)}
                                            className="rounded"
                                        />
                                        <span>Enable Notifications</span>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                        <input 
                                            type="checkbox" 
                                            checked={appConfig.exportEnabled}
                                            onChange={(e) => updateAppConfig('exportEnabled', e.target.checked)}
                                            className="rounded"
                                        />
                                        <span>Enable Data Export</span>
                                    </div>
                                </div>
                            </div>

                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">ğŸ’» Custom Code Editor</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">JavaScript Code</label>
                                        <textarea
                                            value={customCode}
                                            onChange={(e) => setCustomCode(e.target.value)}
                                            className="w-full h-48 p-3 rounded-lg bg-gray-800 border border-gray-600 text-green-300 font-mono text-sm focus:border-blue-400 focus:outline-none resize-none"
                                            placeholder="Enter custom JavaScript code..."
                                        />
                                    </div>
                                    <button
                                        onClick={executeCustomCode}
                                        className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition-all duration-300"
                                    >
                                        ğŸš€ Execute Custom Code
                                    </button>
                                </div>

                                <div className="mt-6">
                                    <h4 className="font-medium mb-3">âš¡ Quick Actions</h4>
                                    <div className="space-y-2">
                                        <button
                                            onClick={() => {
                                                const colors = ['#1e40af', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
                                                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                                                document.querySelector('.coastal-wave').style.background = randomColor;
                                                addNotification("Logo color changed! ğŸ¨");
                                            }}
                                            className="w-full bg-blue-500/20 hover:bg-blue-500/30 py-2 rounded text-sm"
                                        >
                                            ğŸ¨ Randomize Logo Color
                                        </button>
                                        <button
                                            onClick={() => {
                                                alert(`
System Status Report:
- Users: ${allUsers.length}
- Total Data Points: ${Object.values(globalUserData).reduce((sum, data) => sum + (data.measurements?.length || 0), 0)}
- Active Features: ${Object.values(appConfig.features).filter(f => f).length}
- Theme: ${appConfig.theme}
- Last Update: ${new Date().toLocaleString()}
                                                `);
                                            }}
                                            className="w-full bg-green-500/20 hover:bg-green-500/30 py-2 rounded text-sm"
                                        >
                                            ğŸ“Š Show System Status
                                        </button>
                                        <button
                                            onClick={generateSystemReport}
                                            className="w-full bg-purple-500/20 hover:bg-purple-500/30 py-2 rounded text-sm"
                                        >
                                            ğŸ“¥ Generate System Report
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">ğŸ’¾ System Management</h3>
                                <div className="flex space-x-3">
                                    <button
                                        onClick={() => exportData({
                                            users: allUsers,
                                            userData: globalUserData,
                                            config: appConfig,
                                            chatMessages: chatMessages,
                                            timestamp: new Date().toISOString()
                                        }, 'complete_system_backup')}
                                        className="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg text-sm transition-colors"
                                    >
                                        ğŸ“¥ Full System Export
                                    </button>
                                    <button 
                                        onClick={resetAppData}
                                        className="bg-orange-500 hover:bg-orange-600 px-4 py-2 rounded-lg text-sm transition-colors"
                                    >
                                        ğŸ”„ Reset to Demo Data
                                    </button>
                                    <button
                                        onClick={clearAllData}
                                        className="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg text-sm transition-colors"
                                    >
                                        âš ï¸ Clear All Data
                                    </button>
                                    <button
                                        onClick={() => window.location.reload()}
                                        className="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg text-sm transition-colors"
                                    >
                                        ğŸ”ƒ Restart App
                                    </button>
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div className="bg-white/5 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">ğŸ” Security Status</h4>
                                    <p className="text-green-400 text-sm">All systems secure</p>
                                    <p className="text-xs text-gray-400 mt-1">Passwords stored locally</p>
                                </div>
                                <div className="bg-white/5 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">ğŸ“ˆ Performance</h4>
                                    <p className="text-blue-400 text-sm">Optimal performance</p>
                                    <p className="text-xs text-gray-400 mt-1">React 18 + Tailwind</p>
                                </div>
                                <div className="bg-white/5 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">ğŸ’¾ Storage Used</h4>
                                    <p className="text-orange-400 text-sm">
                                        {(JSON.stringify(localStorage).length / 1024).toFixed(2)} KB
                                    </p>
                                    <p className="text-xs text-gray-400 mt-1">LocalStorage</p>
                                </div>
                                <div className="bg-white/5 p-4 rounded-lg">
                                    <h4 className="font-medium mb-2">âš¡ App Version</h4>
                                    <p className="text-purple-400 text-sm">v1.0.0</p>
                                    <p className="text-xs text-gray-400 mt-1">Coastal Fitness</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Reports Component - FULLY FUNCTIONAL
            const ReportsComponent = () => {
                const userData = getUserData(selectedClientId || currentUser.id);
                const displayUser = selectedClientId ? allUsers.find(u => u.id === selectedClientId) : currentUser;

                const generateReport = () => {
                    if (userData.measurements.length === 0) {
                        return {
                            period: 'No data available',
                            weightChange: 0,
                            bodyFatChange: 0,
                            muscleChange: 0,
                            goalsCompleted: userData.goals.filter(g => g.progress >= 100).length,
                            totalGoals: userData.goals.length,
                            avgProgress: userData.goals.length > 0 ? Math.round(userData.goals.reduce((sum, g) => sum + g.progress, 0) / userData.goals.length) : 0,
                            workoutsCompleted: userData.workouts.filter(w => w.completedToday).length,
                            totalWorkouts: userData.workouts.length,
                            nutritionCompliance: userData.nutritionPlan.dailyTargets.calories > 0 ? Math.round((userData.nutritionPlan.currentIntake.calories / userData.nutritionPlan.dailyTargets.calories) * 100) : 0,
                            measurementCount: 0,
                            testCount: userData.specializedTests.length,
                            measurementTypes: { basic: 0, circumference: 0, parrillo: 0 }
                        };
                    }

                    const latestMeasurement = userData.measurements[userData.measurements.length - 1];
                    const firstMeasurement = userData.measurements[0];
                    
                    const weightChange = latestMeasurement.weight - firstMeasurement.weight;
                    const bodyFatChange = (latestMeasurement.bodyFat || 0) - (firstMeasurement.bodyFat || 0);
                    const muscleChange = (latestMeasurement.muscle || 0) - (firstMeasurement.muscle || 0);

                    // Count measurement types
                    const measurementTypes = userData.measurements.reduce((acc, m) => {
                        const type = m.type || 'basic';
                        acc[type] = (acc[type] || 0) + 1;
                        return acc;
                    }, { basic: 0, circumference: 0, parrillo: 0 });

                    return {
                        period: `${firstMeasurement.date} to ${latestMeasurement.date}`,
                        weightChange,
                        bodyFatChange,
                        muscleChange,
                        goalsCompleted: userData.goals.filter(g => g.progress >= 100).length,
                        totalGoals: userData.goals.length,
                        avgProgress: userData.goals.length > 0 ? Math.round(userData.goals.reduce((sum, g) => sum + g.progress, 0) / userData.goals.length) : 0,
                        workoutsCompleted: userData.workouts.filter(w => w.completedToday).length,
                        totalWorkouts: userData.workouts.length,
                        nutritionCompliance: userData.nutritionPlan.dailyTargets.calories > 0 ? Math.round((userData.nutritionPlan.currentIntake.calories / userData.nutritionPlan.dailyTargets.calories) * 100) : 0,
                        measurementCount: userData.measurements.length,
                        testCount: userData.specializedTests.length,
                        measurementTypes
                    };
                };

                const report = generateReport();

                const exportReport = () => {
                    const reportData = {
                        generatedAt: new Date().toISOString(),
                        user: displayUser.name,
                        email: displayUser.email,
                        role: displayUser.role,
                        specialists: displayUser.specialistIds ? displayUser.specialistIds.map(id => allUsers.find(u => u.id === id)?.name).filter(Boolean) : [],
                        summary: report,
                        measurements: userData.measurements,
                        goals: userData.goals,
                        workouts: userData.workouts,
                        nutrition: userData.nutritionPlan,
                        specializedTests: userData.specializedTests
                    };
                    
                    exportData(reportData, `${displayUser.name.replace(/\s+/g, '_')}_health_report`);
                    addNotification("Health report exported! ğŸ“Š");
                };

                const printReport = () => {
                    window.print();
                    addNotification("Report sent to printer! ğŸ–¨ï¸");
                };

                return (
                    <div className="space-y-6">
                        {selectedClientId && (
                            <div className="card rounded-xl p-4 bg-blue-500/20">
                                <p className="text-center">
                                    ğŸ“ˆ Viewing report for: <strong>{displayUser.name}</strong>
                                    <button
                                        onClick={() => setSelectedClientId(null)}
                                        className="ml-4 bg-gray-500/20 hover:bg-gray-500/30 px-3 py-1 rounded text-sm"
                                    >
                                        â† Back
                                    </button>
                                </p>
                            </div>
                        )}

                        <div className="card rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-semibold">ğŸ“ˆ Health Progress Report</h3>
                                <div className="flex space-x-2">
                                    <button
                                        onClick={printReport}
                                        className="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg text-sm transition-colors"
                                    >
                                        ğŸ–¨ï¸ Print Report
                                    </button>
                                    <button
                                        onClick={exportReport}
                                        className="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg text-sm transition-colors"
                                    >
                                        ğŸ“Š Export Full Report
                                    </button>
                                </div>
                            </div>
                            
                            {/* Report Summary */}
                            <div className="mb-6 p-4 bg-white/5 rounded-lg">
                                <div className="flex items-center space-x-3 mb-3">
                                    <span className="text-3xl">{displayUser.avatar}</span>
                                    <div>
                                        <h4 className="text-lg font-semibold">{displayUser.name}</h4>
                                        <p className="text-sm text-gray-400">{displayUser.email} â€¢ {displayUser.role}</p>
                                    </div>
                                </div>
                                <p className="text-sm text-gray-400">Report Period: {report.period}</p>
                                <p className="text-sm text-gray-400">Generated: {new Date().toLocaleDateString()}</p>
                            </div>

                            {userData.measurements.length > 0 ? (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">ğŸ“Š Weight Progress</h4>
                                        <p className={`text-2xl font-bold ${report.weightChange < 0 ? 'text-green-400' : report.weightChange > 0 ? 'text-orange-400' : 'text-gray-400'}`}>
                                            {report.weightChange > 0 ? '+' : ''}{report.weightChange.toFixed(1)} lbs
                                        </p>
                                        <p className="text-sm text-gray-400">Overall change</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">ğŸ”¥ Body Fat Change</h4>
                                        <p className={`text-2xl font-bold ${report.bodyFatChange < 0 ? 'text-green-400' : report.bodyFatChange > 0 ? 'text-orange-400' : 'text-gray-400'}`}>
                                            {report.bodyFatChange > 0 ? '+' : ''}{report.bodyFatChange.toFixed(1)}%
                                        </p>
                                        <p className="text-sm text-gray-400">Overall change</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">ğŸ’ª Muscle Change</h4>
                                        <p className={`text-2xl font-bold ${report.muscleChange > 0 ? 'text-green-400' : report.muscleChange < 0 ? 'text-orange-400' : 'text-gray-400'}`}>
                                            {report.muscleChange > 0 ? '+' : ''}{report.muscleChange.toFixed(1)} lbs
                                        </p>
                                        <p className="text-sm text-gray-400">Muscle mass change</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">ğŸ¯ Goals Completed</h4>
                                        <p className="text-2xl font-bold text-blue-400">
                                            {report.goalsCompleted}/{report.totalGoals}
                                        </p>
                                        <p className="text-sm text-gray-400">Achievement rate</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">ğŸ“ˆ Average Progress</h4>
                                        <p className="text-2xl font-bold text-green-400">{report.avgProgress}%</p>
                                        <p className="text-sm text-gray-400">Across all goals</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">ğŸ’ª Workout Completion</h4>
                                        <p className="text-2xl font-bold text-purple-400">
                                            {report.workoutsCompleted}/{report.totalWorkouts}
                                        </p>
                                        <p className="text-sm text-gray-400">Today's progress</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">ğŸ¥— Nutrition Compliance</h4>
                                        <p className="text-2xl font-bold text-green-400">{report.nutritionCompliance}%</p>
                                        <p className="text-sm text-gray-400">Calorie target met</p>
                                    </div>

                                    <div className="bg-white/5 rounded-lg p-4">
                                        <h4 className="font-medium mb-2">ğŸ“‹ Total Records</h4>
                                        <p className="text-sm text-blue-400">Measurements: {report.measurementCount}</p>
                                        <p className="text-xs text-gray-400">Basic: {report.measurementTypes.basic}</p>
                                        <p className="text-xs text-gray-400">Circumference: {report.measurementTypes.circumference}</p>
                                        <p className="text-xs text-gray-400">Parrillo: {report.measurementTypes.parrillo}</p>
                                        <p className="text-sm text-purple-400 mt-1">Tests: {report.testCount}</p>
                                    </div>
                                </div>
                            ) : (
                                <div className="text-center py-12 text-gray-400">
                                    <div className="text-6xl mb-4">ğŸ“Š</div>
                                    <h4 className="text-2xl font-bold mb-2">No Data to Report</h4>
                                    <p className="text-lg mb-4">Start tracking measurements to generate health reports</p>
                                    <button
                                        onClick={() => setActiveTab('measurements')}
                                        className="bg-gradient-to-r from-blue-600 to-cyan-500 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-cyan-600 transition-all duration-300"
                                    >
                                        ğŸ“ Add First Measurement
                                    </button>
                                </div>
                            )}
                        </div>

                        {userData.measurements.length > 0 && (
                            <div className="card rounded-xl p-6">
                                <h3 className="text-xl font-semibold mb-4">ğŸ“‹ Detailed Analysis</h3>
                                <div className="space-y-4">
                                    <div className="p-4 bg-green-500/10 border-l-4 border-green-500 rounded">
                                        <h4 className="font-medium text-green-400 mb-2">âœ… Achievements</h4>
                                        <ul className="text-sm space-y-1">
                                            <li>â€¢ {userData.measurements.length} health measurements recorded</li>
                                            <li>â€¢ {report.goalsCompleted} goals completed successfully</li>
                                            <li>â€¢ {userData.workouts.length} workouts in program</li>
                                            <li>â€¢ {userData.specializedTests.length} specialized tests performed</li>
                                            {report.weightChange !== 0 && <li>â€¢ Weight change of {report.weightChange.toFixed(1)} lbs achieved</li>}
                                            {userData.nutritionPlan.assignedBy && <li>â€¢ Custom nutrition plan assigned and tracked</li>}
                                        </ul>
                                    </div>

                                    <div className="p-4 bg-blue-500/10 border-l-4 border-blue-500 rounded">
                                        <h4 className="font-medium text-blue-400 mb-2">ğŸ“Š Recommendations</h4>
                                        <ul className="text-sm space-y-1">
                                            <li>â€¢ Continue consistent health tracking</li>
                                            <li>â€¢ Maintain regular communication with specialists</li>
                                            <li>â€¢ Focus on completing assigned workouts</li>
                                            <li>â€¢ Track nutrition intake daily for best results</li>
                                            {report.avgProgress < 80 && <li>â€¢ Consider adjusting goals for better achievement rates</li>}
                                            {userData.specializedTests.length === 0 && <li>â€¢ Schedule specialized tests for comprehensive health assessment</li>}
                                        </ul>
                                    </div>

                                    <div className="p-4 bg-orange-500/10 border-l-4 border-orange-500 rounded">
                                        <h4 className="font-medium text-orange-400 mb-2">âš ï¸ Areas for Improvement</h4>
                                        <ul className="text-sm space-y-1">
                                            {report.workoutsCompleted === 0 && report.totalWorkouts > 0 && <li>â€¢ Complete assigned workouts for better progress</li>}
                                            {report.nutritionCompliance < 80 && <li>â€¢ Improve nutrition plan adherence</li>}
                                            {userData.measurements.length < 5 && <li>â€¢ Increase measurement frequency for better tracking</li>}
                                            {userData.goals.length === 0 && <li>â€¢ Set specific health goals to track progress</li>}
                                            {report.avgProgress < 50 && <li>â€¢ Review and adjust current goals for achievability</li>}
                                            <li>â€¢ Consider scheduling regular check-ins with specialists</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Main content renderer
            const renderContent = () => {
                switch(activeTab) {
                    case 'dashboard':
                        return <Dashboard />;
                    case 'measurements':
                        return <MeasurementsComponent />;
                    case 'nutrition':
                        return <NutritionComponent />;
                    case 'workouts':
                        return <WorkoutsComponent />;
                    case 'goals':
                        return <GoalsComponent />;
                    case 'tests':
                        return <SpecializedTestsComponent />;
                    case 'chat':
                        return <ChatComponent />;
                    case 'users':
                        return <UsersComponent />;
                    case 'engineer':
                        return <EngineerComponent />;
                    case 'reports':
                        return <ReportsComponent />;
                    default:
                        return <Dashboard />;
                }
            };

            // Main App Return
            if (!currentUser) {
                return <LoginForm />;
            }

            return (
                <div className="min-h-screen gradient-bg p-4">
                    <div className="max-w-7xl mx-auto">
                        <Navigation />
                        {renderContent()}
                    </div>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    
    <!-- PWA Support -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(err => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>