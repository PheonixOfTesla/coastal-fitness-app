<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coastal Fitness & Correction - Complete Health Platform</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Lato:wght@100;400&display=swap');
        
        :root {
            --coastal-blue: #244398;
            --coastal-gray: #818386;
            --coastal-light: #EBFBFF;
            --coastal-cyan: #60E0E0;
            --fb-blue: #0084ff;
            --fb-gray: #f0f2f5;
        }
        
        * { 
            font-family: 'Inter', sans-serif; 
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #f8fafc;
            color: #1f2937;
            overflow-x: hidden;
        }
        
        .app-container {
            background-color: #f8fafc;
            min-height: 100vh;
        }
        
        .coastal-gradient {
            background: linear-gradient(135deg, #4F63C9 0%, #7BA7D9 100%);
            min-height: 100vh;
        }
        
        .login-card {
            background: white;
            border-radius: 24px;
            padding: 3rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 440px;
            margin: 0 auto;
        }
        
        .coastal-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .coastal-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .coastal-button {
            background: var(--coastal-blue);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .coastal-button.login {
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1.1rem;
            width: 100%;
        }
        
        .coastal-button:hover {
            background: #1a2f6f;
            transform: translateY(-1px);
        }
        
        .coastal-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        .coastal-button-secondary {
            background: var(--coastal-cyan);
            color: var(--coastal-blue);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .coastal-button-secondary:hover {
            background: #4dd6d6;
            transform: translateY(-1px);
        }
        
        .coastal-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .coastal-input:focus {
            outline: none;
            border-color: var(--coastal-blue);
            box-shadow: 0 0 0 3px rgba(36, 67, 152, 0.1);
        }
        
        .coastal-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }
        
        .coastal-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-client { background: #dbeafe; color: #1e40af; }
        .badge-specialist { background: #d1fae5; color: #059669; }
        .badge-admin { background: #fef3c7; color: #d97706; }
        .badge-owner { background: #e9d5ff; color: #7c3aed; }
        .badge-engineer { background: #fee2e2; color: #dc2626; }
        
        .coastal-tab {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            background: transparent;
        }
        
        .coastal-tab:hover {
            background: rgba(96, 224, 224, 0.1);
        }
        
        .coastal-tab.active {
            background: var(--coastal-blue);
            color: white;
        }
        
        .text-xxs {
            font-size: 0.65rem;
            line-height: 1rem;
        }
        
        .coastal-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 1.5rem;
        }
        
        .coastal-logo.small {
            justify-content: flex-start;
            margin-bottom: 0;
            gap: 0.75rem;
        }
        
        .coastal-logo.small .logo-icon {
            width: 35px;
            height: 35px;
        }
        
        .coastal-logo.small .logo-wave {
            border-width: 3px;
        }
        
        .coastal-logo.small .logo-wave::before {
            inset: 5px;
            border-width: 2px;
        }
        
        .logo-icon {
            width: 60px;
            height: 60px;
            position: relative;
        }
        
        .logo-wave {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid var(--coastal-blue);
            border-top-color: var(--coastal-cyan);
            animation: wave-rotate 3s linear infinite;
        }
        
        .logo-wave::before {
            content: '';
            position: absolute;
            inset: 8px;
            border-radius: 50%;
            border: 4px solid var(--coastal-cyan);
            border-bottom-color: transparent;
            border-left-color: transparent;
        }
        
        @keyframes wave-rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .logo-text-primary {
            font-family: 'Lato', sans-serif;
            font-weight: 100;
        }
        
        .logo-text-secondary {
            font-family: 'Lato', sans-serif;
            font-weight: 400;
        }
        
        .login-toggle {
            display: flex;
            margin-bottom: 2rem;
            border-radius: 12px;
            overflow: hidden;
            background: #f3f4f6;
            padding: 4px;
        }
        
        .login-toggle button {
            flex: 1;
            padding: 0.875rem;
            border: none;
            background: transparent;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border-radius: 8px;
        }
        
        .login-toggle button.active {
            background: var(--coastal-blue);
            color: white;
        }
        
        .login-toggle button:not(.active) {
            color: #6b7280;
        }
        
        .brand-tagline {
            color: #6b7280;
            margin-bottom: 2rem;
            font-size: 1.1rem;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }
        
        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--coastal-blue) 0%, var(--coastal-cyan) 100%);
            transition: width 0.5s ease;
            border-radius: 9999px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--coastal-blue) 0%, var(--coastal-cyan) 100%);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e5e7eb;
            border-top: 2px solid var(--coastal-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid #fca5a5;
            margin: 0.5rem 0;
            font-size: 0.875rem;
        }
        
        .success-message {
            background: #d1fae5;
            color: #059669;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid #a7f3d0;
            margin: 0.5rem 0;
            font-size: 0.875rem;
        }
        
        /* Facebook-style Chat Styles */
        .chat-container {
            display: flex;
            height: 600px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .chat-sidebar {
            width: 320px;
            background: white;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            background: white;
        }
        
        .chat-search {
            padding: 0.5rem 1rem;
            background: var(--fb-gray);
            border: none;
            border-radius: 20px;
            width: 100%;
            font-size: 0.875rem;
        }
        
        .chat-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .chat-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }
        
        .chat-item:hover {
            background: var(--fb-gray);
        }
        
        .chat-item.active {
            background: #e3f2fd;
        }
        
        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--coastal-blue);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 0.75rem;
            position: relative;
        }
        
        .online-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: #44b700;
            border-radius: 50%;
            border: 2px solid white;
        }
        
        .chat-item-info {
            flex: 1;
            min-width: 0;
        }
        
        .chat-item-name {
            font-weight: 500;
            margin-bottom: 0.125rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .chat-item-message {
            font-size: 0.875rem;
            color: #65676b;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .chat-item-time {
            font-size: 0.75rem;
            color: #65676b;
            position: absolute;
            top: 0.75rem;
            right: 1rem;
        }
        
        .unread-count {
            position: absolute;
            bottom: 0.75rem;
            right: 1rem;
            background: var(--fb-blue);
            color: white;
            font-size: 0.75rem;
            padding: 0.125rem 0.375rem;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }
        
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .chat-main-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: var(--fb-gray);
        }
        
        .message-group {
            margin-bottom: 1rem;
        }
        
        .message-bubble {
            max-width: 70%;
            padding: 0.5rem 1rem;
            border-radius: 18px;
            margin-bottom: 0.125rem;
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        
        .message-bubble.zoom-meeting {
            background: linear-gradient(45deg, #2D8CFF, #0B5CFF) !important;
            color: white !important;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(11, 92, 255, 0.3);
        }
        
        .message-sent {
            background: var(--fb-blue);
            color: white;
            margin-left: auto;
        }
        
        .message-received {
            background: #e4e6eb;
            color: #050505;
        }
        
        .message-time {
            font-size: 0.75rem;
            color: #65676b;
            margin: 0.25rem 0.5rem;
        }
        
        .message-sent + .message-time {
            text-align: right;
        }
        
        .chat-input-container {
            padding: 1rem;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .chat-input {
            flex: 1;
            padding: 0.5rem 1rem;
            background: var(--fb-gray);
            border: none;
            border-radius: 20px;
            font-size: 0.875rem;
            outline: none;
            resize: none;
            min-height: 36px;
            max-height: 100px;
            line-height: 1.4;
        }
        
        .chat-send-btn {
            background: var(--fb-blue);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .chat-send-btn:hover {
            transform: scale(1.1);
        }
        
        .chat-send-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem 1rem;
            background: #e4e6eb;
            border-radius: 18px;
            width: fit-content;
            margin-bottom: 0.5rem;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #65676b;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 80%, 100% {
                opacity: 0;
                transform: scale(0.8);
            }
            40% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .pain-scale-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-weight: 600;
        }
        
        .pain-scale-btn:hover {
            transform: scale(1.1);
        }
        
        .pain-scale-btn.selected {
            border-color: var(--coastal-blue);
            transform: scale(1.15);
        }
        
        .pain-0 { background: #d1fae5; color: #059669; }
        .pain-1 { background: #fef3c7; color: #d97706; }
        .pain-2 { background: #fed7aa; color: #ea580c; }
        .pain-3 { background: #fecaca; color: #dc2626; }
        .pain-4 { background: #f87171; color: white; }
        .pain-5 { background: #dc2626; color: white; }
        
        .mood-btn {
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0.5rem;
            border-radius: 8px;
            border: 2px solid transparent;
        }
        
        .mood-btn:hover {
            transform: scale(1.2);
        }
        
        .mood-btn.selected {
            border-color: var(--coastal-blue);
            background: var(--coastal-light);
        }
        
        .exercise-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .zoom-btn {
            background: linear-gradient(45deg, #2D8CFF, #0B5CFF);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .zoom-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(11, 92, 255, 0.4);
        }
        
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 1rem;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation: modalFadeIn 0.3s ease-out;
        }
        
        .modal-content.max-w-4xl {
            max-width: 56rem;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .assignment-form {
            background: linear-gradient(135deg, rgba(36, 67, 152, 0.05) 0%, rgba(96, 224, 224, 0.05) 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .assignment-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--coastal-blue);
        }
        
        .specialist-note {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        .mood-summary-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #bfdbfe;
        }
        
        .pain-summary-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #fbbf24;
        }
        
        .workout-image-upload {
            position: relative;
            width: 150px;
            height: 150px;
            border: 2px dashed #e5e7eb;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 1rem 0;
            background: #f9fafb;
        }
        
        .workout-image-upload:hover {
            border-color: var(--coastal-blue);
            background: #f0f9ff;
        }
        
        .workout-image-upload input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .workout-image-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }
        
        .measurement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .measurement-input-group {
            display: flex;
            flex-direction: column;
        }
        
        .measurement-input-group label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
        }
        
        .measurement-input-group input {
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 0.875rem;
        }
        
        .measurement-category {
            background: #f9fafb;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .measurement-category h4 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--coastal-blue);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .bmr-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 1rem;
            font-size: 0.875rem;
            font-weight: 400;
        }
        
        .bmr-toggle input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Demo accounts with multiple roles support
        const demoAccounts = {
            'john.client@example.com': { 
                password: 'password123', 
                roles: ['client'], 
                name: 'John Anderson',
                id: 'client_001',
                specialistIds: ['specialist_001', 'specialist_002']
            },
            'sarah.specialist@coastal.com': { 
                password: 'specialist123', 
                roles: ['specialist'], 
                name: 'Dr. Sarah Mitchell',
                id: 'specialist_001',
                clientIds: ['client_001']
            },
            'mike.specialist@coastal.com': { 
                password: 'specialist123', 
                roles: ['specialist'], 
                name: 'Dr. Mike Johnson',
                id: 'specialist_002',
                clientIds: ['client_001']
            },
            'admin@coastal.com': { 
                password: 'admin123', 
                roles: ['admin', 'specialist'], 
                name: 'Admin User',
                id: 'admin_001',
                clientIds: []
            },
            'owner@coastal.com': { 
                password: 'owner123', 
                roles: ['owner', 'admin', 'specialist'], 
                name: 'Tanya Beck',
                id: 'owner_001',
                clientIds: []
            },
            'engineer@coastal.com': { 
                password: 'engineer123', 
                roles: ['engineer', 'admin'], 
                name: 'Josh Lerner',
                id: 'engineer_001'
            }
        };

        // Initialize demo data
        const initDemoData = () => {
            return {
                measurements: [
                    { 
                        id: 1, 
                        date: '2024-01-15', 
                        weight: 165, 
                        bodyFat: 18.2, 
                        bmr: 1650, 
                        bloodPressure: '120/80', 
                        clientId: 'client_001',
                        circumference: {
                            neck: 15.5,
                            shoulders: 45,
                            chest: 42,
                            upperArm: 14,
                            lowerArm: 11,
                            waist: 34,
                            hips: 40,
                            upperThigh: 24,
                            calf: 15
                        },
                        caliper: {
                            chest: 10,
                            abdominal: 15,
                            thigh: 12,
                            bicep: 8,
                            tricep: 10,
                            subscapular: 12,
                            suprailiac: 14,
                            lowerBack: 11,
                            calf: 9
                        }
                    },
                    { 
                        id: 2, 
                        date: '2024-02-14', 
                        weight: 163, 
                        bodyFat: 17.8, 
                        bmr: 1635, 
                        bloodPressure: '118/78', 
                        clientId: 'client_001',
                        circumference: {
                            neck: 15.3,
                            shoulders: 44.5,
                            chest: 41.5,
                            upperArm: 13.8,
                            lowerArm: 10.9,
                            waist: 33,
                            hips: 39.5,
                            upperThigh: 23.5,
                            calf: 14.8
                        },
                        caliper: {
                            chest: 9,
                            abdominal: 14,
                            thigh: 11,
                            bicep: 7,
                            tricep: 9,
                            subscapular: 11,
                            suprailiac: 13,
                            lowerBack: 10,
                            calf: 8
                        }
                    }
                ],
                workouts: [
                    {
                        id: 1,
                        name: 'Upper Body Strength',
                        clientId: 'client_001',
                        assignedBy: 'specialist_001',
                        exerciseImage: null,
                        youtubeLink: 'https://www.youtube.com/watch?v=example',
                        exercises: [
                            { 
                                id: 1, 
                                name: 'Push-ups', 
                                sets: 3, 
                                reps: 15, 
                                weight: 0,
                                actualSets: 3,
                                actualReps: 15,
                                actualWeight: 0,
                                painLevel: 1,
                                specialistNote: 'Focus on proper form'
                            },
                            { 
                                id: 2, 
                                name: 'Pull-ups', 
                                sets: 3, 
                                reps: 8, 
                                weight: 0,
                                actualSets: 3,
                                actualReps: 6,
                                actualWeight: 0,
                                painLevel: 2,
                                specialistNote: 'Use assistance band if needed'
                            }
                        ],
                        completed: true,
                        moodFeedback: 4,
                        notes: 'Felt good overall, slight shoulder discomfort',
                        completedDate: '2024-02-15'
                    }
                ],
                nutrition: {
                    clientId: 'client_001',
                    assignedBy: 'specialist_001',
                    protein: { target: 165, current: 155 },
                    carbs: { target: 200, current: 180 },
                    fat: { target: 60, current: 58 },
                    calories: { target: 2000, current: 1890 },
                    mealPlan: {
                        breakfast: 'Oatmeal with berries and protein powder',
                        lunch: 'Grilled chicken salad with quinoa',
                        dinner: 'Salmon with vegetables and sweet potato'
                    }
                },
                goals: [
                    { id: 1, name: 'Weight Loss Goal', target: 155, current: 163, deadline: '2024-06-30', clientId: 'client_001', assignedBy: 'specialist_001' },
                    { id: 2, name: 'Body Fat Reduction', target: 15, current: 17.8, deadline: '2024-08-30', clientId: 'client_001', assignedBy: 'specialist_001' }
                ],
                tests: [
                    { id: 1, name: 'Body Composition Analysis', date: '2024-01-15', results: 'Body fat: 18.2%, Muscle mass: 142lbs, Water: 58%', clientId: 'client_001', performedBy: 'specialist_001' },
                    { id: 2, name: 'VO2 Max Test', date: '2024-02-01', results: 'VO2 Max: 45 ml/kg/min - Above average for age group', clientId: 'client_001', performedBy: 'specialist_002' }
                ]
            };
        };

        // Coastal Logo Component
        const CoastalLogo = ({ size = 'large' }) => {
            const [logoUrl, setLogoUrl] = useState(() => {
                try {
                    return localStorage.getItem('coastalLogo') || null;
                } catch (error) {
                    console.error('Error loading logo:', error);
                    return null;
                }
            });
            const logoSize = size === 'large' ? 60 : 35;
            const fontSize = size === 'large' ? 'text-2xl' : 'text-sm';
            
            const handleLogoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        try {
                            setLogoUrl(reader.result);
                            localStorage.setItem('coastalLogo', reader.result);
                        } catch (error) {
                            console.error('Error saving logo:', error);
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            return (
                <div className={`coastal-logo ${size === 'small' ? 'small' : ''}`}>
                    <div className="logo-icon" style={{ width: logoSize, height: logoSize, position: 'relative' }}>
                        {logoUrl ? (
                            <img 
                                src={logoUrl} 
                                alt="Coastal Logo" 
                                style={{ 
                                    width: '100%', 
                                    height: '100%', 
                                    objectFit: 'contain',
                                    borderRadius: '8px'
                                }}
                            />
                        ) : (
                            <div className="logo-wave"></div>
                        )}
                        {size === 'large' && (
                            <input
                                type="file"
                                accept="image/*"
                                onChange={handleLogoUpload}
                                style={{
                                    position: 'absolute',
                                    top: 0,
                                    left: 0,
                                    width: '100%',
                                    height: '100%',
                                    opacity: 0,
                                    cursor: 'pointer'
                                }}
                                title="Click to upload logo"
                            />
                        )}
                    </div>
                    <div>
                        <div className={`font-bold ${fontSize} logo-text-primary`} style={{ color: 'var(--coastal-blue)' }}>
                            COASTAL
                        </div>
                        <div className={`${size === 'large' ? 'text-xs' : 'text-xxs'} tracking-wider logo-text-secondary`} style={{ color: 'var(--coastal-gray)' }}>
                            FITNESS AND CORRECTION
                        </div>
                    </div>
                </div>
            );
        };

        // Error Boundary Component
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }

            componentDidCatch(error, errorInfo) {
                console.error('Error caught by boundary:', error, errorInfo);
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="min-h-screen flex items-center justify-center bg-gray-50">
                            <div className="text-center">
                                <h2 className="text-2xl font-bold text-red-600 mb-4">Something went wrong</h2>
                                <p className="text-gray-600 mb-4">Please refresh the page or try again.</p>
                                <button 
                                    onClick={() => window.location.reload()}
                                    className="coastal-button"
                                >
                                    Refresh Page
                                </button>
                            </div>
                        </div>
                    );
                }

                return this.props.children;
            }
        }

        // Main App Component
        const App = () => {
            const [currentUser, setCurrentUser] = useState(() => {
                try {
                    const saved = sessionStorage.getItem('coastalUser');
                    return saved ? JSON.parse(saved) : null;
                } catch (error) {
                    console.error('Error loading user:', error);
                    return null;
                }
            });

            const [activeTab, setActiveTab] = useState('dashboard');
            const [clientData, setClientData] = useState(() => {
                try {
                    const saved = localStorage.getItem('coastalClientData');
                    return saved ? JSON.parse(saved) : initDemoData();
                } catch (error) {
                    console.error('Error loading client data:', error);
                    return initDemoData();
                }
            });

            const [selectedClient, setSelectedClient] = useState(null);
            const [messages, setMessages] = useState(() => {
                try {
                    const saved = localStorage.getItem('coastalMessages');
                    return saved ? JSON.parse(saved) : {
                        // Initialize with some demo messages
                        'client_001-specialist_001': [
                            {
                                id: 1,
                                text: 'Hi John! How are you feeling after yesterday\'s workout?',
                                sender: 'specialist_001',
                                senderName: 'Dr. Sarah Mitchell',
                                timestamp: new Date(Date.now() - 86400000).toISOString(),
                                read: true
                            },
                            {
                                id: 2,
                                text: 'Hi Dr. Mitchell! I\'m feeling great, just a bit sore in my shoulders.',
                                sender: 'client_001',
                                senderName: 'John Anderson',
                                timestamp: new Date(Date.now() - 85000000).toISOString(),
                                read: true
                            }
                        ]
                    };
                } catch (error) {
                    console.error('Error loading messages:', error);
                    return {};
                }
            });

            const [allUsers, setAllUsers] = useState(() => {
                try {
                    const saved = localStorage.getItem('coastalAllUsers');
                    if (saved) {
                        return JSON.parse(saved);
                    }
                    return Object.entries(demoAccounts).map(([email, data]) => ({ 
                        ...data, 
                        email,
                        online: Math.random() > 0.5
                    }));
                } catch (error) {
                    console.error('Error loading users:', error);
                    return Object.entries(demoAccounts).map(([email, data]) => ({ 
                        ...data, 
                        email,
                        online: Math.random() > 0.5
                    }));
                }
            });

            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            // Save data to storage whenever it changes
            useEffect(() => {
                try {
                    if (currentUser) {
                        sessionStorage.setItem('coastalUser', JSON.stringify(currentUser));
                    } else {
                        sessionStorage.removeItem('coastalUser');
                    }
                } catch (error) {
                    console.error('Error saving user:', error);
                }
            }, [currentUser]);

            useEffect(() => {
                try {
                    localStorage.setItem('coastalClientData', JSON.stringify(clientData));
                } catch (error) {
                    console.error('Error saving client data:', error);
                }
            }, [clientData]);

            useEffect(() => {
                try {
                    localStorage.setItem('coastalMessages', JSON.stringify(messages));
                } catch (error) {
                    console.error('Error saving messages:', error);
                }
            }, [messages]);

            useEffect(() => {
                try {
                    localStorage.setItem('coastalAllUsers', JSON.stringify(allUsers));
                } catch (error) {
                    console.error('Error saving users:', error);
                }
            }, [allUsers]);

            // Helper functions
            const hasRole = (role) => currentUser?.roles?.includes(role);
            const hasAnyRole = (...roles) => roles.some(role => hasRole(role));

            // Get clients for current specialist/admin/owner
            const getMyClients = () => {
                if (hasRole('owner') || hasRole('admin')) {
                    return allUsers.filter(u => u.roles.includes('client'));
                } else if (hasRole('specialist')) {
                    return allUsers.filter(u => 
                        u.roles.includes('client') && 
                        currentUser.clientIds?.includes(u.id)
                    );
                }
                return [];
            };

            // Clear error after 5 seconds
            useEffect(() => {
                if (error) {
                    const timer = setTimeout(() => setError(null), 5000);
                    return () => clearTimeout(timer);
                }
            }, [error]);

            // Login Component
            const LoginForm = () => {
                const [email, setEmail] = useState('');
                const [password, setPassword] = useState('');
                const [loginError, setLoginError] = useState('');
                const [isSignup, setIsSignup] = useState(false);
                const [name, setName] = useState('');
                const [isLoading, setIsLoading] = useState(false);
                const [showResetPassword, setShowResetPassword] = useState(false);
                const [resetEmail, setResetEmail] = useState('');
                const [resetMessage, setResetMessage] = useState('');

                const handleAuth = async (e) => {
                    e.preventDefault();
                    setIsLoading(true);
                    setLoginError('');
                    
                    try {
                        if (isSignup) {
                            await new Promise(resolve => setTimeout(resolve, 1000));
                            
                            // Check if email already exists
                            const emailExists = allUsers.some(u => u.email === email) || Object.keys(demoAccounts).includes(email);
                            if (emailExists) {
                                setLoginError('Email already exists. Please use a different email or login.');
                                return;
                            }
                            
                            const newUser = {
                                id: `client_${Date.now()}`,
                                email,
                                password,
                                name: name || email.split('@')[0],
                                roles: ['client'],
                                specialistIds: [],
                                clientIds: [],
                                online: true
                            };
                            
                            // Add to allUsers
                            setAllUsers(prev => [...prev, newUser]);
                            
                            // Set as current user
                            setCurrentUser(newUser);
                        } else {
                            await new Promise(resolve => setTimeout(resolve, 800));
                            
                            // Check demo accounts first
                            const demoUser = demoAccounts[email];
                            if (demoUser && demoUser.password === password) {
                                setCurrentUser({ ...demoUser, email });
                            } else {
                                // Check dynamically created users
                                const dynamicUser = allUsers.find(u => u.email === email && u.password === password);
                                if (dynamicUser) {
                                    setCurrentUser(dynamicUser);
                                } else {
                                    setLoginError('Invalid credentials. Please try again.');
                                }
                            }
                        }
                    } catch (error) {
                        setLoginError('An error occurred. Please try again.');
                        console.error('Auth error:', error);
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handlePasswordReset = async (e) => {
                    e.preventDefault();
                    setIsLoading(true);
                    setResetMessage('');
                    
                    try {
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        // Check if email exists in demo accounts
                        const userExists = Object.keys(demoAccounts).includes(resetEmail) || 
                                         allUsers.some(u => u.email === resetEmail);
                        
                        if (userExists) {
                            setResetMessage('Password reset link sent to your email! Check your inbox.');
                            setTimeout(() => {
                                setShowResetPassword(false);
                                setResetEmail('');
                                setResetMessage('');
                            }, 3000);
                        } else {
                            setResetMessage('Email not found. Please check and try again.');
                        }
                    } catch (error) {
                        setResetMessage('Error sending reset link. Please try again.');
                    } finally {
                        setIsLoading(false);
                    }
                };

                if (showResetPassword) {
                    return (
                        <div className="coastal-gradient flex items-center justify-center min-h-screen p-4">
                            <div className="login-card">
                                <CoastalLogo size="large" />
                                <h2 className="text-2xl font-bold text-center mb-2">Reset Password</h2>
                                <p className="text-gray-600 text-center mb-6">
                                    Enter your email address and we'll send you a link to reset your password.
                                </p>
                                
                                <form onSubmit={handlePasswordReset}>
                                    <div className="form-group">
                                        <label className="form-label">Email Address</label>
                                        <input
                                            type="email"
                                            value={resetEmail}
                                            onChange={(e) => setResetEmail(e.target.value)}
                                            className="coastal-input"
                                            placeholder="Enter your email"
                                            required
                                        />
                                    </div>
                                    
                                    {resetMessage && (
                                        <div className={resetMessage.includes('sent') ? 'success-message' : 'error-message'}>
                                            {resetMessage}
                                        </div>
                                    )}
                                    
                                    <button 
                                        type="submit" 
                                        className="coastal-button login flex items-center justify-center gap-2"
                                        disabled={isLoading}
                                    >
                                        {isLoading && <div className="loading-spinner"></div>}
                                        Send Reset Link
                                    </button>
                                </form>
                                
                                <div className="text-center mt-4">
                                    <button
                                        onClick={() => {
                                            setShowResetPassword(false);
                                            setResetEmail('');
                                            setResetMessage('');
                                        }}
                                        className="text-blue-600 hover:text-blue-700"
                                    >
                                        ← Back to Login
                                    </button>
                                </div>
                            </div>
                        </div>
                    );
                }

                return (
                    <div className="coastal-gradient flex items-center justify-center min-h-screen p-4">
                        <div className="login-card">
                            <CoastalLogo size="large" />
                            <p className="brand-tagline">Revolutionary Health Platform</p>
                            
                            <div className="login-toggle">
                                <button
                                    onClick={() => setIsSignup(false)}
                                    className={!isSignup ? 'active' : ''}
                                >
                                    Login
                                </button>
                                <button
                                    onClick={() => setIsSignup(true)}
                                    className={isSignup ? 'active' : ''}
                                >
                                    Sign Up
                                </button>
                            </div>
                            
                            <form onSubmit={handleAuth}>
                                {isSignup && (
                                    <div className="form-group">
                                        <label className="form-label">Full Name</label>
                                        <input
                                            type="text"
                                            value={name}
                                            onChange={(e) => setName(e.target.value)}
                                            className="coastal-input"
                                            placeholder="Enter your full name"
                                            required
                                        />
                                    </div>
                                )}
                                
                                <div className="form-group">
                                    <label className="form-label">Email Address</label>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="coastal-input"
                                        placeholder="Enter your email"
                                        required
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Password</label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="coastal-input"
                                        placeholder="Enter your password"
                                        required
                                    />
                                </div>
                                
                                {loginError && (
                                    <div className="error-message">{loginError}</div>
                                )}
                                
                                <button 
                                    type="submit" 
                                    className="coastal-button login flex items-center justify-center gap-2"
                                    disabled={isLoading}
                                >
                                    {isLoading && <div className="loading-spinner"></div>}
                                    {isSignup ? 'Start Your Journey' : 'Sign In'}
                                </button>
                            </form>
                            
                            {!isSignup && (
                                <div className="forgot-password" style={{ textAlign: 'center', marginTop: '1.5rem' }}>
                                    <button 
                                        onClick={() => setShowResetPassword(true)}
                                        style={{ 
                                            color: 'var(--coastal-blue)', 
                                            textDecoration: 'none', 
                                            fontWeight: 500,
                                            background: 'none',
                                            border: 'none',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        Forgot Password?
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // Navigation Component
            const Navigation = () => {
                const tabs = [
                    { id: 'dashboard', label: 'Dashboard', icon: '📊' },
                    { id: 'measurements', label: 'Measurements', icon: '📏' },
                    { id: 'nutrition', label: 'Nutrition', icon: '🥗' },
                    { id: 'workouts', label: 'Workouts', icon: '💪' },
                    { id: 'goals', label: 'Goals', icon: '🎯' },
                    { id: 'chat', label: 'Chat', icon: '💬' },
                    { id: 'reports', label: 'Reports', icon: '📈' }
                ];

                if (hasAnyRole('admin', 'owner')) {
                    tabs.push({ id: 'users', label: 'Users', icon: '👥' });
                }

                if (hasAnyRole('specialist', 'admin', 'owner')) {
                    tabs.push({ id: 'tests', label: 'Tests', icon: '🧪' });
                }

                if (hasAnyRole('engineer', 'owner')) {
                    tabs.push({ id: 'engineer', label: 'Engineer', icon: '🔧' });
                }

                const exportMyData = () => {
                    try {
                        let exportContent = "COASTAL FITNESS - MY DATA EXPORT\n";
                        exportContent += "================================\n\n";
                        
                        exportContent += "USER INFORMATION\n";
                        exportContent += "----------------\n";
                        exportContent += `Name: ${currentUser.name}\n`;
                        exportContent += `Email: ${currentUser.email}\n`;
                        exportContent += `Roles: ${currentUser.roles.join(', ')}\n`;
                        exportContent += `Export Date: ${new Date().toISOString()}\n\n`;
                        
                        const myMeasurements = clientData.measurements.filter(m => m.clientId === currentUser.id);
                        exportContent += "MEASUREMENTS\n";
                        exportContent += "------------\n";
                        myMeasurements.forEach(m => {
                            exportContent += `Date: ${m.date} | Weight: ${m.weight}lbs | Body Fat: ${m.bodyFat}% | BMR: ${m.bmr} | BP: ${m.bloodPressure}\n`;
                        });
                        exportContent += "\n";
                        
                        const myWorkouts = clientData.workouts.filter(w => w.clientId === currentUser.id);
                        exportContent += "WORKOUTS\n";
                        exportContent += "--------\n";
                        myWorkouts.forEach(w => {
                            exportContent += `${w.name} - ${w.completed ? 'Completed' : 'Pending'}`;
                            if (w.moodFeedback) exportContent += ` - Mood: ${w.moodFeedback}/5`;
                            if (w.completedDate) exportContent += ` - Date: ${w.completedDate}`;
                            exportContent += "\n";
                        });
                        exportContent += "\n";
                        
                        const myGoals = clientData.goals.filter(g => g.clientId === currentUser.id);
                        exportContent += "GOALS\n";
                        exportContent += "-----\n";
                        myGoals.forEach(g => {
                            const progress = Math.round((g.current / g.target) * 100);
                            exportContent += `${g.name} - Progress: ${g.current}/${g.target} (${progress}%) - Deadline: ${g.deadline}\n`;
                        });
                        exportContent += "\n";
                        
                        const myTests = clientData.tests.filter(t => t.clientId === currentUser.id);
                        exportContent += "TESTS\n";
                        exportContent += "-----\n";
                        myTests.forEach(t => {
                            exportContent += `${t.name} - Date: ${t.date}\n`;
                            exportContent += `Results: ${t.results}\n\n`;
                        });
                        
                        const blob = new Blob([exportContent], { type: 'text/plain;charset=utf-8;' });
                        const link = document.createElement('a');
                        const url = URL.createObjectURL(blob);
                        link.setAttribute('href', url);
                        link.setAttribute('download', `my-coastal-fitness-data-${new Date().toISOString().split('T')[0]}.txt`);
                        link.style.visibility = 'hidden';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                    } catch (error) {
                        console.error('Error exporting data:', error);
                        setError('Error exporting data. Please try again.');
                    }
                };

                return (
                    <nav className="coastal-card mb-6 px-6 py-4">
                        <div className="flex justify-between items-center mb-4">
                            <CoastalLogo size="small" />
                            <div className="flex items-center gap-4">
                                <div className="flex gap-2">
                                    {currentUser.roles.map(role => (
                                        <span key={role} className={`coastal-badge badge-${role}`}>
                                            {role}
                                        </span>
                                    ))}
                                </div>
                                <span className="text-gray-600">{currentUser.name}</span>
                                <button 
                                    onClick={exportMyData}
                                    className="coastal-button-secondary"
                                >
                                    📊 Export My Data
                                </button>
                                <button 
                                    onClick={() => setCurrentUser(null)}
                                    className="text-gray-500 hover:text-gray-700"
                                >
                                    Logout
                                </button>
                            </div>
                        </div>
                        
                        <div className="flex gap-2 overflow-x-auto">
                            {tabs.map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`coastal-tab ${activeTab === tab.id ? 'active' : ''}`}
                                >
                                    <span className="mr-2">{tab.icon}</span>
                                    {tab.label}
                                </button>
                            ))}
                        </div>
                    </nav>
                );
            };

            // Dashboard Component
            const Dashboard = () => {
                const currentClientId = hasRole('client') ? currentUser.id : selectedClient?.id;
                const displayName = hasRole('client') ? currentUser.name : selectedClient?.name || 'Select a client';
                
                const latestMeasurement = clientData.measurements
                    .filter(m => hasRole('client') ? m.clientId === currentUser.id : (selectedClient ? m.clientId === selectedClient.id : false))
                    .slice(-1)[0] || {};
                
                const chartRef = useRef(null);
                const chartInstance = useRef(null);
                const [selectedMetrics, setSelectedMetrics] = useState(['weight']);
                const [showCircumferenceChart, setShowCircumferenceChart] = useState(false);
                const circumferenceChartRef = useRef(null);
                const circumferenceChartInstance = useRef(null);

                const myWorkouts = clientData.workouts.filter(w => 
                    hasRole('client') ? w.clientId === currentUser.id : (selectedClient ? w.clientId === selectedClient.id : false)
                );

                const myGoals = clientData.goals.filter(g => 
                    hasRole('client') ? g.clientId === currentUser.id : (selectedClient ? g.clientId === selectedClient.id : false)
                );

                const getAveragePainLevel = () => {
                    const completedWorkouts = myWorkouts.filter(w => w.completed);
                    if (completedWorkouts.length === 0) return 0;
                    
                    let totalPain = 0;
                    let exerciseCount = 0;
                    
                    completedWorkouts.forEach(workout => {
                        workout.exercises.forEach(exercise => {
                            if (exercise.painLevel !== undefined) {
                                totalPain += exercise.painLevel;
                                exerciseCount++;
                            }
                        });
                    });
                    
                    return exerciseCount > 0 ? (totalPain / exerciseCount).toFixed(1) : 0;
                };

                const getRecentMoodFeedback = () => {
                    const completedWorkouts = myWorkouts
                        .filter(w => w.completed && w.moodFeedback)
                        .sort((a, b) => new Date(b.completedDate || 0) - new Date(a.completedDate || 0))
                        .slice(0, 5);
                    
                    return completedWorkouts;
                };

                useEffect(() => {
                    if (chartRef.current && (selectedClient || hasRole('client'))) {
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }

                        const relevantMeasurements = clientData.measurements.filter(m => 
                            hasRole('client') ? m.clientId === currentUser.id : m.clientId === selectedClient?.id
                        );

                        const datasets = [];
                        const colors = {
                            weight: '#244398',
                            bodyFat: '#f59e0b',
                            bmr: '#10b981'
                        };

                        if (selectedMetrics.includes('weight')) {
                            datasets.push({
                                label: 'Weight (lbs)',
                                data: relevantMeasurements.map(m => m.weight),
                                borderColor: colors.weight,
                                backgroundColor: `${colors.weight}20`,
                                tension: 0.4,
                                yAxisID: 'y-weight'
                            });
                        }

                        if (selectedMetrics.includes('bodyFat')) {
                            datasets.push({
                                label: 'Body Fat (%)',
                                data: relevantMeasurements.map(m => m.bodyFat),
                                borderColor: colors.bodyFat,
                                backgroundColor: `${colors.bodyFat}20`,
                                tension: 0.4,
                                yAxisID: 'y-bodyfat'
                            });
                        }

                        if (selectedMetrics.includes('bmr')) {
                            datasets.push({
                                label: 'BMR (cal)',
                                data: relevantMeasurements.map(m => m.bmr),
                                borderColor: colors.bmr,
                                backgroundColor: `${colors.bmr}20`,
                                tension: 0.4,
                                yAxisID: 'y-bmr'
                            });
                        }

                        const scales = {};
                        if (selectedMetrics.includes('weight')) {
                            scales['y-weight'] = {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Weight (lbs)'
                                }
                            };
                        }
                        if (selectedMetrics.includes('bodyFat')) {
                            scales['y-bodyfat'] = {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false
                                },
                                title: {
                                    display: true,
                                    text: 'Body Fat (%)'
                                }
                            };
                        }
                        if (selectedMetrics.includes('bmr')) {
                            scales['y-bmr'] = {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false
                                },
                                title: {
                                    display: true,
                                    text: 'BMR (cal/day)'
                                }
                            };
                        }

                        const ctx = chartRef.current.getContext('2d');
                        chartInstance.current = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: relevantMeasurements.map(m => m.date),
                                datasets: datasets
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: scales,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Health Metrics Over Time'
                                    }
                                }
                            }
                        });
                    }

                    return () => {
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }
                    };
                }, [clientData.measurements, selectedMetrics, currentUser.id, selectedClient]);

                useEffect(() => {
                    if (circumferenceChartRef.current && showCircumferenceChart && (selectedClient || hasRole('client'))) {
                        if (circumferenceChartInstance.current) {
                            circumferenceChartInstance.current.destroy();
                        }

                        const relevantMeasurements = clientData.measurements.filter(m => 
                            hasRole('client') ? m.clientId === currentUser.id : m.clientId === selectedClient?.id
                        ).filter(m => m.circumference);

                        if (relevantMeasurements.length > 0) {
                            const circumferenceKeys = Object.keys(relevantMeasurements[0].circumference);
                            const colors = ['#244398', '#60E0E0', '#f59e0b', '#10b981', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'];
                            
                            const datasets = circumferenceKeys.map((key, index) => ({
                                label: key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1'),
                                data: relevantMeasurements.map(m => m.circumference?.[key] || 0),
                                borderColor: colors[index % colors.length],
                                backgroundColor: `${colors[index % colors.length]}20`,
                                tension: 0.4
                            }));

                            const ctx = circumferenceChartRef.current.getContext('2d');
                            circumferenceChartInstance.current = new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: relevantMeasurements.map(m => m.date),
                                    datasets: datasets
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        title: {
                                            display: true,
                                            text: 'Body Circumference Measurements (inches)'
                                        }
                                    }
                                }
                            });
                        }
                    }

                    return () => {
                        if (circumferenceChartInstance.current) {
                            circumferenceChartInstance.current.destroy();
                        }
                    };
                }, [showCircumferenceChart, clientData.measurements, currentUser.id, selectedClient]);

                const toggleMetric = (metric) => {
                    setSelectedMetrics(prev => 
                        prev.includes(metric) 
                            ? prev.filter(m => m !== metric)
                            : [...prev, metric]
                    );
                };

                const recentMoods = getRecentMoodFeedback();
                const avgPainLevel = getAveragePainLevel();

                return (
                    <div className="space-y-6">
                        <div className="coastal-card p-6">
                            <h2 className="text-2xl font-bold mb-2">
                                {hasRole('client') ? `Welcome back, ${currentUser.name}!` : `Dashboard - ${displayName}`}
                            </h2>
                            <p className="text-gray-600">
                                {hasRole('client') ? 'Your health journey continues today' : 'Client health overview'}
                            </p>
                            
                            {hasAnyRole('specialist', 'admin', 'owner') && (
                                <div className="mt-4">
                                    <select 
                                        onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                        className="coastal-select max-w-xs"
                                        value={selectedClient?.id || ''}
                                    >
                                        <option value="">Select a client...</option>
                                        {getMyClients().map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                </div>
                            )}
                        </div>

                        {(hasRole('client') || selectedClient) && (
                            <>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div className="stat-card">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-3xl">⚖️</span>
                                            <span className="text-2xl font-bold text-gray-800">{latestMeasurement.weight || '-'} lbs</span>
                                        </div>
                                        <p className="text-sm text-gray-600">Current Weight</p>
                                        <p className="text-xs text-gray-500">{latestMeasurement.date || 'No data'}</p>
                                    </div>

                                    <div className="stat-card">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-3xl">🔥</span>
                                            <span className="text-2xl font-bold text-orange-600">{latestMeasurement.bodyFat || '-'}%</span>
                                        </div>
                                        <p className="text-sm text-gray-600">Body Fat</p>
                                        <p className="text-xs text-gray-500">Current level</p>
                                    </div>

                                    <div className="stat-card">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-3xl">❤️</span>
                                            <span className="text-2xl font-bold text-red-600">{latestMeasurement.bloodPressure || '-'}</span>
                                        </div>
                                        <p className="text-sm text-gray-600">Blood Pressure</p>
                                        <p className="text-xs text-gray-500">{latestMeasurement.date || 'No data'}</p>
                                    </div>

                                    <div className="stat-card">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-3xl">🏆</span>
                                            <span className="text-2xl font-bold text-green-600">{myGoals.filter(g => g.current >= g.target).length}/{myGoals.length}</span>
                                        </div>
                                        <p className="text-sm text-gray-600">Goals Completed</p>
                                        <p className="text-xs text-gray-500">Keep it up!</p>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="pain-summary-card">
                                        <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
                                            <span>🩹</span>
                                            Pain Level Summary
                                        </h3>
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-3xl font-bold text-orange-700">{avgPainLevel}</p>
                                                <p className="text-sm text-gray-700">Average Pain Level</p>
                                            </div>
                                            <div className="flex gap-1">
                                                {[0, 1, 2, 3, 4, 5].map(level => (
                                                    <div
                                                        key={level}
                                                        className={`pain-scale-btn pain-${level} ${
                                                            Math.round(avgPainLevel) === level ? 'selected' : ''
                                                        }`}
                                                        style={{ cursor: 'default' }}
                                                    >
                                                        {level}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <p className="text-xs text-gray-600 mt-3">
                                            Based on {myWorkouts.filter(w => w.completed).length} completed workouts
                                        </p>
                                    </div>

                                    <div className="mood-summary-card">
                                        <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
                                            <span>😊</span>
                                            Workout Mood Tracker
                                        </h3>
                                        <div className="space-y-2">
                                            {recentMoods.length > 0 ? (
                                                recentMoods.map((workout, index) => (
                                                    <div key={workout.id} className="flex items-center justify-between">
                                                        <span className="text-sm text-gray-700">{workout.name}</span>
                                                        <span className="text-2xl">
                                                            {['😢', '😕', '😐', '😊', '😁'][workout.moodFeedback - 1]}
                                                        </span>
                                                    </div>
                                                ))
                                            ) : (
                                                <p className="text-sm text-gray-600">No mood feedback yet</p>
                                            )}
                                        </div>
                                        <p className="text-xs text-gray-600 mt-3">
                                            Recent workout mood feedback
                                        </p>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div className="coastal-card p-6">
                                        <h3 className="text-lg font-semibold mb-4">💪 Today's Workouts</h3>
                                        {myWorkouts.length > 0 ? myWorkouts.map(workout => (
                                            <div key={workout.id} className="bg-gray-50 rounded-xl p-4 mb-3">
                                                <div className="flex justify-between items-center">
                                                    <div>
                                                        <h4 className="font-semibold">{workout.name}</h4>
                                                        <p className="text-sm text-gray-600">
                                                            {workout.exercises.map(e => e.name).join(' • ')}
                                                        </p>
                                                    </div>
                                                    {workout.completed && (
                                                        <span className="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm">
                                                            ✓ Complete
                                                        </span>
                                                    )}
                                                </div>
                                                {workout.moodFeedback && (
                                                    <div className="mt-2 text-sm text-gray-600">
                                                        Mood: {['😢', '😕', '😐', '😊', '😁'][workout.moodFeedback - 1] || '😐'}
                                                    </div>
                                                )}
                                            </div>
                                        )) : (
                                            <p className="text-gray-500">No workouts assigned</p>
                                        )}
                                    </div>

                                    <div className="coastal-card p-6">
                                        <h3 className="text-lg font-semibold mb-4">🥗 Nutrition Today</h3>
                                        {clientData.nutrition && (clientData.nutrition.clientId === currentClientId) ? (
                                            <div className="space-y-3">
                                                <div>
                                                    <div className="flex justify-between mb-1">
                                                        <span className="text-sm text-gray-600">Protein</span>
                                                        <span className="text-sm font-semibold">{clientData.nutrition.protein.current}g / {clientData.nutrition.protein.target}g</span>
                                                    </div>
                                                    <div className="progress-bar">
                                                        <div className="progress-fill" style={{ width: `${(clientData.nutrition.protein.current / clientData.nutrition.protein.target) * 100}%` }}></div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div className="flex justify-between mb-1">
                                                        <span className="text-sm text-gray-600">Carbs</span>
                                                        <span className="text-sm font-semibold">{clientData.nutrition.carbs.current}g / {clientData.nutrition.carbs.target}g</span>
                                                    </div>
                                                    <div className="progress-bar">
                                                        <div className="progress-fill" style={{ width: `${(clientData.nutrition.carbs.current / clientData.nutrition.carbs.target) * 100}%` }}></div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div className="flex justify-between mb-1">
                                                        <span className="text-sm text-gray-600">Fat</span>
                                                        <span className="text-sm font-semibold">{clientData.nutrition.fat.current}g / {clientData.nutrition.fat.target}g</span>
                                                    </div>
                                                    <div className="progress-bar">
                                                        <div className="progress-fill" style={{ width: `${(clientData.nutrition.fat.current / clientData.nutrition.fat.target) * 100}%` }}></div>
                                                    </div>
                                                </div>
                                                <div className="pt-3 border-t">
                                                    <div className="flex justify-between">
                                                        <span className="text-sm font-medium">Calories</span>
                                                        <span className="text-sm font-bold text-blue-600">{clientData.nutrition.calories.current} / {clientData.nutrition.calories.target}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        ) : (
                                            <p className="text-gray-500">No nutrition plan assigned</p>
                                        )}
                                    </div>
                                </div>

                                <div className="coastal-card p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-lg font-semibold">Progress Chart</h3>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => toggleMetric('weight')}
                                                className={`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${
                                                    selectedMetrics.includes('weight') 
                                                        ? 'bg-blue-500 text-white' 
                                                        : 'bg-gray-200 text-gray-600'
                                                }`}
                                            >
                                                Weight
                                            </button>
                                            <button
                                                onClick={() => toggleMetric('bodyFat')}
                                                className={`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${
                                                    selectedMetrics.includes('bodyFat') 
                                                        ? 'bg-amber-500 text-white' 
                                                        : 'bg-gray-200 text-gray-600'
                                                }`}
                                            >
                                                Body Fat
                                            </button>
                                            <button
                                                onClick={() => toggleMetric('bmr')}
                                                className={`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${
                                                    selectedMetrics.includes('bmr') 
                                                        ? 'bg-green-500 text-white' 
                                                        : 'bg-gray-200 text-gray-600'
                                                }`}
                                            >
                                                BMR
                                            </button>
                                        </div>
                                    </div>
                                    <div className="h-64">
                                        <canvas ref={chartRef}></canvas>
                                    </div>
                                </div>

                                <div className="coastal-card p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-lg font-semibold">Body Circumference Chart</h3>
                                        <button
                                            onClick={() => setShowCircumferenceChart(!showCircumferenceChart)}
                                            className="coastal-button-secondary"
                                        >
                                            {showCircumferenceChart ? 'Hide' : 'Show'} Chart
                                        </button>
                                    </div>
                                    {showCircumferenceChart && (
                                        <div className="h-64">
                                            <canvas ref={circumferenceChartRef}></canvas>
                                        </div>
                                    )}
                                </div>
                            </>
                        )}
                    </div>
                );
            };

            // Chat Component
            const ChatComponent = () => {
                const [selectedChat, setSelectedChat] = useState(null);
                const [messageText, setMessageText] = useState('');
                const [searchQuery, setSearchQuery] = useState('');
                const [typing, setTyping] = useState({});
                const [showZoomScheduler, setShowZoomScheduler] = useState(false);
                const [zoomForm, setZoomForm] = useState({
                    date: new Date(Date.now() + 86400000).toISOString().split('T')[0], // Tomorrow
                    time: '15:00',
                    duration: '60',
                    topic: ''
                });
                const messagesEndRef = useRef(null);

                const getChatPartners = () => {
                    if (hasRole('client')) {
                        return allUsers.filter(u => 
                            u.id !== currentUser.id && (
                                (u.roles.includes('specialist') && (
                                    currentUser.specialistIds?.includes(u.id) || 
                                    u.clientIds?.includes(currentUser.id)
                                )) ||
                                u.roles.includes('admin') || 
                                u.roles.includes('owner')
                            )
                        );
                    } else if (hasAnyRole('owner', 'admin')) {
                        return allUsers.filter(u => u.id !== currentUser.id);
                    } else if (hasRole('specialist')) {
                        const assignedClients = allUsers.filter(u =>
                            u.id !== currentUser.id &&
                            u.roles.includes('client') &&
                            (currentUser.clientIds?.includes(u.id) || u.specialistIds?.includes(currentUser.id))
                        );
                        
                        const adminSupport = allUsers.filter(u =>
                            u.id !== currentUser.id &&
                            (u.roles.includes('admin') || u.roles.includes('owner'))
                        );
                        
                        return [...assignedClients, ...adminSupport];
                    }
                    return [];
                };

                const filteredChatPartners = getChatPartners().filter(partner => 
                    partner.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    partner.email.toLowerCase().includes(searchQuery.toLowerCase())
                );

                const getChatKey = (userId1, userId2) => [userId1, userId2].sort().join('-');

                const sendMessage = () => {
                    if (messageText.trim() && selectedChat) {
                        const chatKey = getChatKey(currentUser.id, selectedChat.id);
                        const currentSelectedChat = selectedChat; // Preserve the selected chat
                        const newMessage = {
                            id: Date.now(),
                            text: messageText.trim(),
                            sender: currentUser.id,
                            senderName: currentUser.name,
                            timestamp: new Date().toISOString(),
                            read: false
                        };

                        setMessages(prevMessages => {
                            const currentMessages = prevMessages[chatKey] || [];
                            const updatedMessages = {
                                ...prevMessages,
                                [chatKey]: [...currentMessages, newMessage]
                            };
                            
                            // Save to localStorage
                            try {
                                localStorage.setItem('coastalMessages', JSON.stringify(updatedMessages));
                            } catch (error) {
                                console.error('Error saving messages:', error);
                            }
                            
                            return updatedMessages;
                        });
                        setMessageText('');
                        
                        // Reset textarea height
                        const textarea = document.querySelector('.chat-input');
                        if (textarea) {
                            textarea.style.height = '36px';
                        }
                        
                        // Simulate typing indicator for demo
                        if (Math.random() > 0.5) {
                            setTyping({ [currentSelectedChat.id]: true });
                            setTimeout(() => {
                                setTyping({});
                                // Simulate response
                                const responseMessage = {
                                    id: Date.now() + 1,
                                    text: 'Thanks for your message! I\'ll get back to you soon.',
                                    sender: currentSelectedChat.id,
                                    senderName: currentSelectedChat.name,
                                    timestamp: new Date().toISOString(),
                                    read: false
                                };
                                
                                setMessages(prevMessages => {
                                    const currentMessages = prevMessages[chatKey] || [];
                                    const updatedMessages = {
                                        ...prevMessages,
                                        [chatKey]: [...currentMessages, responseMessage]
                                    };
                                    
                                    try {
                                        localStorage.setItem('coastalMessages', JSON.stringify(updatedMessages));
                                    } catch (error) {
                                        console.error('Error saving messages:', error);
                                    }
                                    
                                    return updatedMessages;
                                });
                            }, 2000);
                        }
                    }
                };

                const scheduleZoomCall = () => {
                    if (selectedChat) {
                        setShowZoomScheduler(true);
                    }
                };
                
                const confirmZoomSchedule = () => {
                    if (selectedChat && zoomForm.date && zoomForm.time) {
                        const chatKey = getChatKey(currentUser.id, selectedChat.id);
                        const meetingDateTime = new Date(`${zoomForm.date}T${zoomForm.time}`);
                        const meetingId = Math.floor(Math.random() * 900000000) + 100000000;
                        
                        const zoomMessage = {
                            id: Date.now(),
                            text: `📹 Zoom meeting scheduled!\n\n` +
                                  `📅 Date: ${meetingDateTime.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}\n` +
                                  `⏰ Time: ${meetingDateTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}\n` +
                                  `⏱️ Duration: ${zoomForm.duration} minutes\n` +
                                  `📝 Topic: ${zoomForm.topic || 'Health Consultation'}\n\n` +
                                  `Join URL: https://zoom.us/j/${meetingId}\n` +
                                  `Meeting ID: ${meetingId}`,
                            sender: currentUser.id,
                            senderName: currentUser.name,
                            timestamp: new Date().toISOString(),
                            read: false,
                            isZoomLink: true
                        };

                        setMessages(prevMessages => {
                            const currentMessages = prevMessages[chatKey] || [];
                            const updatedMessages = {
                                ...prevMessages,
                                [chatKey]: [...currentMessages, zoomMessage]
                            };
                            
                            // Save to localStorage
                            try {
                                localStorage.setItem('coastalMessages', JSON.stringify(updatedMessages));
                            } catch (error) {
                                console.error('Error saving messages:', error);
                            }
                            
                            return updatedMessages;
                        });
                        
                        // Reset form and close modal
                        setShowZoomScheduler(false);
                        setZoomForm({
                            date: new Date(Date.now() + 86400000).toISOString().split('T')[0],
                            time: '15:00',
                            duration: '60',
                            topic: ''
                        });
                    }
                };

                const formatMessageTime = (timestamp) => {
                    const date = new Date(timestamp);
                    const now = new Date();
                    const diffMs = now - date;
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMs / 3600000);
                    const diffDays = Math.floor(diffMs / 86400000);

                    if (diffMins < 1) return 'now';
                    if (diffMins < 60) return `${diffMins}m`;
                    if (diffHours < 24) return `${diffHours}h`;
                    if (diffDays < 7) return `${diffDays}d`;
                    
                    return date.toLocaleDateString();
                };

                const getUnreadCount = (partnerId) => {
                    const chatKey = getChatKey(currentUser.id, partnerId);
                    const chatMessages = messages[chatKey] || [];
                    return chatMessages.filter(msg => 
                        msg.sender !== currentUser.id && !msg.read
                    ).length;
                };

                const markAsRead = (partnerId) => {
                    const chatKey = getChatKey(currentUser.id, partnerId);
                    const chatMessages = messages[chatKey] || [];
                    if (chatMessages.length > 0) {
                        const hasUnread = chatMessages.some(msg => msg.sender !== currentUser.id && !msg.read);
                        if (hasUnread) {
                            const updatedMessages = chatMessages.map(msg => ({
                                ...msg,
                                read: true
                            }));
                            setMessages(prevMessages => {
                                const updated = {
                                    ...prevMessages,
                                    [chatKey]: updatedMessages
                                };
                                
                                // Save to localStorage
                                try {
                                    localStorage.setItem('coastalMessages', JSON.stringify(updated));
                                } catch (error) {
                                    console.error('Error saving messages:', error);
                                }
                                
                                return updated;
                            });
                        }
                    }
                };

                const getUserRoles = (user) => {
                    return user.roles.filter(role => role !== 'client');
                };

                useEffect(() => {
                    if (messagesEndRef.current) {
                        messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });
                    }
                }, [messages, selectedChat]);

                useEffect(() => {
                    if (selectedChat) {
                        markAsRead(selectedChat.id);
                    }
                }, [selectedChat]);

                const chatMessagesForSelected = selectedChat ? (messages[getChatKey(currentUser.id, selectedChat.id)] || []) : [];

                return (
                    <div className="coastal-card p-0 overflow-hidden">
                        <div className="chat-container">
                            <div className="chat-sidebar">
                                <div className="chat-header">
                                    <h3 className="text-lg font-semibold mb-3">Messages</h3>
                                    <input
                                        type="text"
                                        placeholder="Search conversations..."
                                        className="chat-search"
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                    />
                                </div>
                                <div className="chat-list">
                                    {filteredChatPartners.length > 0 ? (
                                        filteredChatPartners.map(partner => {
                                            const chatKey = getChatKey(currentUser.id, partner.id);
                                            const chatMessages = messages[chatKey] || [];
                                            const lastMessage = chatMessages[chatMessages.length - 1];
                                            const unreadCount = getUnreadCount(partner.id);
                                            const roles = getUserRoles(partner);
                                            
                                            return (
                                                <div
                                                    key={partner.id}
                                                    onClick={() => setSelectedChat(partner)}
                                                    className={`chat-item ${selectedChat?.id === partner.id ? 'active' : ''}`}
                                                >
                                                    <div className="chat-avatar">
                                                        {partner.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2)}
                                                        {partner.online && <div className="online-indicator"></div>}
                                                    </div>
                                                    <div className="chat-item-info">
                                                        <div className="chat-item-name">
                                                            {partner.name}
                                                            {roles.length > 0 && (
                                                                <span className={`coastal-badge badge-${roles[0]} text-xs`}>
                                                                    {roles[0]}
                                                                </span>
                                                            )}
                                                        </div>
                                                        {lastMessage && (
                                                            <div className="chat-item-message">
                                                                {lastMessage.sender === currentUser.id && 'You: '}
                                                                {lastMessage.text.length > 30 
                                                                    ? lastMessage.text.substring(0, 30) + '...'
                                                                    : lastMessage.text
                                                                }
                                                            </div>
                                                        )}
                                                    </div>
                                                    {lastMessage && (
                                                        <div className="chat-item-time">
                                                            {formatMessageTime(lastMessage.timestamp)}
                                                        </div>
                                                    )}
                                                    {unreadCount > 0 && (
                                                        <div className="unread-count">{unreadCount}</div>
                                                    )}
                                                </div>
                                            );
                                        })
                                    ) : (
                                        <div className="p-4 text-center text-gray-500 text-sm">
                                            {getChatPartners().length === 0 
                                                ? 'No available contacts' 
                                                : 'No conversations match your search'
                                            }
                                        </div>
                                    )}
                                </div>
                            </div>

                            <div className="chat-main">
                                {selectedChat ? (
                                    <>
                                        <div className="chat-main-header">
                                            <div className="flex items-center">
                                                <div className="chat-avatar mr-3">
                                                    {selectedChat.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2)}
                                                    {selectedChat.online && <div className="online-indicator"></div>}
                                                </div>
                                                <div>
                                                    <div className="font-semibold flex items-center gap-2">
                                                        {selectedChat.name}
                                                        {getUserRoles(selectedChat).map(role => (
                                                            <span key={role} className={`coastal-badge badge-${role} text-xs`}>
                                                                {role}
                                                            </span>
                                                        ))}
                                                    </div>
                                                    <div className="text-sm text-gray-500">
                                                        {selectedChat.online ? 'Active now' : 'Offline'}
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <button onClick={scheduleZoomCall} className="zoom-btn">
                                                    <span>📹</span>
                                                    <span>Schedule Zoom</span>
                                                </button>
                                                <button 
                                                    onClick={() => {
                                                        if (confirm('Clear chat history with ' + selectedChat.name + '?')) {
                                                            const chatKey = getChatKey(currentUser.id, selectedChat.id);
                                                            setMessages(prev => {
                                                                const updated = { ...prev };
                                                                delete updated[chatKey];
                                                                try {
                                                                    localStorage.setItem('coastalMessages', JSON.stringify(updated));
                                                                } catch (error) {
                                                                    console.error('Error saving messages:', error);
                                                                }
                                                                return updated;
                                                            });
                                                        }
                                                    }}
                                                    className="text-gray-500 hover:text-gray-700 text-sm p-2"
                                                    title="Clear chat history"
                                                >
                                                    🗑️
                                                </button>
                                            </div>
                                        </div>

                                        <div className="chat-messages">
                                            {chatMessagesForSelected.map((msg, index, array) => {
                                                const showTime = index === 0 || 
                                                    new Date(msg.timestamp).getTime() - new Date(array[index - 1].timestamp).getTime() > 300000;
                                                
                                                return (
                                                    <div key={msg.id} className="message-group">
                                                        {showTime && (
                                                            <div className="message-time text-center text-xs text-gray-500 my-2">
                                                                {new Date(msg.timestamp).toLocaleString()}
                                                            </div>
                                                        )}
                                                        <div className={`flex ${msg.sender === currentUser.id ? 'justify-end' : 'justify-start'}`}>
                                                            <div className={`message-bubble ${
                                                                msg.sender === currentUser.id ? 'message-sent' : 'message-received'
                                                            } ${msg.isZoomLink ? 'zoom-meeting' : ''}`}>
                                                                {msg.text}
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                            {typing[selectedChat.id] && (
                                                <div className="typing-indicator">
                                                    <div className="typing-dot"></div>
                                                    <div className="typing-dot"></div>
                                                    <div className="typing-dot"></div>
                                                </div>
                                            )}
                                            <div ref={messagesEndRef} />
                                        </div>

                                        <div className="chat-input-container">
                                            <textarea
                                                value={messageText}
                                                onChange={(e) => {
                                                    setMessageText(e.target.value);
                                                    // Auto-resize textarea
                                                    e.target.style.height = 'auto';
                                                    e.target.style.height = Math.min(e.target.scrollHeight, 100) + 'px';
                                                }}
                                                onKeyDown={(e) => {
                                                    if (e.key === 'Enter' && !e.shiftKey) {
                                                        e.preventDefault();
                                                        sendMessage();
                                                    }
                                                }}
                                                placeholder="Type a message... (Press Enter to send, Shift+Enter for new line)"
                                                className="chat-input"
                                                rows="1"
                                                style={{ resize: 'none', overflow: 'auto', height: '36px' }}
                                            />
                                            <button 
                                                onClick={sendMessage} 
                                                className="chat-send-btn"
                                                disabled={!messageText.trim()}
                                                title="Send message"
                                            >
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </>
                                ) : (
                                    <div className="flex items-center justify-center h-full text-gray-500">
                                        <div className="text-center">
                                            <span className="text-6xl">💬</span>
                                            <p className="mt-4 font-semibold">Select a conversation to start chatting</p>
                                            <p className="text-sm mt-2">
                                                {filteredChatPartners.length} contact{filteredChatPartners.length !== 1 ? 's' : ''} available
                                            </p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                        
                        {showZoomScheduler && (
                            <div className="modal-overlay" onClick={() => setShowZoomScheduler(false)}>
                                <div className="modal-content max-w-lg" onClick={(e) => e.stopPropagation()}>
                                    <h3 className="text-xl font-semibold mb-4">
                                        Schedule Zoom Meeting with {selectedChat?.name}
                                    </h3>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="form-label">Meeting Topic</label>
                                            <input
                                                type="text"
                                                value={zoomForm.topic}
                                                onChange={(e) => setZoomForm({...zoomForm, topic: e.target.value})}
                                                className="coastal-input"
                                                placeholder="Health Consultation"
                                            />
                                        </div>
                                        
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="form-label">Date</label>
                                                <input
                                                    type="date"
                                                    value={zoomForm.date}
                                                    onChange={(e) => setZoomForm({...zoomForm, date: e.target.value})}
                                                    className="coastal-input"
                                                    min={new Date().toISOString().split('T')[0]}
                                                />
                                            </div>
                                            
                                            <div>
                                                <label className="form-label">Time</label>
                                                <input
                                                    type="time"
                                                    value={zoomForm.time}
                                                    onChange={(e) => setZoomForm({...zoomForm, time: e.target.value})}
                                                    className="coastal-input"
                                                />
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label className="form-label">Duration</label>
                                            <select
                                                value={zoomForm.duration}
                                                onChange={(e) => setZoomForm({...zoomForm, duration: e.target.value})}
                                                className="coastal-select"
                                            >
                                                <option value="30">30 minutes</option>
                                                <option value="45">45 minutes</option>
                                                <option value="60">1 hour</option>
                                                <option value="90">1.5 hours</option>
                                                <option value="120">2 hours</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div className="flex gap-2 mt-6">
                                        <button
                                            onClick={confirmZoomSchedule}
                                            className="coastal-button flex-1"
                                        >
                                            📹 Schedule Meeting
                                        </button>
                                        <button
                                            onClick={() => setShowZoomScheduler(false)}
                                            className="coastal-button bg-gray-500 hover:bg-gray-600 flex-1"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Nutrition Component
            const NutritionComponent = () => {
                const [showAssignForm, setShowAssignForm] = useState(false);
                const [nutritionPlan, setNutritionPlan] = useState({
                    protein: '',
                    carbs: '',
                    fat: '',
                    calories: '',
                    breakfast: '',
                    lunch: '',
                    dinner: ''
                });

                const isClient = hasRole('client');
                const canAssign = hasAnyRole('specialist', 'admin', 'owner');

                const handleAssignNutrition = () => {
                    if (selectedClient && nutritionPlan.protein && nutritionPlan.carbs && nutritionPlan.fat && nutritionPlan.calories) {
                        setClientData({
                            ...clientData,
                            nutrition: {
                                clientId: selectedClient.id,
                                assignedBy: currentUser.id,
                                protein: { target: parseInt(nutritionPlan.protein), current: 0 },
                                carbs: { target: parseInt(nutritionPlan.carbs), current: 0 },
                                fat: { target: parseInt(nutritionPlan.fat), current: 0 },
                                calories: { target: parseInt(nutritionPlan.calories), current: 0 },
                                mealPlan: {
                                    breakfast: nutritionPlan.breakfast,
                                    lunch: nutritionPlan.lunch,
                                    dinner: nutritionPlan.dinner
                                }
                            }
                        });
                        setShowAssignForm(false);
                        setNutritionPlan({
                            protein: '',
                            carbs: '',
                            fat: '',
                            calories: '',
                            breakfast: '',
                            lunch: '',
                            dinner: ''
                        });
                    }
                };

                if (isClient) {
                    return (
                        <div className="coastal-card p-6">
                            <h2 className="text-2xl font-bold mb-6">🥗 My Nutrition Plan</h2>
                            {clientData.nutrition && clientData.nutrition.clientId === currentUser.id ? (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h3 className="text-lg font-semibold mb-4">Daily Targets</h3>
                                        <div className="space-y-3">
                                            <div className="bg-gray-50 rounded-lg p-4">
                                                <div className="flex justify-between items-center">
                                                    <span>Protein</span>
                                                    <span className="font-bold">{clientData.nutrition.protein.target}g</span>
                                                </div>
                                            </div>
                                            <div className="bg-gray-50 rounded-lg p-4">
                                                <div className="flex justify-between items-center">
                                                    <span>Carbs</span>
                                                    <span className="font-bold">{clientData.nutrition.carbs.target}g</span>
                                                </div>
                                            </div>
                                            <div className="bg-gray-50 rounded-lg p-4">
                                                <div className="flex justify-between items-center">
                                                    <span>Fat</span>
                                                    <span className="font-bold">{clientData.nutrition.fat.target}g</span>
                                                </div>
                                            </div>
                                            <div className="bg-gray-50 rounded-lg p-4">
                                                <div className="flex justify-between items-center">
                                                    <span>Calories</span>
                                                    <span className="font-bold">{clientData.nutrition.calories.target}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <h3 className="text-lg font-semibold mb-4">Meal Plan</h3>
                                        {clientData.nutrition.mealPlan.breakfast && (
                                            <div className="space-y-3">
                                                <div className="bg-blue-50 rounded-lg p-4">
                                                    <h4 className="font-semibold text-blue-800">Breakfast</h4>
                                                    <p className="text-sm mt-1">{clientData.nutrition.mealPlan.breakfast}</p>
                                                </div>
                                                <div className="bg-green-50 rounded-lg p-4">
                                                    <h4 className="font-semibold text-green-800">Lunch</h4>
                                                    <p className="text-sm mt-1">{clientData.nutrition.mealPlan.lunch}</p>
                                                </div>
                                                <div className="bg-purple-50 rounded-lg p-4">
                                                    <h4 className="font-semibold text-purple-800">Dinner</h4>
                                                    <p className="text-sm mt-1">{clientData.nutrition.mealPlan.dinner}</p>
                                                </div>
                                            </div>
                                        )}
                                        {clientData.nutrition.assignedBy && (
                                            <div className="mt-4 text-sm text-gray-600">
                                                Assigned by: {allUsers.find(u => u.id === clientData.nutrition.assignedBy)?.name}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            ) : (
                                <p className="text-gray-500">No nutrition plan assigned yet</p>
                            )}
                        </div>
                    );
                }

                return (
                    <div className="coastal-card p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">🥗 Nutrition Management</h2>
                            {canAssign && (
                                <button 
                                    onClick={() => setShowAssignForm(!showAssignForm)} 
                                    className="coastal-button"
                                >
                                    + Assign Nutrition Plan
                                </button>
                            )}
                        </div>

                        {showAssignForm && (
                            <div className="assignment-form animate-slide-in">
                                <div className="assignment-header">
                                    <span>🥗</span>
                                    <span>Assign Nutrition Plan</span>
                                </div>
                                
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Select Client
                                    </label>
                                    <select 
                                        onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                        className="coastal-select"
                                        value={selectedClient?.id || ''}
                                    >
                                        <option value="">Choose a client...</option>
                                        {getMyClients().map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                </div>
                                
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Protein (g)</label>
                                        <input
                                            type="number"
                                            value={nutritionPlan.protein}
                                            onChange={(e) => setNutritionPlan({...nutritionPlan, protein: e.target.value})}
                                            className="coastal-input"
                                            placeholder="165"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Carbs (g)</label>
                                        <input
                                            type="number"
                                            value={nutritionPlan.carbs}
                                            onChange={(e) => setNutritionPlan({...nutritionPlan, carbs: e.target.value})}
                                            className="coastal-input"
                                            placeholder="200"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Fat (g)</label>
                                        <input
                                            type="number"
                                            value={nutritionPlan.fat}
                                            onChange={(e) => setNutritionPlan({...nutritionPlan, fat: e.target.value})}
                                            className="coastal-input"
                                            placeholder="60"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Calories</label>
                                        <input
                                            type="number"
                                            value={nutritionPlan.calories}
                                            onChange={(e) => setNutritionPlan({...nutritionPlan, calories: e.target.value})}
                                            className="coastal-input"
                                            placeholder="2000"
                                        />
                                    </div>
                                </div>
                                
                                <div className="space-y-3 mb-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Meal Plan (Optional)</label>
                                        <input
                                            type="text"
                                            value={nutritionPlan.breakfast}
                                            onChange={(e) => setNutritionPlan({...nutritionPlan, breakfast: e.target.value})}
                                            className="coastal-input"
                                            placeholder="Breakfast (e.g., Oatmeal with berries)"
                                        />
                                    </div>
                                    <input
                                        type="text"
                                        value={nutritionPlan.lunch}
                                        onChange={(e) => setNutritionPlan({...nutritionPlan, lunch: e.target.value})}
                                        className="coastal-input"
                                        placeholder="Lunch (e.g., Grilled chicken salad)"
                                    />
                                    <input
                                        type="text"
                                        value={nutritionPlan.dinner}
                                        onChange={(e) => setNutritionPlan({...nutritionPlan, dinner: e.target.value})}
                                        className="coastal-input"
                                        placeholder="Dinner (e.g., Salmon with vegetables)"
                                    />
                                </div>
                                
                                <button 
                                    onClick={handleAssignNutrition} 
                                    className="coastal-button w-full"
                                    disabled={!selectedClient || !nutritionPlan.protein || !nutritionPlan.carbs || !nutritionPlan.fat || !nutritionPlan.calories}
                                >
                                    🎯 Assign Nutrition Plan
                                </button>
                            </div>
                        )}

                        <div>
                            <h3 className="text-lg font-semibold mb-4">Assigned Nutrition Plans</h3>
                            <div className="space-y-3">
                                {allUsers
                                    .filter(u => u.roles.includes('client'))
                                    .filter(u => clientData.nutrition?.clientId === u.id)
                                    .map(client => (
                                        <div key={client.id} className="bg-gray-50 rounded-xl p-4">
                                            <h4 className="font-semibold">{client.name}</h4>
                                            <div className="mt-2 grid grid-cols-4 gap-4 text-sm">
                                                <div>
                                                    <span className="text-gray-600">Protein:</span>
                                                    <span className="font-semibold ml-1">{clientData.nutrition.protein.target}g</span>
                                                </div>
                                                <div>
                                                    <span className="text-gray-600">Carbs:</span>
                                                    <span className="font-semibold ml-1">{clientData.nutrition.carbs.target}g</span>
                                                </div>
                                                <div>
                                                    <span className="text-gray-600">Fat:</span>
                                                    <span className="font-semibold ml-1">{clientData.nutrition.fat.target}g</span>
                                                </div>
                                                <div>
                                                    <span className="text-gray-600">Calories:</span>
                                                    <span className="font-semibold ml-1">{clientData.nutrition.calories.target}</span>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                {(!clientData.nutrition || !allUsers.some(u => u.id === clientData.nutrition.clientId)) && (
                                    <p className="text-gray-500">No nutrition plans assigned yet</p>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // Workouts Component
            const WorkoutsComponent = () => {
                const [showCreateForm, setShowCreateForm] = useState(false);
                const [workoutForm, setWorkoutForm] = useState({
                    name: '',
                    exercises: [],
                    exerciseImage: null,
                    youtubeLink: ''
                });
                const [newExercise, setNewExercise] = useState({
                    name: '',
                    sets: '',
                    reps: '',
                    weight: '',
                    specialistNote: '',
                    exerciseImage: null,
                    youtubeLink: ''
                });

                const isClient = hasRole('client');
                const canAssign = hasAnyRole('specialist', 'admin', 'owner');

                const handleImageUpload = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onloadend = () => {
                            setWorkoutForm({
                                ...workoutForm,
                                exerciseImage: reader.result
                            });
                        };
                        reader.readAsDataURL(file);
                    }
                };

                const handleExerciseImageUpload = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onloadend = () => {
                            setNewExercise({
                                ...newExercise,
                                exerciseImage: reader.result
                            });
                        };
                        reader.readAsDataURL(file);
                    }
                };

                const addExercise = () => {
                    if (newExercise.name && newExercise.sets && newExercise.reps) {
                        setWorkoutForm({
                            ...workoutForm,
                            exercises: [...workoutForm.exercises, {
                                ...newExercise,
                                id: Date.now(),
                                sets: parseInt(newExercise.sets),
                                reps: parseInt(newExercise.reps),
                                weight: parseInt(newExercise.weight) || 0,
                                exerciseImage: newExercise.exerciseImage,
                                youtubeLink: newExercise.youtubeLink
                            }]
                        });
                        setNewExercise({ 
                            name: '', 
                            sets: '', 
                            reps: '', 
                            weight: '', 
                            specialistNote: '', 
                            exerciseImage: null, 
                            youtubeLink: '' 
                        });
                    }
                };

                const handleCreateWorkout = () => {
                    if (selectedClient && workoutForm.name && workoutForm.exercises.length > 0) {
                        const newWorkout = {
                            id: Date.now(),
                            name: workoutForm.name,
                            clientId: selectedClient.id,
                            assignedBy: currentUser.id,
                            exercises: workoutForm.exercises,
                            exerciseImage: workoutForm.exerciseImage,
                            youtubeLink: workoutForm.youtubeLink,
                            completed: false
                        };
                        setClientData({
                            ...clientData,
                            workouts: [...clientData.workouts, newWorkout]
                        });
                        setShowCreateForm(false);
                        setWorkoutForm({ name: '', exercises: [], exerciseImage: null, youtubeLink: '' });
                        setNewExercise({ 
                            name: '', 
                            sets: '', 
                            reps: '', 
                            weight: '', 
                            specialistNote: '', 
                            exerciseImage: null, 
                            youtubeLink: '' 
                        });
                    }
                };

                const handleExerciseFeedback = (workoutId, exerciseId, field, value) => {
                    setClientData({
                        ...clientData,
                        workouts: clientData.workouts.map(w => {
                            if (w.id === workoutId) {
                                return {
                                    ...w,
                                    exercises: w.exercises.map(e => {
                                        if (e.id === exerciseId) {
                                            return { ...e, [field]: value };
                                        }
                                        return e;
                                    })
                                };
                            }
                            return w;
                        })
                    });
                };

                const handleWorkoutCompletion = (workoutId, moodLevel) => {
                    setClientData({
                        ...clientData,
                        workouts: clientData.workouts.map(w => {
                            if (w.id === workoutId) {
                                return {
                                    ...w,
                                    completed: true,
                                    moodFeedback: moodLevel,
                                    completedDate: new Date().toISOString()
                                };
                            }
                            return w;
                        })
                    });
                };

                const myWorkouts = clientData.workouts.filter(w => 
                    hasRole('client') ? w.clientId === currentUser.id : true
                );

                if (isClient) {
                    return (
                        <div className="coastal-card p-6">
                            <h2 className="text-2xl font-bold mb-6">💪 My Workouts</h2>
                            
                            <div className="space-y-4">
                                {myWorkouts.map(workout => (
                                    <div key={workout.id} className="coastal-card p-6">
                                        <div className="flex justify-between items-start mb-4">
                                            <div className="flex-1">
                                                <h3 className="text-xl font-semibold">{workout.name}</h3>
                                                <p className="text-sm text-gray-600">
                                                    Assigned by: {allUsers.find(u => u.id === workout.assignedBy)?.name}
                                                </p>
                                            </div>
                                            {workout.completed && (
                                                <span className="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm">
                                                    ✓ Completed
                                                </span>
                                            )}
                                        </div>
                                        
                                        {(workout.exerciseImage || workout.youtubeLink) && (
                                            <div className="mb-4 flex gap-4">
                                                {workout.exerciseImage && (
                                                    <div className="flex-shrink-0">
                                                        <img 
                                                            src={workout.exerciseImage} 
                                                            alt="Exercise demonstration"
                                                            className="w-32 h-32 object-cover rounded-lg"
                                                        />
                                                    </div>
                                                )}
                                                {workout.youtubeLink && (
                                                    <div className="flex items-center">
                                                        <a 
                                                            href={workout.youtubeLink} 
                                                            target="_blank" 
                                                            rel="noopener noreferrer"
                                                            className="coastal-button-secondary flex items-center gap-2"
                                                        >
                                                            <span>📹</span>
                                                            Watch Video Tutorial
                                                        </a>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                        
                                        <div className="space-y-3">
                                            {workout.exercises.map(exercise => (
                                                <div key={exercise.id} className="exercise-card">
                                                    <div className="flex justify-between items-start">
                                                        <div className="flex-1">
                                                            <h4 className="font-semibold">{exercise.name}</h4>
                                                            <p className="text-sm text-gray-600">
                                                                Target: {exercise.sets} sets × {exercise.reps} reps
                                                                {exercise.weight > 0 && ` @ ${exercise.weight} lbs`}
                                                            </p>
                                                            {exercise.specialistNote && (
                                                                <div className="specialist-note mt-2">
                                                                    <p className="text-sm font-medium">Specialist Note:</p>
                                                                    <p className="text-sm">{exercise.specialistNote}</p>
                                                                </div>
                                                            )}
                                                            {(exercise.exerciseImage || exercise.youtubeLink) && (
                                                                <div className="mt-2 flex gap-2">
                                                                    {exercise.exerciseImage && (
                                                                        <img 
                                                                            src={exercise.exerciseImage} 
                                                                            alt={`${exercise.name} demonstration`}
                                                                            className="w-20 h-20 object-cover rounded-lg cursor-pointer"
                                                                            onClick={() => window.open(exercise.exerciseImage, '_blank')}
                                                                        />
                                                                    )}
                                                                    {exercise.youtubeLink && (
                                                                        <a 
                                                                            href={exercise.youtubeLink} 
                                                                            target="_blank" 
                                                                            rel="noopener noreferrer"
                                                                            className="text-blue-600 hover:text-blue-700 text-sm flex items-center gap-1"
                                                                        >
                                                                            <span>📹</span>
                                                                            <span>Video</span>
                                                                        </a>
                                                                    )}
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                    
                                                    {!workout.completed && (
                                                        <div className="mt-3 space-y-2">
                                                            <div className="grid grid-cols-3 gap-2">
                                                                <input
                                                                    type="number"
                                                                    placeholder="Actual sets"
                                                                    value={exercise.actualSets || ''}
                                                                    onChange={(e) => handleExerciseFeedback(workout.id, exercise.id, 'actualSets', e.target.value)}
                                                                    className="coastal-input text-sm"
                                                                />
                                                                <input
                                                                    type="number"
                                                                    placeholder="Actual reps"
                                                                    value={exercise.actualReps || ''}
                                                                    onChange={(e) => handleExerciseFeedback(workout.id, exercise.id, 'actualReps', e.target.value)}
                                                                    className="coastal-input text-sm"
                                                                />
                                                                <input
                                                                    type="number"
                                                                    placeholder="Weight (lbs)"
                                                                    value={exercise.actualWeight || ''}
                                                                    onChange={(e) => handleExerciseFeedback(workout.id, exercise.id, 'actualWeight', e.target.value)}
                                                                    className="coastal-input text-sm"
                                                                />
                                                            </div>
                                                            
                                                            <div>
                                                                <p className="text-sm font-medium mb-1">Pain Level:</p>
                                                                <div className="flex gap-2">
                                                                    {[0, 1, 2, 3, 4, 5].map(level => (
                                                                        <button
                                                                            key={level}
                                                                            onClick={() => handleExerciseFeedback(workout.id, exercise.id, 'painLevel', level)}
                                                                            className={`pain-scale-btn pain-${level} ${exercise.painLevel === level ? 'selected' : ''}`}
                                                                        >
                                                                            {level}
                                                                        </button>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    )}
                                                    
                                                    {workout.completed && exercise.actualSets && (
                                                        <div className="mt-2 text-sm text-gray-600">
                                                            Completed: {exercise.actualSets} sets × {exercise.actualReps} reps
                                                            {exercise.actualWeight > 0 && ` @ ${exercise.actualWeight} lbs`}
                                                            {exercise.painLevel !== undefined && ` • Pain: ${exercise.painLevel}/5`}
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                        
                                        {!workout.completed && (
                                            <div className="mt-6">
                                                <p className="text-sm font-medium mb-2">How do you feel after this workout?</p>
                                                <div className="flex gap-3 mb-4">
                                                    {['😢', '😕', '😐', '😊', '😁'].map((mood, index) => (
                                                        <button
                                                            key={index}
                                                            onClick={() => handleWorkoutCompletion(workout.id, index + 1)}
                                                            className="mood-btn"
                                                            title={['Very Bad', 'Bad', 'Neutral', 'Good', 'Excellent'][index]}
                                                        >
                                                            {mood}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                        
                                        {workout.moodFeedback && (
                                            <div className="mt-4 bg-blue-50 rounded-lg p-3">
                                                <p className="text-sm">
                                                    Workout completed • Mood: {['😢', '😕', '😐', '😊', '😁'][workout.moodFeedback - 1] || '😐'}
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                ))}
                                {myWorkouts.length === 0 && (
                                    <p className="text-gray-500 text-center py-8">No workouts assigned yet</p>
                                )}
                            </div>
                        </div>
                    );
                }

                return (
                    <div className="coastal-card p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">💪 Workout Management</h2>
                            {canAssign && (
                                <button 
                                    onClick={() => setShowCreateForm(!showCreateForm)} 
                                    className="coastal-button"
                                >
                                    + Create & Assign Workout
                                </button>
                            )}
                        </div>

                        {showCreateForm && (
                            <div className="assignment-form animate-slide-in">
                                <div className="assignment-header">
                                    <span>💪</span>
                                    <span>Create & Assign Workout</span>
                                </div>
                                
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Select Client
                                    </label>
                                    <select 
                                        onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                        className="coastal-select"
                                        value={selectedClient?.id || ''}
                                    >
                                        <option value="">Choose a client...</option>
                                        {getMyClients().map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                </div>
                                
                                <input
                                    type="text"
                                    value={workoutForm.name}
                                    onChange={(e) => setWorkoutForm({...workoutForm, name: e.target.value})}
                                    className="coastal-input mb-4"
                                    placeholder="Workout Name (e.g., Upper Body Strength)"
                                />
                                
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Exercise Demonstration Image
                                    </label>
                                    <div className="workout-image-upload">
                                        <input
                                            type="file"
                                            accept="image/*"
                                            onChange={handleImageUpload}
                                        />
                                        {workoutForm.exerciseImage ? (
                                            <img 
                                                src={workoutForm.exerciseImage} 
                                                alt="Exercise preview"
                                                className="workout-image-preview"
                                            />
                                        ) : (
                                            <div className="text-center">
                                                <span className="text-4xl">📷</span>
                                                <p className="text-sm text-gray-500 mt-2">Upload Image</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        YouTube Video Link (Optional)
                                    </label>
                                    <input
                                        type="url"
                                        value={workoutForm.youtubeLink}
                                        onChange={(e) => setWorkoutForm({...workoutForm, youtubeLink: e.target.value})}
                                        className="coastal-input"
                                        placeholder="https://www.youtube.com/watch?v=..."
                                    />
                                </div>
                                
                                <div className="mb-4">
                                    <p className="text-sm font-medium mb-2">Exercises:</p>
                                    {workoutForm.exercises.map((ex, index) => (
                                        <div key={ex.id} className="bg-gray-50 rounded-lg p-3 mb-2">
                                            <p className="font-medium">{ex.name}</p>
                                            <p className="text-sm text-gray-600">
                                                {ex.sets} sets × {ex.reps} reps
                                                {ex.weight > 0 && ` @ ${ex.weight} lbs`}
                                            </p>
                                            {ex.specialistNote && (
                                                <p className="text-sm text-gray-600 italic">{ex.specialistNote}</p>
                                            )}
                                            {(ex.exerciseImage || ex.youtubeLink) && (
                                                <div className="mt-1 flex gap-2 text-xs">
                                                    {ex.exerciseImage && <span className="text-blue-600">📷 Image</span>}
                                                    {ex.youtubeLink && <span className="text-blue-600">📹 Video</span>}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                    
                                    <div className="space-y-2 mt-3">
                                        <input
                                            type="text"
                                            value={newExercise.name}
                                            onChange={(e) => setNewExercise({...newExercise, name: e.target.value})}
                                            className="coastal-input"
                                            placeholder="Exercise name (e.g., Push-ups)"
                                        />
                                        <div className="grid grid-cols-3 gap-2">
                                            <input
                                                type="number"
                                                value={newExercise.sets}
                                                onChange={(e) => setNewExercise({...newExercise, sets: e.target.value})}
                                                className="coastal-input"
                                                placeholder="Sets"
                                            />
                                            <input
                                                type="number"
                                                value={newExercise.reps}
                                                onChange={(e) => setNewExercise({...newExercise, reps: e.target.value})}
                                                className="coastal-input"
                                                placeholder="Reps"
                                            />
                                            <input
                                                type="number"
                                                value={newExercise.weight}
                                                onChange={(e) => setNewExercise({...newExercise, weight: e.target.value})}
                                                className="coastal-input"
                                                placeholder="Weight (lbs)"
                                            />
                                        </div>
                                        <input
                                            type="text"
                                            value={newExercise.specialistNote}
                                            onChange={(e) => setNewExercise({...newExercise, specialistNote: e.target.value})}
                                            className="coastal-input"
                                            placeholder="Note for client (optional)"
                                        />
                                        <input
                                            type="url"
                                            value={newExercise.youtubeLink}
                                            onChange={(e) => setNewExercise({...newExercise, youtubeLink: e.target.value})}
                                            className="coastal-input"
                                            placeholder="YouTube video link for this exercise (optional)"
                                        />
                                        <div className="flex items-center gap-2">
                                            <label className="flex items-center gap-2 cursor-pointer">
                                                <input
                                                    type="file"
                                                    accept="image/*"
                                                    onChange={handleExerciseImageUpload}
                                                    className="hidden"
                                                />
                                                <span className="coastal-button-secondary text-sm">
                                                    📷 Add Exercise Image
                                                </span>
                                            </label>
                                            {newExercise.exerciseImage && (
                                                <img 
                                                    src={newExercise.exerciseImage} 
                                                    alt="Exercise preview"
                                                    className="w-12 h-12 object-cover rounded"
                                                />
                                            )}
                                        </div>
                                        <button 
                                            onClick={addExercise}
                                            className="coastal-button-secondary text-sm"
                                        >
                                            + Add Exercise
                                        </button>
                                    </div>
                                </div>
                                
                                <button 
                                    onClick={handleCreateWorkout} 
                                    className="coastal-button w-full"
                                    disabled={!selectedClient || !workoutForm.name || workoutForm.exercises.length === 0}
                                >
                                    💪 Create & Assign Workout
                                </button>
                            </div>
                        )}

                        <div>
                            <h3 className="text-lg font-semibold mb-4">Assigned Workouts</h3>
                            <div className="space-y-3">
                                {myWorkouts.map(workout => (
                                    <div key={workout.id} className="bg-gray-50 rounded-xl p-4">
                                        <div className="flex justify-between items-start">
                                            <div className="flex gap-3">
                                                {workout.exerciseImage && (
                                                    <img 
                                                        src={workout.exerciseImage} 
                                                        alt="Exercise"
                                                        className="w-16 h-16 object-cover rounded-lg"
                                                    />
                                                )}
                                                <div>
                                                    <h4 className="font-semibold">{workout.name}</h4>
                                                    <p className="text-sm text-gray-600">
                                                        Client: {allUsers.find(u => u.id === workout.clientId)?.name}
                                                    </p>
                                                    <p className="text-sm text-gray-600">
                                                        Exercises: {workout.exercises.map(e => e.name).join(', ')}
                                                    </p>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                {workout.completed && (
                                                    <span className="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs">
                                                        ✓ Completed
                                                    </span>
                                                )}
                                                {workout.moodFeedback && (
                                                    <p className="text-sm mt-1">
                                                        Mood: {['😢', '😕', '😐', '😊', '😁'][workout.moodFeedback - 1] || '😐'}
                                                    </p>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                {myWorkouts.length === 0 && (
                                    <p className="text-gray-500">No workouts assigned yet</p>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // Goals Component
            const GoalsComponent = () => {
                const [showCreateForm, setShowCreateForm] = useState(false);
                const [goalForm, setGoalForm] = useState({
                    name: '',
                    target: '',
                    current: '',
                    deadline: ''
                });

                const isClient = hasRole('client');
                const canAssign = hasAnyRole('specialist', 'admin', 'owner');

                const handleCreateGoal = () => {
                    if (selectedClient && goalForm.name && goalForm.target && goalForm.deadline) {
                        const newGoal = {
                            id: Date.now(),
                            name: goalForm.name,
                            target: parseFloat(goalForm.target),
                            current: parseFloat(goalForm.current) || 0,
                            deadline: goalForm.deadline,
                            clientId: selectedClient.id,
                            assignedBy: currentUser.id
                        };
                        setClientData({
                            ...clientData,
                            goals: [...clientData.goals, newGoal]
                        });
                        setShowCreateForm(false);
                        setGoalForm({ name: '', target: '', current: '', deadline: '' });
                    }
                };

                const myGoals = clientData.goals.filter(g => 
                    hasRole('client') ? g.clientId === currentUser.id : true
                );

                if (isClient) {
                    return (
                        <div className="coastal-card p-6">
                            <h2 className="text-2xl font-bold mb-6">🎯 My Goals</h2>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {myGoals.map(goal => {
                                    const progress = (goal.current / goal.target) * 100;
                                    const isCompleted = goal.current >= goal.target;
                                    
                                    return (
                                        <div key={goal.id} className="coastal-card p-6">
                                            <div className="flex justify-between items-start mb-4">
                                                <h3 className="text-lg font-semibold">{goal.name}</h3>
                                                {isCompleted && (
                                                    <span className="bg-green-100 text-green-700 px-2 py-1 rounded-full text-sm">
                                                        ✓ Achieved
                                                    </span>
                                                )}
                                            </div>
                                            
                                            <div className="space-y-3">
                                                <div>
                                                    <div className="flex justify-between text-sm mb-1">
                                                        <span>Progress</span>
                                                        <span className="font-semibold">{Math.round(progress)}%</span>
                                                    </div>
                                                    <div className="progress-bar">
                                                        <div 
                                                            className="progress-fill" 
                                                            style={{ width: `${Math.min(progress, 100)}%` }}
                                                        ></div>
                                                    </div>
                                                </div>
                                                
                                                <div className="grid grid-cols-2 gap-2 text-sm">
                                                    <div>
                                                        <span className="text-gray-600">Current:</span>
                                                        <span className="font-semibold ml-1">{goal.current}</span>
                                                    </div>
                                                    <div>
                                                        <span className="text-gray-600">Target:</span>
                                                        <span className="font-semibold ml-1">{goal.target}</span>
                                                    </div>
                                                </div>
                                                
                                                <div className="text-sm">
                                                    <span className="text-gray-600">Deadline:</span>
                                                    <span className="font-semibold ml-1">{goal.deadline}</span>
                                                </div>
                                                
                                                {goal.assignedBy && (
                                                    <div className="text-xs text-gray-500 pt-2 border-t">
                                                        Assigned by: {allUsers.find(u => u.id === goal.assignedBy)?.name}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                                {myGoals.length === 0 && (
                                    <p className="text-gray-500 text-center col-span-2 py-8">No goals set yet</p>
                                )}
                            </div>
                        </div>
                    );
                }

                return (
                    <div className="coastal-card p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">🎯 Goals Management</h2>
                            {canAssign && (
                                <button 
                                    onClick={() => setShowCreateForm(!showCreateForm)} 
                                    className="coastal-button"
                                >
                                    + Add New Goal
                                </button>
                            )}
                        </div>

                        {showCreateForm && (
                            <div className="assignment-form animate-slide-in">
                                <div className="assignment-header">
                                    <span>🎯</span>
                                    <span>Add New Goal</span>
                                </div>
                                
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Select Client
                                    </label>
                                    <select 
                                        onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                        className="coastal-select"
                                        value={selectedClient?.id || ''}
                                    >
                                        <option value="">Choose a client...</option>
                                        {getMyClients().map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                </div>
                                
                                <div className="space-y-3">
                                    <input
                                        type="text"
                                        value={goalForm.name}
                                        onChange={(e) => setGoalForm({...goalForm, name: e.target.value})}
                                        className="coastal-input"
                                        placeholder="Goal Title (e.g., Weight Loss Goal)"
                                    />
                                    
                                    <div className="grid grid-cols-2 gap-3">
                                        <input
                                            type="number"
                                            value={goalForm.target}
                                            onChange={(e) => setGoalForm({...goalForm, target: e.target.value})}
                                            className="coastal-input"
                                            placeholder="Target Value (e.g., 155)"
                                        />
                                        <input
                                            type="number"
                                            value={goalForm.current}
                                            onChange={(e) => setGoalForm({...goalForm, current: e.target.value})}
                                            className="coastal-input"
                                            placeholder="Current Value (e.g., 165)"
                                        />
                                    </div>
                                    
                                    <input
                                        type="date"
                                        value={goalForm.deadline}
                                        onChange={(e) => setGoalForm({...goalForm, deadline: e.target.value})}
                                        className="coastal-input"
                                    />
                                </div>
                                
                                <button 
                                    onClick={handleCreateGoal} 
                                    className="coastal-button w-full mt-4"
                                    disabled={!selectedClient || !goalForm.name || !goalForm.target || !goalForm.deadline}
                                >
                                    + Add Goal
                                </button>
                            </div>
                        )}

                        <div>
                            <h3 className="text-lg font-semibold mb-4">Client Goals</h3>
                            <div className="space-y-3">
                                {myGoals.map(goal => {
                                    const progress = (goal.current / goal.target) * 100;
                                    
                                    return (
                                        <div key={goal.id} className="bg-gray-50 rounded-xl p-4">
                                            <div className="flex justify-between items-start">
                                                <div className="flex-1">
                                                    <h4 className="font-semibold">{goal.name}</h4>
                                                    <p className="text-sm text-gray-600">
                                                        Client: {allUsers.find(u => u.id === goal.clientId)?.name}
                                                    </p>
                                                    <div className="mt-2">
                                                        <div className="progress-bar">
                                                            <div 
                                                                className="progress-fill" 
                                                                style={{ width: `${Math.min(progress, 100)}%` }}
                                                            ></div>
                                                        </div>
                                                        <p className="text-xs text-gray-500 mt-1">
                                                            {goal.current} / {goal.target} • {Math.round(progress)}%
                                                        </p>
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <p className="text-sm text-gray-600">Due: {goal.deadline}</p>
                                                    {progress >= 100 && (
                                                        <span className="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs">
                                                            ✓ Achieved
                                                        </span>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                                {myGoals.length === 0 && (
                                    <p className="text-gray-500">No goals assigned yet</p>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // Measurements Component
            const MeasurementsComponent = () => {
                const [showAddForm, setShowAddForm] = useState(false);
                const [autoBMR, setAutoBMR] = useState(true);
                const [newMeasurement, setNewMeasurement] = useState({
                    date: new Date().toISOString().split('T')[0],
                    weight: '',
                    bodyFat: '',
                    muscleMass: '',
                    bmr: '',
                    bloodPressure: '',
                    clientId: '',
                    circumference: {
                        neck: '',
                        shoulders: '',
                        chest: '',
                        upperArm: '',
                        lowerArm: '',
                        waist: '',
                        hips: '',
                        upperThigh: '',
                        calf: ''
                    },
                    caliper: {
                        chest: '',
                        abdominal: '',
                        thigh: '',
                        bicep: '',
                        tricep: '',
                        subscapular: '',
                        suprailiac: '',
                        lowerBack: '',
                        calf: ''
                    }
                });

                const isClient = hasRole('client');
                const canAssign = hasAnyRole('specialist', 'admin', 'owner');

                const calculateBMR = (weight) => {
                    const weightKg = weight * 0.453592;
                    const bmr = Math.round(10 * weightKg + 6.25 * 175 - 5 * 30 + 5);
                    return bmr;
                };

                const handleAddMeasurement = () => {
                    const targetClientId = isClient ? currentUser.id : (selectedClient?.id || newMeasurement.clientId);
                    
                    if (newMeasurement.weight && targetClientId) {
                        const bmr = autoBMR ? calculateBMR(parseFloat(newMeasurement.weight)) : (parseFloat(newMeasurement.bmr) || calculateBMR(parseFloat(newMeasurement.weight)));
                        const measurement = {
                            ...newMeasurement,
                            id: Date.now(),
                            bmr,
                            clientId: targetClientId,
                            weight: parseFloat(newMeasurement.weight),
                            bodyFat: parseFloat(newMeasurement.bodyFat) || null,
                            circumference: Object.fromEntries(
                                Object.entries(newMeasurement.circumference).map(([key, value]) => [key, parseFloat(value) || null])
                            ),
                            caliper: Object.fromEntries(
                                Object.entries(newMeasurement.caliper).map(([key, value]) => [key, parseFloat(value) || null])
                            )
                        };
                        
                        setClientData({
                            ...clientData,
                            measurements: [...clientData.measurements, measurement]
                        });
                        
                        setShowAddForm(false);
                        setNewMeasurement({
                            date: new Date().toISOString().split('T')[0],
                            weight: '',
                            bodyFat: '',
                            muscleMass: '',
                            bmr: '',
                            bloodPressure: '',
                            clientId: '',
                            circumference: {
                                neck: '',
                                shoulders: '',
                                chest: '',
                                upperArm: '',
                                lowerArm: '',
                                waist: '',
                                hips: '',
                                upperThigh: '',
                                calf: ''
                            },
                            caliper: {
                                chest: '',
                                abdominal: '',
                                thigh: '',
                                bicep: '',
                                tricep: '',
                                subscapular: '',
                                suprailiac: '',
                                lowerBack: '',
                                calf: ''
                            }
                        });
                    }
                };

                const myMeasurements = clientData.measurements.filter(m => 
                    hasRole('client') ? m.clientId === currentUser.id : true
                );

                return (
                    <div className="coastal-card p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">📏 Body Measurements</h2>
                            <button onClick={() => setShowAddForm(!showAddForm)} className="coastal-button">
                                + Add Measurement
                            </button>
                        </div>

                        {showAddForm && (
                            <div className="assignment-form animate-slide-in">
                                <div className="assignment-header">
                                    <span>📏</span>
                                    <span>Add New Measurement</span>
                                </div>
                                
                                {canAssign && (
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Select Client
                                        </label>
                                        <select 
                                            onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                            className="coastal-select"
                                            value={selectedClient?.id || ''}
                                        >
                                            <option value="">Choose a client...</option>
                                            {getMyClients().map(client => (
                                                <option key={client.id} value={client.id}>{client.name}</option>
                                            ))}
                                        </select>
                                    </div>
                                )}
                                
                                <div className="space-y-4">
                                    <div>
                                        <h4 className="font-semibold text-sm text-gray-700 mb-2 flex items-center justify-between">
                                            <span>Basic Measurements</span>
                                            <label className="bmr-toggle">
                                                <input
                                                    type="checkbox"
                                                    checked={autoBMR}
                                                    onChange={(e) => setAutoBMR(e.target.checked)}
                                                />
                                                <span>Auto-calculate BMR</span>
                                            </label>
                                        </h4>
                                        <div className="grid grid-cols-2 gap-3">
                                            <input
                                                type="date"
                                                value={newMeasurement.date}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, date: e.target.value})}
                                                className="coastal-input col-span-2"
                                            />
                                            <input
                                                type="number"
                                                placeholder="Weight (lbs) *"
                                                value={newMeasurement.weight}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, weight: e.target.value})}
                                                className="coastal-input"
                                                required
                                            />
                                            <input
                                                type="number"
                                                placeholder="Body Fat %"
                                                value={newMeasurement.bodyFat}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, bodyFat: e.target.value})}
                                                className="coastal-input"
                                            />
                                            <input
                                                type="number"
                                                placeholder="Muscle Mass (lbs)"
                                                value={newMeasurement.muscleMass}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, muscleMass: e.target.value})}
                                                className="coastal-input"
                                            />
                                            <input
                                                type="text"
                                                placeholder="Blood Pressure"
                                                value={newMeasurement.bloodPressure}
                                                onChange={(e) => setNewMeasurement({...newMeasurement, bloodPressure: e.target.value})}
                                                className="coastal-input"
                                            />
                                            {!autoBMR && (
                                                <input
                                                    type="number"
                                                    placeholder="BMR (cal/day)"
                                                    value={newMeasurement.bmr}
                                                    onChange={(e) => setNewMeasurement({...newMeasurement, bmr: e.target.value})}
                                                    className="coastal-input col-span-2"
                                                />
                                            )}
                                        </div>
                                        {newMeasurement.weight && (
                                            <div className="bg-white rounded-lg p-3 mt-2">
                                                <p className="text-sm text-gray-600">
                                                    {autoBMR ? 'Calculated' : 'Estimated'} BMR: <span className="font-semibold">{autoBMR ? calculateBMR(newMeasurement.weight) : (newMeasurement.bmr || calculateBMR(newMeasurement.weight))} cal/day</span>
                                                </p>
                                            </div>
                                        )}
                                    </div>

                                    <div className="measurement-category">
                                        <h4>
                                            <span>📐</span>
                                            Circumference Measurements (inches)
                                        </h4>
                                        <div className="measurement-grid">
                                            {Object.keys(newMeasurement.circumference).map(key => (
                                                <div key={key} className="measurement-input-group">
                                                    <label>{key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}</label>
                                                    <input
                                                        type="number"
                                                        step="0.1"
                                                        value={newMeasurement.circumference[key]}
                                                        onChange={(e) => setNewMeasurement({
                                                            ...newMeasurement,
                                                            circumference: {
                                                                ...newMeasurement.circumference,
                                                                [key]: e.target.value
                                                            }
                                                        })}
                                                        placeholder="0.0"
                                                    />
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="measurement-category">
                                        <h4>
                                            <span>📍</span>
                                            Caliper Measurements (mm)
                                        </h4>
                                        <div className="measurement-grid">
                                            {Object.keys(newMeasurement.caliper).map(key => (
                                                <div key={key} className="measurement-input-group">
                                                    <label>{key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}</label>
                                                    <input
                                                        type="number"
                                                        step="0.1"
                                                        value={newMeasurement.caliper[key]}
                                                        onChange={(e) => setNewMeasurement({
                                                            ...newMeasurement,
                                                            caliper: {
                                                                ...newMeasurement.caliper,
                                                                [key]: e.target.value
                                                            }
                                                        })}
                                                        placeholder="0.0"
                                                    />
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                
                                <button 
                                    onClick={handleAddMeasurement} 
                                    className="coastal-button mt-4 w-full"
                                    disabled={!newMeasurement.weight || (!isClient && !selectedClient)}
                                >
                                    + Add Measurement
                                </button>
                            </div>
                        )}

                        <div>
                            <h3 className="text-lg font-semibold mb-4">Measurement History</h3>
                            <div className="space-y-3">
                                {myMeasurements.map(m => (
                                    <div key={m.id} className="bg-gray-50 rounded-xl p-4">
                                        <div className="flex justify-between items-start">
                                            <div className="w-full">
                                                <div className="flex justify-between items-start mb-3">
                                                    <div>
                                                        <p className="font-medium">{m.date}</p>
                                                        {m.clientId && hasAnyRole('specialist', 'admin', 'owner') && (
                                                            <p className="text-sm text-gray-600">
                                                                Client: {allUsers.find(u => u.id === m.clientId)?.name}
                                                            </p>
                                                        )}
                                                    </div>
                                                </div>
                                                
                                                <div className="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm mb-3">
                                                    <div>
                                                        <span className="text-gray-600">Weight:</span>
                                                        <span className="font-semibold ml-1">{m.weight} lbs</span>
                                                    </div>
                                                    {m.bodyFat && (
                                                        <div>
                                                            <span className="text-gray-600">Body Fat:</span>
                                                            <span className="font-semibold ml-1">{m.bodyFat}%</span>
                                                        </div>
                                                    )}
                                                    {m.bmr && (
                                                        <div>
                                                            <span className="text-gray-600">BMR:</span>
                                                            <span className="font-semibold ml-1">{m.bmr} cal</span>
                                                        </div>
                                                    )}
                                                    {m.bloodPressure && (
                                                        <div>
                                                            <span className="text-gray-600">BP:</span>
                                                            <span className="font-semibold ml-1">{m.bloodPressure}</span>
                                                        </div>
                                                    )}
                                                </div>
                                                
                                                {m.circumference && Object.values(m.circumference).some(v => v) && (
                                                    <div className="mb-2">
                                                        <p className="text-xs font-semibold text-gray-700 mb-1">Circumference:</p>
                                                        <div className="grid grid-cols-3 md:grid-cols-5 gap-1 text-xs">
                                                            {Object.entries(m.circumference).filter(([_, value]) => value).map(([key, value]) => (
                                                                <div key={key}>
                                                                    <span className="text-gray-600">{key.charAt(0).toUpperCase() + key.slice(1)}:</span>
                                                                    <span className="font-medium ml-1">{value}"</span>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                {m.caliper && Object.values(m.caliper).some(v => v) && (
                                                    <div>
                                                        <p className="text-xs font-semibold text-gray-700 mb-1">Caliper:</p>
                                                        <div className="grid grid-cols-3 md:grid-cols-5 gap-1 text-xs">
                                                            {Object.entries(m.caliper).filter(([_, value]) => value).map(([key, value]) => (
                                                                <div key={key}>
                                                                    <span className="text-gray-600">{key.charAt(0).toUpperCase() + key.slice(1)}:</span>
                                                                    <span className="font-medium ml-1">{value}mm</span>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                {myMeasurements.length === 0 && (
                                    <p className="text-gray-500 text-center py-8">No measurements recorded yet</p>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // Tests Component
            const TestsComponent = () => {
                const [showAddForm, setShowAddForm] = useState(false);
                const [testForm, setTestForm] = useState({
                    type: '',
                    date: new Date().toISOString().split('T')[0],
                    results: ''
                });

                const testTypes = [
                    'Body Composition Analysis',
                    'VO2 Max Test',
                    'Metabolic Rate Test',
                    'Flexibility Assessment',
                    'Strength Testing',
                    'Cardiovascular Assessment',
                    'Blood Work Analysis',
                    'Hormone Panel',
                    'Food Sensitivity Test',
                    'Postural Analysis',
                    'Other (Custom)'
                ];

                const handleAddTest = () => {
                    if (selectedClient && testForm.type && testForm.results) {
                        const newTest = {
                            id: Date.now(),
                            name: testForm.type,
                            date: testForm.date,
                            results: testForm.results,
                            clientId: selectedClient.id,
                            performedBy: currentUser.id
                        };
                        setClientData({
                            ...clientData,
                            tests: [...clientData.tests, newTest]
                        });
                        setShowAddForm(false);
                        setTestForm({ type: '', date: new Date().toISOString().split('T')[0], results: '' });
                    }
                };

                const myTests = clientData.tests.filter(t => 
                    hasRole('client') ? t.clientId === currentUser.id : true
                );

                return (
                    <div className="coastal-card p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">🧪 Specialized Tests</h2>
                            {hasAnyRole('specialist', 'admin', 'owner') && (
                                <button 
                                    onClick={() => setShowAddForm(!showAddForm)} 
                                    className="coastal-button"
                                >
                                    + Add Test Result
                                </button>
                            )}
                        </div>

                        {showAddForm && (
                            <div className="assignment-form animate-slide-in">
                                <div className="assignment-header">
                                    <span>🧪</span>
                                    <span>Add Specialized Test</span>
                                </div>
                                
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Select Client
                                    </label>
                                    <select 
                                        onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                        className="coastal-select"
                                        value={selectedClient?.id || ''}
                                    >
                                        <option value="">Choose a client...</option>
                                        {getMyClients().map(client => (
                                            <option key={client.id} value={client.id}>{client.name}</option>
                                        ))}
                                    </select>
                                </div>
                                
                                <div className="space-y-3">
                                    <input
                                        type="date"
                                        value={testForm.date}
                                        onChange={(e) => setTestForm({...testForm, date: e.target.value})}
                                        className="coastal-input"
                                    />
                                    
                                    <select
                                        value={testForm.type}
                                        onChange={(e) => setTestForm({...testForm, type: e.target.value})}
                                        className="coastal-select"
                                    >
                                        <option value="">✓ Select Test Type</option>
                                        {testTypes.map(type => (
                                            <option key={type} value={type}>{type}</option>
                                        ))}
                                    </select>
                                    
                                    <textarea
                                        value={testForm.results}
                                        onChange={(e) => setTestForm({...testForm, results: e.target.value})}
                                        className="coastal-input"
                                        rows="4"
                                        placeholder="Test results and observations..."
                                    />
                                </div>
                                
                                <button 
                                    onClick={handleAddTest} 
                                    className="coastal-button w-full mt-4"
                                    disabled={!selectedClient || !testForm.type || !testForm.results}
                                >
                                    + Add Test Result
                                </button>
                            </div>
                        )}

                        <div>
                            <h3 className="text-lg font-semibold mb-4">Test Results</h3>
                            <div className="space-y-3">
                                {myTests.map(test => (
                                    <div key={test.id} className="bg-gray-50 rounded-xl p-4">
                                        <div className="flex justify-between items-start mb-2">
                                            <h4 className="font-semibold">{test.name}</h4>
                                            <span className="text-sm text-gray-600">{test.date}</span>
                                        </div>
                                        <p className="text-sm text-gray-700 whitespace-pre-wrap">{test.results}</p>
                                        {test.performedBy && (
                                            <p className="text-xs text-gray-500 mt-2">
                                                Performed by: {allUsers.find(u => u.id === test.performedBy)?.name}
                                            </p>
                                        )}
                                        {test.clientId && hasAnyRole('specialist', 'admin', 'owner') && (
                                            <p className="text-xs text-gray-500">
                                                Client: {allUsers.find(u => u.id === test.clientId)?.name}
                                            </p>
                                        )}
                                    </div>
                                ))}
                                {myTests.length === 0 && (
                                    <p className="text-gray-500 text-center py-8">No tests performed yet</p>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // Reports Component
            const ReportsComponent = () => {
                const [showMeasurementCharts, setShowMeasurementCharts] = useState(false);
                const measurementChartRef = useRef(null);
                const measurementChartInstance = useRef(null);
                const [selectedMeasurementType, setSelectedMeasurementType] = useState('circumference');
                
                const myMeasurements = clientData.measurements.filter(m => 
                    hasRole('client') ? m.clientId === currentUser.id : (selectedClient ? m.clientId === selectedClient.id : true)
                );
                const myWorkouts = clientData.workouts.filter(w => 
                    hasRole('client') ? w.clientId === currentUser.id : (selectedClient ? w.clientId === selectedClient.id : true)
                );
                const myGoals = clientData.goals.filter(g => 
                    hasRole('client') ? g.clientId === currentUser.id : (selectedClient ? g.clientId === selectedClient.id : true)
                );
                const myTests = clientData.tests.filter(t => 
                    hasRole('client') ? t.clientId === currentUser.id : (selectedClient ? t.clientId === selectedClient.id : true)
                );

                const weightChange = myMeasurements.length >= 2 
                    ? myMeasurements[0].weight - myMeasurements[myMeasurements.length - 1].weight
                    : 0;

                const exportReport = () => {
                    try {
                        const clientName = selectedClient ? selectedClient.name : currentUser.name;
                        const exportDate = new Date().toISOString().split('T')[0];
                        
                        let reportContent = "COASTAL FITNESS HEALTH PROGRESS REPORT\n";
                        reportContent += "=====================================\n\n";
                        reportContent += `Client: ${clientName}\n`;
                        reportContent += `Export Date: ${exportDate}\n\n`;
                        
                        reportContent += "SUMMARY\n";
                        reportContent += "-------\n";
                        reportContent += `Total Measurements: ${myMeasurements.length}\n`;
                        reportContent += `Completed Goals: ${myGoals.filter(g => g.current >= g.target).length}\n`;
                        reportContent += `Total Goals: ${myGoals.length}\n`;
                        reportContent += `Completed Workouts: ${myWorkouts.filter(w => w.completed).length}\n`;
                        reportContent += `Total Workouts: ${myWorkouts.length}\n`;
                        reportContent += `Tests Performed: ${myTests.length}\n`;
                        reportContent += `Weight Change: ${weightChange} lbs\n\n`;
                        
                        reportContent += "MEASUREMENTS\n";
                        reportContent += "------------\n";
                        myMeasurements.forEach(m => {
                            reportContent += `Date: ${m.date}\n`;
                            reportContent += `  Weight: ${m.weight} lbs | Body Fat: ${m.bodyFat}% | BMR: ${m.bmr} | BP: ${m.bloodPressure}\n`;
                            if (m.circumference && Object.values(m.circumference).some(v => v)) {
                                reportContent += "  Circumference: ";
                                Object.entries(m.circumference).filter(([_, v]) => v).forEach(([key, value]) => {
                                    reportContent += `${key}: ${value}" | `;
                                });
                                reportContent += "\n";
                            }
                            reportContent += "\n";
                        });
                        
                        reportContent += "GOALS\n";
                        reportContent += "-----\n";
                        myGoals.forEach(g => {
                            const progress = Math.round((g.current / g.target) * 100);
                            reportContent += `${g.name}\n`;
                            reportContent += `  Progress: ${g.current}/${g.target} (${progress}%)\n`;
                            reportContent += `  Deadline: ${g.deadline}\n`;
                            reportContent += `  Status: ${g.current >= g.target ? 'COMPLETED' : 'IN PROGRESS'}\n\n`;
                        });
                        
                        reportContent += "WORKOUTS\n";
                        reportContent += "--------\n";
                        myWorkouts.forEach(w => {
                            reportContent += `${w.name}\n`;
                            reportContent += `  Status: ${w.completed ? 'Completed' : 'Pending'}\n`;
                            if (w.moodFeedback) reportContent += `  Mood Feedback: ${w.moodFeedback}/5\n`;
                            if (w.completedDate) reportContent += `  Completed Date: ${w.completedDate}\n`;
                            reportContent += `  Exercises: ${w.exercises.map(e => e.name).join(', ')}\n\n`;
                        });
                        
                        reportContent += "TESTS\n";
                        reportContent += "-----\n";
                        myTests.forEach(t => {
                            reportContent += `${t.name}\n`;
                            reportContent += `  Date: ${t.date}\n`;
                            reportContent += `  Results: ${t.results}\n\n`;
                        });
                        
                        const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8;' });
                        const link = document.createElement('a');
                        const url = URL.createObjectURL(blob);
                        link.setAttribute('href', url);
                        link.setAttribute('download', `coastal-fitness-report-${clientName.replace(/\s+/g, '-').toLowerCase()}-${exportDate}.txt`);
                        link.style.visibility = 'hidden';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                    } catch (error) {
                        console.error('Error exporting report:', error);
                        setError('Error exporting report. Please try again.');
                    }
                };

                useEffect(() => {
                    if (measurementChartRef.current && showMeasurementCharts && myMeasurements.length > 0) {
                        if (measurementChartInstance.current) {
                            measurementChartInstance.current.destroy();
                        }

                        const ctx = measurementChartRef.current.getContext('2d');
                        const labels = myMeasurements.map(m => m.date);
                        
                        let datasets = [];
                        if (selectedMeasurementType === 'circumference' && myMeasurements[0].circumference) {
                            const circumferenceKeys = Object.keys(myMeasurements[0].circumference);
                            const colors = ['#244398', '#60E0E0', '#f59e0b', '#10b981', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'];
                            
                            circumferenceKeys.forEach((key, index) => {
                                datasets.push({
                                    label: key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1'),
                                    data: myMeasurements.map(m => m.circumference?.[key] || 0),
                                    borderColor: colors[index % colors.length],
                                    backgroundColor: `${colors[index % colors.length]}20`,
                                    tension: 0.4
                                });
                            });
                        } else if (selectedMeasurementType === 'caliper' && myMeasurements[0].caliper) {
                            const caliperKeys = Object.keys(myMeasurements[0].caliper);
                            const colors = ['#dc2626', '#ea580c', '#d97706', '#ca8a04', '#65a30d', '#16a34a', '#059669', '#0891b2', '#0284c7'];
                            
                            caliperKeys.forEach((key, index) => {
                                datasets.push({
                                    label: key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1'),
                                    data: myMeasurements.map(m => m.caliper?.[key] || 0),
                                    borderColor: colors[index % colors.length],
                                    backgroundColor: `${colors[index % colors.length]}20`,
                                    tension: 0.4
                                });
                            });
                        }

                        measurementChartInstance.current = new Chart(ctx, {
                            type: 'line',
                            data: { labels, datasets },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: `${selectedMeasurementType === 'circumference' ? 'Circumference' : 'Caliper'} Measurements Over Time`
                                    }
                                }
                            }
                        });
                    }

                    return () => {
                        if (measurementChartInstance.current) {
                            measurementChartInstance.current.destroy();
                        }
                    };
                }, [showMeasurementCharts, myMeasurements, selectedMeasurementType]);

                return (
                    <div className="coastal-card p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">📊 Health Progress Report</h2>
                            <button onClick={exportReport} className="coastal-button">📥 Export Report (.txt)</button>
                        </div>

                        {hasAnyRole('specialist', 'admin', 'owner') && (
                            <div className="mb-6">
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Select Client for Report
                                </label>
                                <select 
                                    onChange={(e) => setSelectedClient(allUsers.find(u => u.id === e.target.value))}
                                    className="coastal-select max-w-xs"
                                    value={selectedClient?.id || ''}
                                >
                                    <option value="">All clients...</option>
                                    {getMyClients().map(client => (
                                        <option key={client.id} value={client.id}>{client.name}</option>
                                    ))}
                                </select>
                            </div>
                        )}

                        <div className="assignment-form mb-6">
                            <div className="assignment-header">
                                <span>📋</span>
                                <span>Detailed Analysis</span>
                            </div>
                            
                            <div className="space-y-4">
                                <div>
                                    <h3 className="text-lg font-semibold mb-3 text-green-700">✅ Achievements</h3>
                                    <ul className="space-y-2">
                                        <li className="flex items-start gap-2">
                                            <span className="text-green-500">•</span>
                                            <span>{myMeasurements.length} health measurements recorded</span>
                                        </li>
                                        <li className="flex items-start gap-2">
                                            <span className="text-green-500">•</span>
                                            <span>{myGoals.filter(g => g.current >= g.target).length} goals completed successfully</span>
                                        </li>
                                        <li className="flex items-start gap-2">
                                            <span className="text-green-500">•</span>
                                            <span>{myWorkouts.filter(w => w.completed).length} workouts completed</span>
                                        </li>
                                        <li className="flex items-start gap-2">
                                            <span className="text-green-500">•</span>
                                            <span>{myTests.length} specialized tests performed</span>
                                        </li>
                                        {weightChange > 0 && (
                                            <li className="flex items-start gap-2">
                                                <span className="text-green-500">•</span>
                                                <span>Weight change of -{weightChange} lbs achieved</span>
                                            </li>
                                        )}
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div className="coastal-card p-6 mb-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-lg font-semibold">📏 Body Measurements Analysis</h3>
                                <button 
                                    onClick={() => setShowMeasurementCharts(!showMeasurementCharts)}
                                    className="coastal-button-secondary"
                                >
                                    {showMeasurementCharts ? 'Hide Charts' : 'Show Charts'}
                                </button>
                            </div>
                            
                            {showMeasurementCharts && myMeasurements.length > 0 && (
                                <div>
                                    <div className="flex gap-2 mb-4">
                                        <button
                                            onClick={() => setSelectedMeasurementType('circumference')}
                                            className={`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${
                                                selectedMeasurementType === 'circumference' 
                                                    ? 'bg-blue-500 text-white' 
                                                    : 'bg-gray-200 text-gray-600'
                                            }`}
                                        >
                                            Circumference
                                        </button>
                                        <button
                                            onClick={() => setSelectedMeasurementType('caliper')}
                                            className={`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${
                                                selectedMeasurementType === 'caliper' 
                                                    ? 'bg-amber-500 text-white' 
                                                    : 'bg-gray-200 text-gray-600'
                                            }`}
                                        >
                                            Caliper (mm)
                                        </button>
                                    </div>
                                    <div className="h-64">
                                        <canvas ref={measurementChartRef}></canvas>
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="bg-gray-50 rounded-xl p-6">
                                <h3 className="text-lg font-semibold mb-4">Recent Activity</h3>
                                <div className="space-y-3">
                                    <div className="flex items-center gap-3">
                                        <span className="text-2xl">📏</span>
                                        <div>
                                            <p className="font-medium">Latest Measurement</p>
                                            <p className="text-sm text-gray-600">
                                                {myMeasurements[myMeasurements.length - 1]?.date || 'No data'}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <span className="text-2xl">💪</span>
                                        <div>
                                            <p className="font-medium">Last Workout</p>
                                            <p className="text-sm text-gray-600">
                                                {myWorkouts.filter(w => w.completed)[0]?.name || 'No completed workouts'}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <span className="text-2xl">🧪</span>
                                        <div>
                                            <p className="font-medium">Recent Test</p>
                                            <p className="text-sm text-gray-600">
                                                {myTests[myTests.length - 1]?.name || 'No tests'}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-gray-50 rounded-xl p-6">
                                <h3 className="text-lg font-semibold mb-4">Progress Summary</h3>
                                <div className="space-y-3">
                                    <div>
                                        <div className="flex justify-between mb-1">
                                            <span className="text-sm">Overall Progress</span>
                                            <span className="text-sm font-semibold">
                                                {myGoals.length > 0 
                                                    ? Math.round((myGoals.filter(g => g.current >= g.target).length / myGoals.length) * 100)
                                                    : 0}%
                                            </span>
                                        </div>
                                        <div className="progress-bar">
                                            <div 
                                                className="progress-fill" 
                                                style={{ 
                                                    width: `${myGoals.length > 0 
                                                        ? (myGoals.filter(g => g.current >= g.target).length / myGoals.length) * 100
                                                        : 0}%` 
                                                }}
                                            ></div>
                                        </div>
                                    </div>
                                    <div className="text-sm space-y-1">
                                        <p>Active Goals: {myGoals.filter(g => g.current < g.target).length}</p>
                                        <p>Completed Goals: {myGoals.filter(g => g.current >= g.target).length}</p>
                                        <p>Workout Compliance: {myWorkouts.filter(w => w.completed).length}/{myWorkouts.length}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Users Component
            const UsersComponent = () => {
                const [showAssignModal, setShowAssignModal] = useState(false);
                const [selectedUser, setSelectedUser] = useState(null);
                const [availableSpecialists, setAvailableSpecialists] = useState([]);
                const [showRoleModal, setShowRoleModal] = useState(false);
                const [showViewDataModal, setShowViewDataModal] = useState(false);
                const [viewingUser, setViewingUser] = useState(null);
                const [selectedRoles, setSelectedRoles] = useState([]);
                const [showAddUserModal, setShowAddUserModal] = useState(false);
                const [newUserForm, setNewUserForm] = useState({
                    name: '',
                    email: '',
                    password: '',
                    roles: ['client']
                });

                const openAssignModal = (user) => {
                    setSelectedUser(user);
                    setAvailableSpecialists(allUsers.filter(u => 
                        u.roles.includes('specialist') || 
                        u.roles.includes('admin') || 
                        u.roles.includes('owner')
                    ));
                    setShowAssignModal(true);
                };

                const openRoleModal = (user) => {
                    setSelectedUser(user);
                    setSelectedRoles([...user.roles]);
                    setShowRoleModal(true);
                };

                const toggleRole = (role) => {
                    setSelectedRoles(prev => 
                        prev.includes(role) 
                            ? prev.filter(r => r !== role)
                            : [...prev, role]
                    );
                };

                const saveRoles = () => {
                    if (selectedUser) {
                        setAllUsers(prevUsers => {
                            const updatedUsers = [...prevUsers];
                            const userIndex = updatedUsers.findIndex(u => u.id === selectedUser.id);
                            if (userIndex !== -1) {
                                updatedUsers[userIndex] = { ...selectedUser, roles: selectedRoles };
                            }
                            return updatedUsers;
                        });
                        setShowRoleModal(false);
                    }
                };

                const viewUserData = (user) => {
                    setViewingUser(user);
                    setShowViewDataModal(true);
                };

                const toggleSpecialist = (specialistId) => {
                    if (selectedUser) {
                        const currentSpecialists = selectedUser.specialistIds || [];
                        const newSpecialists = currentSpecialists.includes(specialistId)
                            ? currentSpecialists.filter(id => id !== specialistId)
                            : [...currentSpecialists, specialistId];
                        
                        setSelectedUser({
                            ...selectedUser,
                            specialistIds: newSpecialists
                        });
                    }
                };

                const getSpecialistNames = (specialistIds) => {
                    if (!specialistIds || specialistIds.length === 0) return '-';
                    return specialistIds.map(id => 
                        allUsers.find(u => u.id === id)?.name || 'Unknown'
                    ).join(', ');
                };

                const getUserData = (userId) => {
                    return {
                        measurements: clientData.measurements.filter(m => m.clientId === userId),
                        workouts: clientData.workouts.filter(w => w.clientId === userId),
                        goals: clientData.goals.filter(g => g.clientId === userId),
                        tests: clientData.tests.filter(t => t.clientId === userId),
                        nutrition: clientData.nutrition?.clientId === userId ? clientData.nutrition : null
                    };
                };

                const getUserAveragePainLevel = (userId) => {
                    const userWorkouts = clientData.workouts.filter(w => w.clientId === userId && w.completed);
                    if (userWorkouts.length === 0) return 0;
                    
                    let totalPain = 0;
                    let exerciseCount = 0;
                    
                    userWorkouts.forEach(workout => {
                        workout.exercises.forEach(exercise => {
                            if (exercise.painLevel !== undefined) {
                                totalPain += exercise.painLevel;
                                exerciseCount++;
                            }
                        });
                    });
                    
                    return exerciseCount > 0 ? (totalPain / exerciseCount).toFixed(1) : 0;
                };

                const getUserMoodHistory = (userId) => {
                    return clientData.workouts
                        .filter(w => w.clientId === userId && w.completed && w.moodFeedback)
                        .sort((a, b) => new Date(b.completedDate || 0) - new Date(a.completedDate || 0))
                        .slice(0, 5);
                };

                const handleAddUser = () => {
                    if (newUserForm.name && newUserForm.email && newUserForm.password) {
                        const newUser = {
                            id: `user_${Date.now()}`,
                            name: newUserForm.name,
                            email: newUserForm.email,
                            password: newUserForm.password,
                            roles: newUserForm.roles,
                            specialistIds: [],
                            clientIds: [],
                            online: false
                        };
                        
                        setAllUsers(prev => [...prev, newUser]);
                        setShowAddUserModal(false);
                        setNewUserForm({
                            name: '',
                            email: '',
                            password: '',
                            roles: ['client']
                        });
                    }
                };

                const exportUsersText = () => {
                    try {
                        let textContent = "COASTAL FITNESS USER MANAGEMENT EXPORT\n";
                        textContent += "=====================================\n\n";
                        textContent += `Export Date: ${new Date().toISOString()}\n`;
                        textContent += `Total Users: ${allUsers.length}\n\n`;
                        
                        textContent += "USER SUMMARY BY ROLE\n";
                        textContent += "-------------------\n";
                        textContent += `Clients: ${allUsers.filter(u => u.roles.includes('client')).length}\n`;
                        textContent += `Specialists: ${allUsers.filter(u => u.roles.includes('specialist')).length}\n`;
                        textContent += `Admins: ${allUsers.filter(u => u.roles.includes('admin')).length}\n`;
                        textContent += `Owners: ${allUsers.filter(u => u.roles.includes('owner')).length}\n`;
                        textContent += `Engineers: ${allUsers.filter(u => u.roles.includes('engineer')).length}\n\n`;
                        
                        textContent += "DETAILED USER LIST\n";
                        textContent += "==================\n\n";
                        
                        allUsers.forEach(user => {
                            const userData = getUserData(user.id);
                            textContent += `USER: ${user.name}\n`;
                            textContent += `-----${'-'.repeat(user.name.length)}-----\n`;
                            textContent += `ID: ${user.id}\n`;
                            textContent += `Email: ${user.email}\n`;
                            textContent += `Roles: ${user.roles.join(', ')}\n`;
                            textContent += `Assigned Professionals: ${getSpecialistNames(user.specialistIds)}\n`;
                            textContent += `Statistics:\n`;
                            textContent += `  - Total Measurements: ${userData.measurements.length}\n`;
                            textContent += `  - Total Workouts: ${userData.workouts.length}\n`;
                            textContent += `  - Completed Workouts: ${userData.workouts.filter(w => w.completed).length}\n`;
                            textContent += `  - Total Goals: ${userData.goals.length}\n`;
                            textContent += `  - Completed Goals: ${userData.goals.filter(g => g.current >= g.target).length}\n`;
                            textContent += `  - Average Pain Level: ${getUserAveragePainLevel(user.id)}\n`;
                            textContent += "\n";
                        });
                        
                        const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8;' });
                        const link = document.createElement('a');
                        const url = URL.createObjectURL(blob);
                        link.setAttribute('href', url);
                        link.setAttribute('download', `coastal-fitness-users-${new Date().toISOString().split('T')[0]}.txt`);
                        link.style.visibility = 'hidden';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                    } catch (error) {
                        console.error('Error exporting users:', error);
                        setError('Error exporting users. Please try again.');
                    }
                };

                return (
                    <div className="coastal-card p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">👥 User Management</h2>
                            <div className="flex gap-3">
                                <button 
                                    onClick={() => setShowAddUserModal(true)}
                                    className="coastal-button"
                                >
                                    + Add User
                                </button>
                                <button 
                                    onClick={exportUsersText}
                                    className="coastal-button-secondary"
                                >
                                    📊 Export Users (.txt)
                                </button>
                            </div>
                        </div>

                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead>
                                    <tr className="border-b bg-gray-50">
                                        <th className="text-left p-3">User</th>
                                        <th className="text-left p-3">Roles</th>
                                        <th className="text-left p-3">Email</th>
                                        <th className="text-left p-3">Assigned Professionals</th>
                                        <th className="text-left p-3">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {allUsers.map(user => (
                                        <tr key={user.id} className="border-b hover:bg-gray-50">
                                            <td className="p-3">
                                                <div className="flex items-center gap-2">
                                                    <span className="font-medium">{user.name}</span>
                                                </div>
                                            </td>
                                            <td className="p-3">
                                                <div className="flex gap-1 flex-wrap">
                                                    {user.roles.map(role => (
                                                        <span key={role} className={`coastal-badge badge-${role}`}>
                                                            {role}
                                                        </span>
                                                    ))}
                                                </div>
                                            </td>
                                            <td className="p-3 text-sm text-gray-600">{user.email}</td>
                                            <td className="p-3 text-sm">
                                                {getSpecialistNames(user.specialistIds)}
                                            </td>
                                            <td className="p-3">
                                                <div className="flex gap-2">
                                                    <button 
                                                        onClick={() => viewUserData(user)}
                                                        className="text-blue-600 hover:text-blue-700 text-sm"
                                                    >
                                                        View Profile
                                                    </button>
                                                    {hasAnyRole('admin', 'owner') && (
                                                        <button 
                                                            onClick={() => openRoleModal(user)}
                                                            className="text-purple-600 hover:text-purple-700 text-sm"
                                                        >
                                                            Modify Roles
                                                        </button>
                                                    )}
                                                    {user.roles.includes('client') && (
                                                        <button 
                                                            onClick={() => openAssignModal(user)}
                                                            className="text-green-600 hover:text-green-700 text-sm"
                                                        >
                                                            Assign Professionals
                                                        </button>
                                                    )}
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        {showAddUserModal && (
                            <div className="modal-overlay" onClick={() => setShowAddUserModal(false)}>
                                <div className="modal-content max-w-lg" onClick={(e) => e.stopPropagation()}>
                                    <h3 className="text-xl font-semibold mb-4">
                                        Add New User
                                    </h3>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="form-label">Full Name</label>
                                            <input
                                                type="text"
                                                value={newUserForm.name}
                                                onChange={(e) => setNewUserForm({...newUserForm, name: e.target.value})}
                                                className="coastal-input"
                                                placeholder="Enter full name"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="form-label">Email Address</label>
                                            <input
                                                type="email"
                                                value={newUserForm.email}
                                                onChange={(e) => setNewUserForm({...newUserForm, email: e.target.value})}
                                                className="coastal-input"
                                                placeholder="Enter email address"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="form-label">Password</label>
                                            <input
                                                type="password"
                                                value={newUserForm.password}
                                                onChange={(e) => setNewUserForm({...newUserForm, password: e.target.value})}
                                                className="coastal-input"
                                                placeholder="Enter password"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="form-label">Select Roles</label>
                                            <div className="space-y-2">
                                                {['client', 'specialist', 'admin', 'owner', 'engineer'].map(role => (
                                                    <label key={role} className="flex items-center gap-2">
                                                        <input
                                                            type="checkbox"
                                                            checked={newUserForm.roles.includes(role)}
                                                            onChange={() => {
                                                                setNewUserForm({
                                                                    ...newUserForm,
                                                                    roles: newUserForm.roles.includes(role)
                                                                        ? newUserForm.roles.filter(r => r !== role)
                                                                        : [...newUserForm.roles, role]
                                                                });
                                                            }}
                                                        />
                                                        <span className="capitalize">{role}</span>
                                                    </label>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="flex gap-2 mt-6">
                                        <button
                                            onClick={handleAddUser}
                                            className="coastal-button flex-1"
                                            disabled={!newUserForm.name || !newUserForm.email || !newUserForm.password || newUserForm.roles.length === 0}
                                        >
                                            Add User
                                        </button>
                                        <button
                                            onClick={() => setShowAddUserModal(false)}
                                            className="coastal-button bg-gray-500 hover:bg-gray-600 flex-1"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showAssignModal && (
                            <div className="modal-overlay" onClick={() => setShowAssignModal(false)}>
                                <div className="modal-content max-w-lg" onClick={(e) => e.stopPropagation()}>
                                    <h3 className="text-xl font-semibold mb-4">
                                        Assign Health Professionals to {selectedUser?.name}
                                    </h3>
                                    <p className="text-sm text-gray-600 mb-4">
                                        Select specialists, admins, or owners to manage this client
                                    </p>
                                    
                                    <div className="space-y-3">
                                        {availableSpecialists.map(specialist => (
                                            <label key={specialist.id} className="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 cursor-pointer">
                                                <input
                                                    type="checkbox"
                                                    checked={selectedUser?.specialistIds?.includes(specialist.id) || false}
                                                    onChange={() => toggleSpecialist(specialist.id)}
                                                    className="w-5 h-5"
                                                />
                                                <div className="flex-1">
                                                    <p className="font-medium">{specialist.name}</p>
                                                    <p className="text-sm text-gray-600">{specialist.email}</p>
                                                </div>
                                            </label>
                                        ))}
                                    </div>
                                    
                                    <div className="flex gap-2 mt-6">
                                        <button
                                            onClick={() => {
                                                if (selectedUser) {
                                                    setAllUsers(prevUsers => {
                                                        const updatedUsers = [...prevUsers];
                                                        
                                                        const clientIndex = updatedUsers.findIndex(u => u.id === selectedUser.id);
                                                        if (clientIndex !== -1) {
                                                            updatedUsers[clientIndex] = selectedUser;
                                                        }
                                                        
                                                        availableSpecialists.forEach(professional => {
                                                            const profIndex = updatedUsers.findIndex(u => u.id === professional.id);
                                                            if (profIndex !== -1) {
                                                                const currentClientIds = updatedUsers[profIndex].clientIds || [];
                                                                if (selectedUser.specialistIds?.includes(professional.id)) {
                                                                    if (!currentClientIds.includes(selectedUser.id)) {
                                                                        updatedUsers[profIndex] = {
                                                                            ...updatedUsers[profIndex],
                                                                            clientIds: [...currentClientIds, selectedUser.id]
                                                                        };
                                                                    }
                                                                } else {
                                                                    updatedUsers[profIndex] = {
                                                                        ...updatedUsers[profIndex],
                                                                        clientIds: currentClientIds.filter(id => id !== selectedUser.id)
                                                                    };
                                                                }
                                                            }
                                                        });
                                                        
                                                        return updatedUsers;
                                                    });
                                                }
                                                setShowAssignModal(false);
                                            }}
                                            className="coastal-button flex-1"
                                        >
                                            Save Assignment
                                        </button>
                                        <button
                                            onClick={() => setShowAssignModal(false)}
                                            className="coastal-button bg-gray-500 hover:bg-gray-600 flex-1"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showRoleModal && (
                            <div className="modal-overlay" onClick={() => setShowRoleModal(false)}>
                                <div className="modal-content max-w-lg" onClick={(e) => e.stopPropagation()}>
                                    <h3 className="text-xl font-semibold mb-4">
                                        Modify Roles for {selectedUser?.name}
                                    </h3>
                                    
                                    <div className="space-y-3">
                                        {['client', 'specialist', 'admin', 'owner', 'engineer'].map(role => (
                                            <label key={role} className="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 cursor-pointer">
                                                <input
                                                    type="checkbox"
                                                    checked={selectedRoles.includes(role)}
                                                    onChange={() => toggleRole(role)}
                                                    className="w-5 h-5"
                                                />
                                                <div className="flex-1">
                                                    <p className="font-medium capitalize">{role}</p>
                                                    <p className="text-sm text-gray-600">
                                                        {role === 'client' && 'Basic user access'}
                                                        {role === 'specialist' && 'Can manage client health data'}
                                                        {role === 'admin' && 'Full system administration'}
                                                        {role === 'owner' && 'Complete control and visibility'}
                                                        {role === 'engineer' && 'Technical system access'}
                                                    </p>
                                                </div>
                                                <span className={`coastal-badge badge-${role}`}>
                                                    {role}
                                                </span>
                                            </label>
                                        ))}
                                    </div>
                                    
                                    <div className="flex gap-2 mt-6">
                                        <button
                                            onClick={saveRoles}
                                            className="coastal-button flex-1"
                                            disabled={selectedRoles.length === 0}
                                        >
                                            Save Roles
                                        </button>
                                        <button
                                            onClick={() => setShowRoleModal(false)}
                                            className="coastal-button bg-gray-500 hover:bg-gray-600 flex-1"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showViewDataModal && viewingUser && (
                            <div className="modal-overlay" onClick={() => setShowViewDataModal(false)}>
                                <div className="modal-content max-w-4xl" onClick={(e) => e.stopPropagation()}>
                                    <h3 className="text-xl font-semibold mb-4">
                                        Client Profile: {viewingUser.name}
                                    </h3>
                                    
                                    {(() => {
                                        const userData = getUserData(viewingUser.id);
                                        const avgPainLevel = getUserAveragePainLevel(viewingUser.id);
                                        const moodHistory = getUserMoodHistory(viewingUser.id);
                                        
                                        return (
                                            <div className="space-y-6">
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div className="pain-summary-card">
                                                        <h4 className="font-semibold mb-2 flex items-center gap-2">
                                                            <span>🩹</span>
                                                            Pain Level Summary
                                                        </h4>
                                                        <div className="flex items-center justify-between">
                                                            <div>
                                                                <p className="text-2xl font-bold text-orange-700">{avgPainLevel}</p>
                                                                <p className="text-sm text-gray-700">Average Pain Level</p>
                                                            </div>
                                                            <div className="flex gap-1">
                                                                {[0, 1, 2, 3, 4, 5].map(level => (
                                                                    <div
                                                                        key={level}
                                                                        className={`pain-scale-btn pain-${level} ${
                                                                            Math.round(avgPainLevel) === level ? 'selected' : ''
                                                                        }`}
                                                                        style={{ cursor: 'default', width: '30px', height: '30px', fontSize: '0.875rem' }}
                                                                    >
                                                                        {level}
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div className="mood-summary-card">
                                                        <h4 className="font-semibold mb-2 flex items-center gap-2">
                                                            <span>😊</span>
                                                            Recent Mood Feedback
                                                        </h4>
                                                        <div className="space-y-1">
                                                            {moodHistory.length > 0 ? (
                                                                moodHistory.map((workout, index) => (
                                                                    <div key={workout.id} className="flex items-center justify-between text-sm">
                                                                        <span className="text-gray-700">{workout.name}</span>
                                                                        <span className="text-xl">
                                                                            {['😢', '😕', '😐', '😊', '😁'][workout.moodFeedback - 1] || '😐'}
                                                                        </span>
                                                                    </div>
                                                                ))
                                                            ) : (
                                                                <p className="text-sm text-gray-600">No mood feedback yet</p>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>

                                                <div>
                                                    <h4 className="font-semibold mb-2 text-blue-700">📏 Measurements ({userData.measurements.length})</h4>
                                                    <div className="max-h-40 overflow-y-auto">
                                                        {userData.measurements.map(m => (
                                                            <div key={m.id} className="bg-gray-50 rounded p-2 mb-2">
                                                                <span className="font-medium">{m.date}</span> - 
                                                                Weight: {m.weight}lbs, 
                                                                Body Fat: {m.bodyFat}%, 
                                                                BP: {m.bloodPressure}
                                                            </div>
                                                        ))}
                                                        {userData.measurements.length === 0 && (
                                                            <p className="text-gray-500">No measurements recorded</p>
                                                        )}
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <h4 className="font-semibold mb-2 text-green-700">💪 Workouts ({userData.workouts.length})</h4>
                                                    <div className="max-h-40 overflow-y-auto">
                                                        {userData.workouts.map(w => (
                                                            <div key={w.id} className="bg-gray-50 rounded p-2 mb-2">
                                                                <span className="font-medium">{w.name}</span> - 
                                                                {w.exercises.length} exercises
                                                                {w.completed && <span className="text-green-600 ml-2">✓ Completed</span>}
                                                            </div>
                                                        ))}
                                                        {userData.workouts.length === 0 && (
                                                            <p className="text-gray-500">No workouts assigned</p>
                                                        )}
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <h4 className="font-semibold mb-2 text-orange-700">🎯 Goals ({userData.goals.length})</h4>
                                                    <div className="max-h-40 overflow-y-auto">
                                                        {userData.goals.map(g => (
                                                            <div key={g.id} className="bg-gray-50 rounded p-2 mb-2">
                                                                <span className="font-medium">{g.name}</span> - 
                                                                Progress: {g.current}/{g.target} ({Math.round((g.current/g.target)*100)}%)
                                                            </div>
                                                        ))}
                                                        {userData.goals.length === 0 && (
                                                            <p className="text-gray-500">No goals set</p>
                                                        )}
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <h4 className="font-semibold mb-2 text-purple-700">🧪 Tests ({userData.tests.length})</h4>
                                                    <div className="max-h-40 overflow-y-auto">
                                                        {userData.tests.map(t => (
                                                            <div key={t.id} className="bg-gray-50 rounded p-2 mb-2">
                                                                <span className="font-medium">{t.name}</span> - {t.date}
                                                            </div>
                                                        ))}
                                                        {userData.tests.length === 0 && (
                                                            <p className="text-gray-500">No tests performed</p>
                                                        )}
                                                    </div>
                                                </div>
                                                
                                                {userData.nutrition && (
                                                    <div>
                                                        <h4 className="font-semibold mb-2 text-cyan-700">🥗 Nutrition Plan</h4>
                                                        <div className="bg-gray-50 rounded p-3">
                                                            <p>Protein: {userData.nutrition.protein.target}g</p>
                                                            <p>Carbs: {userData.nutrition.carbs.target}g</p>
                                                            <p>Fat: {userData.nutrition.fat.target}g</p>
                                                            <p>Calories: {userData.nutrition.calories.target}</p>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })()}
                                    
                                    <div className="flex gap-2 mt-6">
                                        <button
                                            onClick={() => setShowViewDataModal(false)}
                                            className="coastal-button w-full"
                                        >
                                            Close
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Engineer Component
            const EngineerComponent = () => {
                const clearAllData = () => {
                    if (confirm('Are you sure you want to clear all data? This will reset everything to demo data.')) {
                        try {
                            localStorage.removeItem('coastalClientData');
                            localStorage.removeItem('coastalMessages');
                            localStorage.removeItem('coastalAllUsers');
                            localStorage.removeItem('coastalLogo');
                            sessionStorage.removeItem('coastalUser');
                            window.location.reload();
                        } catch (error) {
                            console.error('Error clearing data:', error);
                            setError('Error clearing data. Please try again.');
                        }
                    }
                };

                const refreshSystem = () => {
                    window.location.reload();
                };

                return (
                    <div className="coastal-card p-6">
                        <h2 className="text-2xl font-bold mb-6">🔧 Engineering Dashboard</h2>
                        
                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                            <p className="text-sm text-blue-800">
                                <strong>System Version:</strong> 1.0.0 | 
                                <strong> Last Updated:</strong> {new Date().toLocaleDateString()} | 
                                <strong> Environment:</strong> Production
                            </p>
                        </div>
                        
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div className="bg-gray-50 rounded-xl p-4">
                                <h3 className="font-semibold mb-2">System Status</h3>
                                <p className="text-green-600 font-bold">✓ All Systems Operational</p>
                            </div>
                            <div className="bg-gray-50 rounded-xl p-4">
                                <h3 className="font-semibold mb-2">Database</h3>
                                <p className="text-sm">Active Records: {Object.keys(clientData).reduce((acc, key) => acc + (Array.isArray(clientData[key]) ? clientData[key].length : 1), 0)}</p>
                            </div>
                            <div className="bg-gray-50 rounded-xl p-4">
                                <h3 className="font-semibold mb-2">Users</h3>
                                <p className="text-sm">Total: {allUsers.length}</p>
                                <p className="text-xs text-gray-600">Online: {allUsers.filter(u => u.online).length}</p>
                            </div>
                        </div>
                        
                        <div className="flex gap-4">
                            <button 
                                onClick={clearAllData}
                                className="coastal-button bg-red-600 hover:bg-red-700"
                            >
                                🗑️ Clear All Data
                            </button>
                            <button 
                                onClick={refreshSystem}
                                className="coastal-button-secondary"
                            >
                                🔄 Refresh System
                            </button>
                        </div>
                    </div>
                );
            };

            // Main render
            if (!currentUser) {
                return <LoginForm />;
            }

            return (
                <ErrorBoundary>
                    <div className="app-container">
                        <div className="min-h-screen p-4 max-w-7xl mx-auto">
                            {error && (
                                <div className="error-message mb-4">
                                    {error}
                                </div>
                            )}
                            
                            <Navigation />
                            
                            {activeTab === 'dashboard' && <Dashboard />}
                            {activeTab === 'measurements' && <MeasurementsComponent />}
                            {activeTab === 'nutrition' && <NutritionComponent />}
                            {activeTab === 'workouts' && <WorkoutsComponent />}
                            {activeTab === 'goals' && <GoalsComponent />}
                            {activeTab === 'chat' && <ChatComponent />}
                            {activeTab === 'reports' && <ReportsComponent />}
                            {activeTab === 'users' && <UsersComponent />}
                            {activeTab === 'tests' && <TestsComponent />}
                            {activeTab === 'engineer' && <EngineerComponent />}
                        </div>
                    </div>
                </ErrorBoundary>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
                